<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pod控制器详解 | 技术博客，知识分享，学习笔记，问题解决方案</title>
    <meta name="description" content="啊郭的博客">
    <link rel="stylesheet" href="/guo-notes/assets/style.5e0eda6f.css">
    <link rel="modulepreload" href="/guo-notes/assets/app.8b821eb2.js">
    <link rel="modulepreload" href="/guo-notes/assets/classify_Kubernetes_Pod控制器详解.md.9a9af285.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c6a644e1><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c6a644e1 data-v-a71a30f1><div class="VPNavBar has-sidebar" data-v-a71a30f1 data-v-6f1d18b5><div class="container" data-v-6f1d18b5><div class="VPNavBarTitle has-sidebar" data-v-6f1d18b5 data-v-d5925166><a class="title" href="/guo-notes/" data-v-d5925166><!--[--><!--]--><!----><!--[-->啊郭的博客<!--]--><!--[--><!--]--></a></div><div class="content" data-v-6f1d18b5><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6f1d18b5 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 后端技术 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/redis/redis%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Redis<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/mysql/mysql%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Mysql<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/RabbitMq/MQ%E7%9A%84%E6%A6%82%E5%BF%B5.html" data-v-e8e0fb1d data-v-3c355974><!--[-->RabbitMq<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Docker/Docker%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Docker<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Kubernetes/Kubernetes%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Kubernetes<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 计算机基础 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/计算机基础/计算机网络/" data-v-e8e0fb1d data-v-3c355974><!--[-->计算机网络<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guo-notes/classify/algorithm/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->算法<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 杂项 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6f1d18b5 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-1899cd41 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1899cd41><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1899cd41><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6f1d18b5 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/gyh-up?tab=repositories" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://blog.csdn.net/weixin_42258523?spm=1000.2115.3001.5343" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><embed src="https://g.csdnimg.cn/static/logo/favicon32.ico" style="border-radius: 100%;width: 20px;height: 20px;" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6f1d18b5 data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-1899cd41 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1899cd41><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1899cd41><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/gyh-up?tab=repositories" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://blog.csdn.net/weixin_42258523?spm=1000.2115.3001.5343" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><embed src="https://g.csdnimg.cn/static/logo/favicon32.ico" style="border-radius: 100%;width: 20px;height: 20px;" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6f1d18b5 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-c6a644e1 data-v-aac27d5e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-aac27d5e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-aac27d5e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-aac27d5e>Menu</span></button><a class="top-link" href="#" data-v-aac27d5e> Return to top </a></div><aside class="VPSidebar" data-v-c6a644e1 data-v-f332cb62><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f332cb62><span class="visually-hidden" id="sidebar-aria-label" data-v-f332cb62> Sidebar Navigation </span><!--[--><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible" data-v-f332cb62 data-v-35f99ef5><div class="title" role="button" data-v-35f99ef5><h2 class="title-text" data-v-35f99ef5>Kubernetes</h2><div class="action" data-v-35f99ef5><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-35f99ef5><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-35f99ef5><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-35f99ef5><!--[--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Kubernetes/Kubernetes%E4%BB%8B%E7%BB%8D.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>一、Kubernetes介绍</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Kubernetes/Kubernetes%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>二、Kubernetes集群环境搭建</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Kubernetes/Kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>三、Kubernetes资源管理</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Kubernetes/Kubernetes%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>四、Kubernetes实战入门</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Kubernetes/Pod%E8%AF%A6%E8%A7%A3.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>五、Pod详解</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/guo-notes/classify/Kubernetes/Pod%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>六、Pod控制器详解</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Kubernetes/Service%E8%AF%A6%E8%A7%A3.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>七、Service详解</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Kubernetes/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>八、数据存储</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Kubernetes/%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>九、安全认证</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Kubernetes/DashBoard.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十、DashBoard</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c6a644e1 data-v-c95df128><div class="VPDoc has-sidebar has-aside" data-v-c95df128 data-v-37ebe389><div class="container" data-v-37ebe389><div class="aside" data-v-37ebe389><div class="aside-curtain" data-v-37ebe389></div><div class="aside-container" data-v-37ebe389><div class="aside-content" data-v-37ebe389><div class="VPDocAside" data-v-37ebe389 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-37ebe389><div class="content-container" data-v-37ebe389><!--[--><!--]--><main class="main" data-v-37ebe389><div style="position:relative;" class="vp-doc _guo-notes_classify_Kubernetes_Pod%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AF%A6%E8%A7%A3" data-v-37ebe389><div><h1 id="pod控制器详解" tabindex="-1">Pod控制器详解 <a class="header-anchor" href="#pod控制器详解" aria-hidden="true">#</a></h1><h2 id="一、pod控制器介绍" tabindex="-1">一、Pod控制器介绍 <a class="header-anchor" href="#一、pod控制器介绍" aria-hidden="true">#</a></h2><p>Pod是kubernetes的最小管理单元，在kubernetes中，按照pod的创建方式可以将其分为两类：</p><ul><li>自主式pod：kubernetes直接创建出来的Pod，这种pod删除后就没有了，也不会重建</li><li>控制器创建的pod：kubernetes通过控制器创建的pod，这种pod删除了之后还会自动重建</li></ul><blockquote><p><strong><code>什么是Pod控制器</code></strong></p><p>Pod控制器是管理pod的中间层，使用Pod控制器之后，只需要告诉Pod控制器，想要多少个什么样的Pod就可以了，它会创建出满足条件的Pod并确保每一个Pod资源处于用户期望的目标状态。如果Pod资源在运行中出现故障，它会基于指定策略重新编排Pod。</p></blockquote><p>在kubernetes中，有很多类型的pod控制器，每种都有自己的适合的场景，常见的有下面这些：</p><ul><li>ReplicationController：比较原始的pod控制器，已经被废弃，由ReplicaSet替代</li><li>ReplicaSet：保证副本数量一直维持在期望值，并支持pod数量扩缩容，镜像版本升级</li><li>Deployment：通过控制ReplicaSet来控制Pod，并支持滚动升级、回退版本</li><li>Horizontal Pod Autoscaler：可以根据集群负载自动水平调整Pod的数量，实现削峰填谷</li><li>DaemonSet：在集群中的指定Node上运行且仅运行一个副本，一般用于守护进程类的任务</li><li>Job：它创建出来的pod只要完成任务就立即退出，不需要重启或重建，用于执行一次性任务</li><li>Cronjob：它创建的Pod负责周期性任务控制，不需要持续后台运行</li><li>StatefulSet：管理有状态应用</li></ul><h2 id="二、replicaset-rs" tabindex="-1">二、ReplicaSet(RS) <a class="header-anchor" href="#二、replicaset-rs" aria-hidden="true">#</a></h2><p>ReplicaSet的主要作用是<strong>保证一定数量的pod正常运行</strong>，它会持续监听这些Pod的运行状态，一旦Pod发生故障，就会重启或重建。同时它还支持对pod数量的扩缩容和镜像版本的升降级。</p><p><img src="/guo-notes/kubenetes/image-20200612005334159.png" alt="img"></p><p>ReplicaSet的资源清单文件：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apps/v1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 版本号</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ReplicaSet</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 类型       </span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 元数据</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># rs名称 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 所属命名空间 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#标签</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">controller</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rs</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 详情描述</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">replicas</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 副本数量</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 选择器，通过它指定该控制器管理哪些pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;"># Labels匹配规则</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchExpressions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># Expressions匹配规则</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">operator</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">In</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">nginx-pod</span><span style="color:#89DDFF;">]}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 模板，当副本数量不足时，会根据下面的模板创建pod副本</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">containerPort</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>在这里面，需要新了解的配置项就是<code>spec</code>下面几个选项：</p><ul><li><p>replicas：指定副本数量，其实就是当前rs创建出来的pod的数量，默认为1</p></li><li><p>selector：选择器，它的作用是建立pod控制器和pod之间的关联关系，采用的Label Selector机制</p><p>在pod模板上定义label，在控制器上定义选择器，就可以表明当前控制器能管理哪些pod了</p></li><li><p>template：模板，就是当前控制器创建pod所使用的模板板，里面其实就是前一章学过的pod的定义</p></li></ul><p><strong>创建ReplicaSet</strong></p><p>创建pc-replicaset.yaml文件，内容如下：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apps/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ReplicaSet</span><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pc-replicaset</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dev</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">replicas</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:1.17.1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 创建rs</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl create -f pc-replicaset.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">replicaset.apps/pc-replicaset created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看rs</span></span>
<span class="line"><span style="color:#676E95;"># DESIRED:期望副本数量  </span></span>
<span class="line"><span style="color:#676E95;"># CURRENT:当前副本数量  </span></span>
<span class="line"><span style="color:#676E95;"># READY:已经准备好提供服务的副本数量</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get rs pc-replicaset -n dev -o wide</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME          DESIRED   CURRENT READY AGE   CONTAINERS   IMAGES             SELECTOR</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset 3         3       3     22s   nginx        nginx:1.17.1       app=nginx-pod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看当前控制器创建出来的pod</span></span>
<span class="line"><span style="color:#676E95;"># 这里发现控制器创建出来的pod的名称是在控制器名称后面拼接了-xxxxx随机码</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pod -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                          READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-6vmvt   1/1     Running   0          54s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-fmb8f   1/1     Running   0          54s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-snrk2   1/1     Running   0          54s</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>扩缩容</strong></p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 编辑rs的副本数量，修改spec:replicas: 6即可</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl edit rs pc-replicaset -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">replicaset.apps/pc-replicaset edited</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看pod</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                          READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-6vmvt   1/1     Running   0          114m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-cftnp   1/1     Running   0          10s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-fjlm6   1/1     Running   0          10s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-fmb8f   1/1     Running   0          114m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-s2whj   1/1     Running   0          10s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-snrk2   1/1     Running   0          114m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 当然也可以直接使用命令实现</span></span>
<span class="line"><span style="color:#676E95;"># 使用scale命令实现扩缩容， 后面--replicas=n直接指定目标数量即可</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl scale rs pc-replicaset --replicas=2 -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">replicaset.apps/pc-replicaset scaled</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 命令运行完毕，立即查看，发现已经有4个开始准备退出了</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                       READY   STATUS        RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-6vmvt   0/1     Terminating   0          118m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-cftnp   0/1     Terminating   0          4m17s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-fjlm6   0/1     Terminating   0          4m17s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-fmb8f   1/1     Running       0          118m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-s2whj   0/1     Terminating   0          4m17s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-snrk2   1/1     Running       0          118m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#稍等片刻，就只剩下2个了</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                       READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-fmb8f   1/1     Running   0          119m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-snrk2   1/1     Running   0          119m</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><strong>镜像升级</strong></p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 编辑rs的容器镜像 - image: nginx:1.17.2</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl edit rs pc-replicaset -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">replicaset.apps/pc-replicaset edited</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 再次查看，发现镜像版本已经变更了</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get rs -n dev -o wide</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES        ...</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset       2        2         2       140m   nginx         nginx:1.17.2  ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 同样的道理，也可以使用命令完成这个工作</span></span>
<span class="line"><span style="color:#676E95;"># kubectl set image rs rs名称 容器=镜像版本 -n namespace</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">replicaset.apps/pc-replicaset image updated</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 再次查看，发现镜像版本已经变更了</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get rs -n dev -o wide</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                 DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES            ...</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset        2        2         2       145m   nginx        nginx:1.17.1 ... </span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>删除ReplicaSet</strong></p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 使用kubectl delete命令会删除此RS以及它管理的Pod</span></span>
<span class="line"><span style="color:#676E95;"># 在kubernetes删除RS前，会将RS的replicasclear调整为0，等待所有的Pod被删除后，在执行RS对象的删除</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl delete rs pc-replicaset -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">replicaset.apps </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pc-replicaset</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> deleted</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pod -n dev -o wide</span></span>
<span class="line"><span style="color:#A6ACCD;">No resources found </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> dev namespace.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 如果希望仅仅删除RS对象（保留Pod），可以使用kubectl delete命令时添加--cascade=false选项（不推荐）。</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl delete rs pc-replicaset -n dev --cascade=false</span></span>
<span class="line"><span style="color:#A6ACCD;">replicaset.apps </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pc-replicaset</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> deleted</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                  READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-cl82j   1/1     Running   0          75s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-replicaset-dslhb   1/1     Running   0          75s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 也可以使用yaml直接删除(推荐)</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl delete -f pc-replicaset.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">replicaset.apps </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pc-replicaset</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> deleted</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="三、deployment-deploy" tabindex="-1">三、Deployment(Deploy) <a class="header-anchor" href="#三、deployment-deploy" aria-hidden="true">#</a></h2><p>为了更好的解决服务编排的问题，kubernetes在V1.2版本开始，引入了Deployment控制器。值得一提的是，这种控制器并不直接管理pod，而是通过管理ReplicaSet来简介管理Pod，即：Deployment管理ReplicaSet，ReplicaSet管理Pod。所以Deployment比ReplicaSet功能更加强大。</p><p><img src="/guo-notes/kubenetes/image-20200612005524778.png" alt="img"></p><p>Deployment主要功能有下面几个：</p><ul><li>支持ReplicaSet的所有功能</li><li>支持发布的停止、继续</li><li>支持滚动升级和回滚版本</li></ul><p>Deployment的资源清单文件：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apps/v1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 版本号</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Deployment</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 类型       </span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 元数据</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># rs名称 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 所属命名空间 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#标签</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">controller</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">deploy</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 详情描述</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">replicas</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 副本数量</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">revisionHistoryLimit</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 保留历史版本</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">paused</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 暂停部署，默认是false</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">progressDeadlineSeconds</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 部署超时时间（s），默认是600</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">strategy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 策略</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">RollingUpdate</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 滚动更新策略</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">rollingUpdate</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 滚动更新</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">maxSurge</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">30%</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 最大额外可以存在的副本数，可以为百分比，也可以为整数</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">maxUnavailable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">30%</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 最大不可用状态的 Pod 的最大值，可以为百分比，也可以为整数</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 选择器，通过它指定该控制器管理哪些pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;"># Labels匹配规则</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchExpressions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># Expressions匹配规则</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">operator</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">In</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">nginx-pod</span><span style="color:#89DDFF;">]}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 模板，当副本数量不足时，会根据下面的模板创建pod副本</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">containerPort</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><strong>创建deployment</strong></p><p>创建pc-deployment.yaml，内容如下：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apps/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Deployment</span><span style="color:#A6ACCD;">      </span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pc-deployment</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dev</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">replicas</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:1.17.1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 创建deployment</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl create -f pc-deployment.yaml --record=true</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看deployment</span></span>
<span class="line"><span style="color:#676E95;"># UP-TO-DATE 最新版本的pod的数量</span></span>
<span class="line"><span style="color:#676E95;"># AVAILABLE  当前可用的pod的数量</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get deploy pc-deployment -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME            READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment   3/3     3            3           15s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看rs</span></span>
<span class="line"><span style="color:#676E95;"># 发现rs的名称是在原来deployment的名字后面添加了一个10位数的随机串</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get rs -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                       DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78   3         3         3       23s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看pod</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-d2c8n   1/1     Running   0          107s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-smpvp   1/1     Running   0          107s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-wvjd8   1/1     Running   0          107s</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>扩缩容</strong></p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 变更副本数量为5个</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl scale deploy pc-deployment --replicas=5  -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment scaled</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看deployment</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get deploy pc-deployment -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME            READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment   5/5     5            5           2m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看pod</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;">#  kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-d2c8n   1/1     Running   0          4m19s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-jxmdq   1/1     Running   0          94s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-mktqv   1/1     Running   0          93s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-smpvp   1/1     Running   0          4m19s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-wvjd8   1/1     Running   0          4m19s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 编辑deployment的副本数量，修改spec:replicas: 4即可</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl edit deploy pc-deployment -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment edited</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看pod</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-d2c8n   1/1     Running   0          5m23s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-jxmdq   1/1     Running   0          2m38s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-smpvp   1/1     Running   0          5m23s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78-wvjd8   1/1     Running   0          5m23s</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><strong>镜像更新</strong></p><p>deployment支持两种更新策略:<code>重建更新</code>和<code>滚动更新</code>,可以通过<code>strategy</code>指定策略类型,支持两个属性:</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#C3E88D;">strategy：指定新的Pod替换旧的Pod的策略， 支持两个属性：</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">type：指定策略类型，支持两种策略</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">Recreate：在创建出新的Pod之前会先杀掉所有已存在的Pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">RollingUpdate：滚动更新，就是杀死一部分，就启动一部分，在更新过程中，存在两个版本Pod</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">rollingUpdate：当type为RollingUpdate时生效，用于为RollingUpdate设置参数，支持两个属性：</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">maxUnavailable：用来指定在升级过程中不可用Pod的最大数量，默认为25%。</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">maxSurge： 用来指定在升级过程中可以超过期望的Pod的最大数量，默认为25%。</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>重建更新</p><ol><li>编辑pc-deployment.yaml,在spec节点下添加更新策略</li></ol><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">strategy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 策略</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Recreate</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 重建更新</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>创建deploy进行验证</li></ol><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 变更镜像</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment image updated</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 观察升级过程</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;">#  kubectl get pods -n dev -w</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9-65qcw   1/1     Running   0          31s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9-w5nzv   1/1     Running   0          31s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9-xpt7w   1/1     Running   0          31s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9-xpt7w   1/1     Terminating   0          41s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9-65qcw   1/1     Terminating   0          41s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9-w5nzv   1/1     Terminating   0          41s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b-grn8z   0/1     Pending       0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b-hbl4v   0/1     Pending       0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b-67nz2   0/1     Pending       0          0s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b-grn8z   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b-hbl4v   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b-67nz2   0/1     ContainerCreating   0          0s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b-grn8z   1/1     Running             0          1s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b-67nz2   1/1     Running             0          1s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b-hbl4v   1/1     Running             0          2s</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>滚动更新</p><ol><li>编辑pc-deployment.yaml,在spec节点下添加更新策略</li></ol><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">strategy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 策略</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">RollingUpdate</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 滚动更新策略</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">rollingUpdate</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">maxSurge</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">25%</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">maxUnavailable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">25%</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>创建deploy进行验证</li></ol><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 变更镜像</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev </span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment image updated</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 观察升级过程</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev -w</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                           READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d767-8rbzt   1/1     Running   0          31m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d767-h4p68   1/1     Running   0          31m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d767-hlmz4   1/1     Running   0          31m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d767-rrqcn   1/1     Running   0          31m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-226rx   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-226rx   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-226rx   1/1     Running             0          1s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d767-h4p68    0/1     Terminating         0          34m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-cnd44   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-cnd44   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-cnd44   1/1     Running             0          2s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d767-hlmz4    0/1     Terminating         0          34m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-px48p   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-px48p   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-px48p   1/1     Running             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d767-8rbzt    0/1     Terminating         0          34m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-dkmqp   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-dkmqp   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44-dkmqp   1/1     Running             0          2s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d767-rrqcn    0/1     Terminating         0          34m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 至此，新版本的pod创建完毕，就版本的pod销毁完毕</span></span>
<span class="line"><span style="color:#676E95;"># 中间过程是滚动进行的，也就是边销毁边创建</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>滚动更新的过程：</p><p><img src="/guo-notes/kubenetes/image-20200416140251491.png" alt="img"></p><p>镜像更新中rs的变化</p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 查看rs,发现原来的rs的依旧存在，只是pod数量变为了0，而后又新产生了一个rs，pod数量为4</span></span>
<span class="line"><span style="color:#676E95;"># 其实这就是deployment能够进行版本回退的奥妙所在，后面会详细解释</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get rs -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                       DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78   0         0         0       7m37s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b11   0         0         0       5m37s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d76789   4         4         4       72s</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>版本回退</strong></p><p>deployment支持版本升级过程中的暂停、继续功能以及版本回退等诸多功能，下面具体来看.</p><p>kubectl rollout： 版本升级相关功能，支持下面的选项：</p><ul><li>status 显示当前升级状态</li><li>history 显示 升级历史记录</li><li>pause 暂停版本升级过程</li><li>resume 继续已经暂停的版本升级过程</li><li>restart 重启版本升级过程</li><li>undo 回滚到上一级版本（可以使用--to-revision回滚到指定版本）</li></ul><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 查看当前升级版本的状态</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl rollout status deploy pc-deployment -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pc-deployment</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> successfully rolled out</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看升级历史记录</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl rollout history deploy pc-deployment -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment</span></span>
<span class="line"><span style="color:#A6ACCD;">REVISION  CHANGE-CAUSE</span></span>
<span class="line"><span style="color:#A6ACCD;">1         kubectl create --filename=pc-deployment.yaml --record=true</span></span>
<span class="line"><span style="color:#A6ACCD;">2         kubectl create --filename=pc-deployment.yaml --record=true</span></span>
<span class="line"><span style="color:#A6ACCD;">3         kubectl create --filename=pc-deployment.yaml --record=true</span></span>
<span class="line"><span style="color:#676E95;"># 可以发现有三次版本记录，说明完成过两次升级</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 版本回滚</span></span>
<span class="line"><span style="color:#676E95;"># 这里直接使用--to-revision=1回滚到了1版本， 如果省略这个选项，就是回退到上个版本，就是2版本</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment rolled back</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看发现，通过nginx镜像版本可以发现到了第一版</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get deploy -n dev -o wide</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment   4/4     4            4           74m   nginx        nginx:1.17.1   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看rs，发现第一个rs中有4个pod运行，后面两个版本的rs中pod为运行</span></span>
<span class="line"><span style="color:#676E95;"># 其实deployment之所以可是实现版本的回滚，就是通过记录下历史rs来实现的，</span></span>
<span class="line"><span style="color:#676E95;"># 一旦想回滚到哪个版本，只需要将当前版本pod数量降为0，然后将回滚版本的pod提升为目标数量就可以了</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get rs -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                       DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6696798b78   4         4         4       78m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-966bf7f44    0         0         0       37m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-c848d767     0         0         0       71m</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>金丝雀发布</strong></p><p>Deployment控制器支持控制更新过程中的控制，如“暂停(pause)”或“继续(resume)”更新操作。</p><p>比如有一批新的Pod资源创建完成后立即暂停更新过程，此时，仅存在一部分新版本的应用，主体部分还是旧的版本。然后，再筛选一小部分的用户请求路由到新版本的Pod应用，继续观察能否稳定地按期望的方式运行。确定没问题之后再继续完成余下的Pod资源滚动更新，否则立即回滚更新操作。这就是所谓的金丝雀发布。</p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 更新deployment的版本，并配置暂停deployment</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;">#  kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev &amp;&amp; kubectl rollout pause deployment pc-deployment  -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment image updated</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment paused</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#观察更新状态</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl rollout status deploy pc-deployment -n dev　</span></span>
<span class="line"><span style="color:#A6ACCD;">Waiting </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> deployment </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pc-deployment</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> rollout to finish: 2 out of 4 new replicas have been updated...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 监控更新的过程，可以看到已经新增了一个资源，但是并未按照预期的状态去删除一个旧的资源，就是因为使用了pause暂停命令</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get rs -n dev -o wide</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   </span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9-rj8sq   1/1     Running   0          7m33s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9-ttwgg   1/1     Running   0          7m35s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9-v4wvc   1/1     Running   0          7m34s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6c9f56fcfb-996rt   1/1     Running   0          3m31s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          3m31s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 确保更新的pod没问题了，继续更新</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl rollout resume deploy pc-deployment -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/pc-deployment resumed</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看最后的更新情况</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get rs -n dev -o wide</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                             READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6c9f56fcfb-7bfwh   1/1     Running   0          37s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6c9f56fcfb-996rt   1/1     Running   0          5m27s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          5m27s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-deployment-6c9f56fcfb-rf84v   1/1     Running   0          37s</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p><strong>删除Deployment</strong></p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 删除deployment，其下的rs和pod也将被删除</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl delete -f pc-deployment.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pc-deployment</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> deleted</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="四、horizontal-pod-autoscaler-hpa" tabindex="-1">四、Horizontal Pod Autoscaler(HPA) <a class="header-anchor" href="#四、horizontal-pod-autoscaler-hpa" aria-hidden="true">#</a></h2><p>在前面的课程中，我们已经可以实现通过手工执行<code>kubectl scale</code>命令实现Pod扩容或缩容，但是这显然不符合Kubernetes的定位目标--自动化、智能化。 Kubernetes期望可以实现通过监测Pod的使用情况，实现pod数量的自动调整，于是就产生了Horizontal Pod Autoscaler（HPA）这种控制器。</p><p>HPA可以获取每个Pod利用率，然后和HPA中定义的指标进行对比，同时计算出需要伸缩的具体值，最后实现Pod的数量的调整。其实HPA与之前的Deployment一样，也属于一种Kubernetes资源对象，它通过追踪分析RC控制的所有目标Pod的负载变化情况，来确定是否需要针对性地调整目标Pod的副本数，这是HPA的实现原理。</p><p><img src="/guo-notes/kubenetes/image-20200608155858271.png" alt="img"></p><p>接下来，我们来做一个实验</p><p><strong>1 安装metrics-server</strong></p><p>metrics-server可以用来收集集群中的资源使用情况</p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 安装git</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># yum install git -y</span></span>
<span class="line"><span style="color:#676E95;"># 获取metrics-server, 注意使用的版本</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server</span></span>
<span class="line"><span style="color:#676E95;"># 修改deployment, 注意修改的是镜像和初始化参数</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># cd /root/metrics-server/deploy/1.8+/</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 1.8+</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># vim metrics-server-deployment.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">按图中添加下面选项</span></span>
<span class="line"><span style="color:#A6ACCD;">hostNetwork: </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6</span></span>
<span class="line"><span style="color:#A6ACCD;">args:</span></span>
<span class="line"><span style="color:#A6ACCD;">- --kubelet-insecure-tls</span></span>
<span class="line"><span style="color:#A6ACCD;">- --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="/guo-notes/kubenetes/image-20200608163326496.png" alt="image-20200608163326496"></p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 安装metrics-server</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 1.8+</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kubectl apply -f ./</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看pod运行情况</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 1.8+</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kubectl get pod -n kube-system</span></span>
<span class="line"><span style="color:#A6ACCD;">metrics-server-6b976979db-2xwbj   1/1     Running   0          90s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 使用kubectl top node 查看资源使用情况</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 1.8+</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kubectl top node</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME           CPU</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">cores</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">   CPU%   MEMORY</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">   MEMORY%</span></span>
<span class="line"><span style="color:#A6ACCD;">k8s-master01   289m         14%    1582Mi          54%       </span></span>
<span class="line"><span style="color:#A6ACCD;">k8s-node01     81m          4%     1195Mi          40%       </span></span>
<span class="line"><span style="color:#A6ACCD;">k8s-node02     72m          3%     1211Mi          41%  </span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 1.8+</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kubectl top pod -n kube-system</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                              CPU</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">cores</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">   MEMORY</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">bytes</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">coredns-6955765f44-7ptsb          3m           9Mi</span></span>
<span class="line"><span style="color:#A6ACCD;">coredns-6955765f44-vcwr5          3m           8Mi</span></span>
<span class="line"><span style="color:#A6ACCD;">etcd-master                       14m          145Mi</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#676E95;"># 至此,metrics-server安装完成</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>2 准备deployment和servie</strong></p><p>创建pc-hpa-pod.yaml文件，内容如下：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apps/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Deployment</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dev</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">strategy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 策略</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">RollingUpdate</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 滚动更新策略</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">replicas</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">resources</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 资源配额</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">limits</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 限制资源（上限）</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">cpu</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># CPU限制，单位是core数</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">requests</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 请求资源（下限）</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">cpu</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100m</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># CPU限制，单位是core数</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 创建service</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 1.8+</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kubectl expose deployment nginx --type=NodePort --port=80 -n dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 查看</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 1.8+</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kubectl get deployment,pod,svc -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                    READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">deployment.apps/nginx   1/1     1            1           47s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">NAME                         READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pod/nginx-7df9756ccc-bh8dr   1/1     Running   0          47s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">NAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">S</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">        AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">service/nginx   NodePort   10.101.18.29   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">        80:31830/TCP   35s</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>3 部署HPA</strong></p><p>创建pc-hpa.yaml文件，内容如下：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">autoscaling/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HorizontalPodAutoscaler</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pc-hpa</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dev</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">minReplicas</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#最小pod数量</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">maxReplicas</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#最大pod数量</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">targetCPUUtilizationPercentage</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># CPU使用率指标</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">scaleTargetRef</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;"># 指定要控制的nginx信息</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apps/v1</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Deployment</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 创建hpa</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 1.8+</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kubectl create -f pc-hpa.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">horizontalpodautoscaler.autoscaling/pc-hpa created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看hpa</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 1.8+</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kubectl get hpa -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME     REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa   Deployment/nginx   0%/3%     1         10        1          62s</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>4 测试</strong></p><p>使用压测工具对service地址<code>192.168.5.4:31830</code>进行压测，然后通过控制台查看hpa和pod的变化</p><p>hpa变化</p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get hpa -n dev -w</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME   REFERENCE      TARGETS  MINPODS  MAXPODS  REPLICAS  AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa  Deployment/nginx  0%/3%   1     10     1      4m11s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa  Deployment/nginx  0%/3%   1     10     1      5m19s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa  Deployment/nginx  22%/3%   1     10     1      6m50s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa  Deployment/nginx  22%/3%   1     10     4      7m5s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa  Deployment/nginx  22%/3%   1     10     8      7m21s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa  Deployment/nginx  6%/3%   1     10     8      7m51s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa  Deployment/nginx  0%/3%   1     10     8      9m6s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa  Deployment/nginx  0%/3%   1     10     8      13m</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-hpa  Deployment/nginx  0%/3%   1     10     1      14m</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>deployment变化</p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get deployment -n dev -w</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/1     1            1           11m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/4     1            1           13m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/4     1            1           13m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/4     1            1           13m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/4     4            1           13m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/8     4            1           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/8     4            1           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/8     4            1           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/8     8            1           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   2/8     8            2           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   3/8     8            3           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   4/8     8            4           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   5/8     8            5           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   6/8     8            6           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   7/8     8            7           14m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   8/8     8            8           15m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   8/1     8            8           20m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   8/1     8            8           20m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx   1/1     1            1           20m</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>pod变化</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">[root@k8s-master01 ~]# kubectl get pods -n dev -w</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                     READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-bh8dr   1/1     Running   0          11m</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-cpgrv   0/1     Pending   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-8zhwk   0/1     Pending   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-rr9bn   0/1     Pending   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-cpgrv   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-8zhwk   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-rr9bn   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-m9gsj   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-g56qb   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-sl9c6   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-fgst7   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-g56qb   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-m9gsj   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-sl9c6   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-fgst7   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-8zhwk   1/1     Running             0          19s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-rr9bn   1/1     Running             0          30s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-m9gsj   1/1     Running             0          21s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-cpgrv   1/1     Running             0          47s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-sl9c6   1/1     Running             0          33s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-g56qb   1/1     Running             0          48s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-fgst7   1/1     Running             0          66s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-fgst7   1/1     Terminating         0          6m50s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-8zhwk   1/1     Terminating         0          7m5s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-cpgrv   1/1     Terminating         0          7m5s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-g56qb   1/1     Terminating         0          6m50s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-rr9bn   1/1     Terminating         0          7m5s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-m9gsj   1/1     Terminating         0          6m50s</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx-7df9756ccc-sl9c6   1/1     Terminating         0          6m50s</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="五、daemonset-ds" tabindex="-1">五、DaemonSet(DS) <a class="header-anchor" href="#五、daemonset-ds" aria-hidden="true">#</a></h2><p>DaemonSet类型的控制器可以保证在集群中的每一台（或指定）节点上都运行一个副本。一般适用于日志收集、节点监控等场景。也就是说，如果一个Pod提供的功能是节点级别的（每个节点都需要且只需要一个），那么这类Pod就适合使用DaemonSet类型的控制器创建。</p><p><img src="/guo-notes/kubenetes/image-20200612010223537.png" alt="img"></p><p>DaemonSet控制器的特点：</p><ul><li>每当向集群中添加一个节点时，指定的 Pod 副本也将添加到该节点上</li><li>当节点从集群中移除时，Pod 也就被垃圾回收了</li></ul><p>下面先来看下DaemonSet的资源清单文件</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apps/v1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 版本号</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DaemonSet</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 类型       </span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 元数据</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># rs名称 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 所属命名空间 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#标签</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">controller</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">daemonset</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 详情描述</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">revisionHistoryLimit</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 保留历史版本</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">updateStrategy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 更新策略</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">RollingUpdate</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 滚动更新策略</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">rollingUpdate</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 滚动更新</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">maxUnavailable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 最大不可用状态的 Pod 的最大值，可以为百分比，也可以为整数</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 选择器，通过它指定该控制器管理哪些pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;"># Labels匹配规则</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchExpressions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># Expressions匹配规则</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">operator</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">In</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">nginx-pod</span><span style="color:#89DDFF;">]}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 模板，当副本数量不足时，会根据下面的模板创建pod副本</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">containerPort</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">80</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>创建pc-daemonset.yaml，内容如下：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apps/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DaemonSet</span><span style="color:#A6ACCD;">      </span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pc-daemonset</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dev</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:1.17.1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 创建daemonset</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl create -f  pc-daemonset.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">daemonset.apps/pc-daemonset created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看daemonset</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;">#  kubectl get ds -n dev -o wide</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE   AGE   CONTAINERS   IMAGES         </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看pod,发现在每个Node上都运行一个pod</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;">#  kubectl get pods -n dev -o wide</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                 READY   STATUS    RESTARTS   AGE   IP            NODE    </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-daemonset-9bck8   1/1     Running   0          37s   10.244.1.43   node1     </span></span>
<span class="line"><span style="color:#A6ACCD;">pc-daemonset-k224w   1/1     Running   0          37s   10.244.2.74   node2      </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 删除daemonset</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl delete -f pc-daemonset.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">daemonset.apps </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pc-daemonset</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> deleted</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="六、job" tabindex="-1">六、Job <a class="header-anchor" href="#六、job" aria-hidden="true">#</a></h2><p>Job，主要用于负责**批量处理(一次要处理指定数量任务)<strong>短暂的</strong>一次性(每个任务仅运行一次就结束)**任务。Job特点如下：</p><ul><li>当Job创建的pod执行成功结束时，Job将记录成功结束的pod数量</li><li>当成功结束的pod达到指定的数量时，Job将完成执行</li></ul><p><img src="/guo-notes/kubenetes/image-20200618213054113.png" alt="img"></p><p>Job的资源清单文件：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">batch/v1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 版本号</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Job</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 类型       </span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 元数据</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># rs名称 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 所属命名空间 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#标签</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">controller</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">job</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 详情描述</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">completions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 指定job需要成功运行Pods的次数。默认值: 1</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">parallelism</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 指定job在任一时刻应该并发运行Pods的数量。默认值: 1</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">activeDeadlineSeconds</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 指定job可运行的时间期限，超过时间还未结束，系统将会尝试进行终止。</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">backoffLimit</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 指定job失败后进行重试的次数。默认是6</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">manualSelector</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 是否可以使用selector选择器选择pod，默认是false</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 选择器，通过它指定该控制器管理哪些pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;"># Labels匹配规则</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchExpressions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># Expressions匹配规则</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">operator</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">In</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">counter-pod</span><span style="color:#89DDFF;">]}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 模板，当副本数量不足时，会根据下面的模板创建pod副本</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">restartPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Never</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 重启策略只能设置为Never或者OnFailure</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">busybox:1.30</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">command</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bin/sh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">关于重启策略设置的说明：</span></span>
<span class="line"><span style="color:#A6ACCD;">    如果指定为OnFailure，则job会在pod出现故障时重启容器，而不是创建pod，failed次数不变</span></span>
<span class="line"><span style="color:#A6ACCD;">    如果指定为Never，则job会在pod出现故障时创建新的pod，并且故障pod不会消失，也不会重启，failed次数加1</span></span>
<span class="line"><span style="color:#A6ACCD;">    如果指定为Always的话，就意味着一直重启，意味着job任务会重复去执行了，当然不对，所以不能设置为Always</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>创建pc-job.yaml，内容如下：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">batch/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Job</span><span style="color:#A6ACCD;">      </span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pc-job</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dev</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">manualSelector</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">restartPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Never</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">busybox:1.30</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">command</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bin/sh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 创建job</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl create -f pc-job.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">job.batch/pc-job created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看job</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get job -n dev -o wide  -w</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME     COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES         SELECTOR</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job   0/1           21s        21s   counter      busybox:1.30   app=counter-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job   1/1           31s        79s   counter      busybox:1.30   app=counter-pod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 通过观察pod状态可以看到，pod在运行完毕任务后，就会变成Completed状态</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev -w</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME           READY   STATUS     RESTARTS      AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-rxg96   1/1     Running     0            29s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-rxg96   0/1     Completed   0            33s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 接下来，调整下pod运行的总数量和并行数量 即：在spec下设置下面两个选项</span></span>
<span class="line"><span style="color:#676E95;">#  completions: 6 # 指定job需要成功运行Pods的次数为6</span></span>
<span class="line"><span style="color:#676E95;">#  parallelism: 3 # 指定job并发运行Pods的数量为3</span></span>
<span class="line"><span style="color:#676E95;">#  然后重新运行job，观察效果，此时会发现，job会每次运行3个pod，总共执行了6个pod</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev -w</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME           READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-684ft   1/1     Running   0          5s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-jhj49   1/1     Running   0          5s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-pfcvh   1/1     Running   0          5s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-684ft   0/1     Completed   0          11s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-v7rhr   0/1     Pending     0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-v7rhr   0/1     Pending     0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-v7rhr   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-jhj49   0/1     Completed           0          11s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-fhwf7   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-fhwf7   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-pfcvh   0/1     Completed           0          11s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-5vg2j   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-fhwf7   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-5vg2j   0/1     Pending             0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-5vg2j   0/1     ContainerCreating   0          0s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-fhwf7   1/1     Running             0          2s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-v7rhr   1/1     Running             0          2s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-5vg2j   1/1     Running             0          3s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-fhwf7   0/1     Completed           0          12s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-v7rhr   0/1     Completed           0          12s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-job-5vg2j   0/1     Completed           0          12s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 删除job</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl delete -f pc-job.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">job.batch </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pc-job</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> deleted</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h2 id="七、cronjob-cj" tabindex="-1">七、CronJob(CJ) <a class="header-anchor" href="#七、cronjob-cj" aria-hidden="true">#</a></h2><p>CronJob控制器以Job控制器资源为其管控对象，并借助它管理pod资源对象，Job控制器定义的作业任务在其控制器资源创建之后便会立即执行，但CronJob可以以类似于Linux操作系统的周期性任务作业计划的方式控制其运行<strong>时间点</strong>及<strong>重复运行</strong>的方式。也就是说，<strong>CronJob可以在特定的时间点(反复的)去运行job任务</strong>。</p><p><img src="/guo-notes/kubenetes/image-20200618213149531.png" alt="img"></p><p>CronJob的资源清单文件：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">batch/v1beta1</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 版本号</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CronJob</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 类型       </span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 元数据</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># rs名称 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 所属命名空间 </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#标签</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">controller</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cronjob</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 详情描述</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">schedule</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># cron格式的作业调度运行时间点,用于控制任务在什么时间执行</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">concurrencyPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 并发执行策略，用于定义前一次作业运行尚未完成时是否以及如何运行后一次的作业</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">failedJobHistoryLimit</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 为失败的任务执行保留的历史记录数，默认为1</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">successfulJobHistoryLimit</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 为成功的任务执行保留的历史记录数，默认为3</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">startingDeadlineSeconds</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 启动作业错误的超时时长</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">jobTemplate</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># job控制器模板，用于为cronjob控制器生成job对象;下面其实就是job的定义</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">completions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">parallelism</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">activeDeadlineSeconds</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">backoffLimit</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">manualSelector</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">selector</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">matchLabels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">matchExpressions</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">规则</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">operator</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">In</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">counter-pod</span><span style="color:#89DDFF;">]}</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter-pod</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">restartPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Never</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">busybox:1.30</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">command</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bin/sh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#C3E88D;">需要重点解释的几个选项：</span></span>
<span class="line"><span style="color:#F07178;">schedule</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cron表达式，用于指定任务的执行时间</span></span>
<span class="line"><span style="color:#A6ACCD;">    *</span><span style="color:#C3E88D;">/1    *      *    *     *</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">&lt;分钟&gt; &lt;小时&gt; &lt;日&gt; &lt;月份&gt; &lt;星期&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">分钟 值从 0 到 59.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">小时 值从 0 到 23.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">日 值从 1 到 31.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">月 值从 1 到 12.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">星期 值从 0 到 6, 0 代表星期日</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">多个时间可以用逗号隔开； 范围可以用连字符给出；*可以作为通配符； /表示每...</span></span>
<span class="line"><span style="color:#F07178;">concurrencyPolicy</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Allow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">允许Jobs并发运行(默认)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Forbid</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">禁止并发运行，如果上一次运行尚未完成，则跳过下一次运行</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">Replace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">替换，取消当前正在运行的作业并用新作业替换它</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>创建pc-cronjob.yaml，内容如下：</p><div class="language-yaml line-numbers-mode"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">batch/v1beta1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CronJob</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pc-cronjob</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dev</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">labels</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">controller</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cronjob</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">schedule</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*/1 * * * *</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">jobTemplate</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">restartPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Never</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">containers</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">counter</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">busybox:1.30</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">command</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bin/sh</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-c</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;"># 创建cronjob</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl create -f pc-cronjob.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">cronjob.batch/pc-cronjob created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看cronjob</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get cronjobs -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME         SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-cronjob   </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">/1 </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">   False     0        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">none</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">          6s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看job</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get jobs -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">NAME                    COMPLETIONS   DURATION   AGE</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-cronjob-1592587800   1/1           28s        3m26s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-cronjob-1592587860   1/1           28s        2m26s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-cronjob-1592587920   1/1           28s        86s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 查看pod</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl get pods -n dev</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-cronjob-1592587800-x4tsm   0/1     Completed   0          2m24s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-cronjob-1592587860-r5gv4   0/1     Completed   0          84s</span></span>
<span class="line"><span style="color:#A6ACCD;">pc-cronjob-1592587920-9dxxq   1/1     Running     0          24s</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 删除cronjob</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@k8s-master01 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># kubectl  delete -f pc-cronjob.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;">cronjob.batch </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pc-cronjob</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> deleted</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-37ebe389 data-v-a54a85bd><div class="edit-info" data-v-a54a85bd><!----><div class="last-updated" data-v-a54a85bd><p class="VPLastUpdated" data-v-a54a85bd data-v-f7d51a9c>Last updated: <time datatime="2023-03-31T09:47:16.000Z" data-v-f7d51a9c></time></p></div></div><div class="prev-next" data-v-a54a85bd><div class="pager" data-v-a54a85bd><a class="pager-link prev" href="/guo-notes/classify/Kubernetes/Pod%E8%AF%A6%E8%A7%A3.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Previous page</span><span class="title" data-v-a54a85bd>五、Pod详解</span></a></div><div class="has-prev pager" data-v-a54a85bd><a class="pager-link next" href="/guo-notes/classify/Kubernetes/Service%E8%AF%A6%E8%A7%A3.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Next page</span><span class="title" data-v-a54a85bd>七、Service详解</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"classify_docker_docker compose服务编排.md\":\"c20f24ce\",\"classify_docker_dockerhub和私人仓库.md\":\"7966b483\",\"classify_docker_dockerfile.md\":\"d2593180\",\"classify_docker_docker介绍.md\":\"c96fba9a\",\"classify_docker_docker命令.md\":\"9ec063b5\",\"classify_docker_docker安装和启动.md\":\"29436185\",\"classify_docker_docker架构.md\":\"93b9fe2a\",\"classify_elasticsearch_elasticsearch介绍.md\":\"0dffb7ab\",\"classify_elasticsearch_elasticsearch.md\":\"2bef181a\",\"classify_kafka_kafka.md\":\"271858b3\",\"classify_kubernetes_dashboard.md\":\"2aba9d2f\",\"classify_kubernetes_kubernetes介绍.md\":\"bdd0fffc\",\"classify_kubernetes_kubernetes实战入门.md\":\"ba246c0f\",\"classify_kubernetes_kubernetes资源管理.md\":\"86860141\",\"classify_kubernetes_kubernetes集群环境搭建.md\":\"5723fa45\",\"classify_kubernetes_pod控制器详解.md\":\"9a9af285\",\"classify_kubernetes_pod详解.md\":\"93f4e4ce\",\"classify_kubernetes_service详解.md\":\"7e1f077a\",\"classify_kubernetes_安全认证.md\":\"466a56a5\",\"classify_kubernetes_数据存储.md\":\"0415bc76\",\"classify_nginx_nginx.md\":\"b7355728\",\"classify_rabbitmq_exchange核心概念.md\":\"ca83eea9\",\"classify_rabbitmq_mq的概念.md\":\"34462820\",\"classify_rabbitmq_mq的种类和对比.md\":\"c4ea3137\",\"classify_rabbitmq_rabbitmq命令行.md\":\"858c941e\",\"classify_rabbitmq_rabbitmq工作模式.md\":\"0faa2b8f\",\"classify_rabbitmq_rabbitmq应用方案.md\":\"d519a977\",\"classify_rabbitmq_rabbitmq的安装和启动.md\":\"c1f8cd90\",\"classify_rabbitmq_rabbitmq简介.md\":\"851f183f\",\"classify_rabbitmq_rabbitmq管控台介绍.md\":\"214b60ac\",\"classify_rabbitmq_rabbitmq集群搭建.md\":\"aa5d2e84\",\"classify_rabbitmq_rabbitmq高级特性.md\":\"5276ae2c\",\"classify_rabbitmq_rabbitmq高级特性1.md\":\"32cc2fd5\",\"classify_redis_redis主从.md\":\"fbe16f7a\",\"classify_redis_redis事务.md\":\"2390cf48\",\"classify_redis_redis五大数据类型实现原理.md\":\"1ad1000e\",\"classify_redis_redis介绍.md\":\"ef213988\",\"classify_redis_redis内存回收.md\":\"3356df32\",\"classify_redis_redis内存淘汰策略.md\":\"38f25ce5\",\"classify_redis_redis内存碎片率.md\":\"cc35eb3c\",\"classify_redis_redis分布式锁.md\":\"b6313214\",\"classify_redis_redis哨兵.md\":\"07969791\",\"classify_redis_redis底层数据结构.md\":\"bf7150eb\",\"classify_redis_redis慢查询和管道.md\":\"b63d30ce\",\"classify_redis_redis持久化.md\":\"6b856703\",\"classify_redis_redis数据类型简介.md\":\"0fa07b71\",\"classify_redis_redis缓存击穿、穿透、雪崩.md\":\"48ab9260\",\"classify_redis_redis配置文件解析.md\":\"eab89fca\",\"classify_redis_redis集群.md\":\"8b2625d9\",\"classify_algorithm_concept_复杂度-时间复杂度和空间复杂度.md\":\"9bbe3cfc\",\"classify_algorithm_concept_数据结构-堆.md\":\"e9fcd18c\",\"classify_algorithm_concept_数据结构-栈与队列.md\":\"1649e79a\",\"classify_algorithm_concept_数据结构-树.md\":\"99b26d0a\",\"classify_algorithm_concept_算法-排序算法.md\":\"dfeac19c\",\"classify_algorithm_concept_算法-查找算法.md\":\"d4172e41\",\"classify_algorithm_concept_算法-深度优先搜索和广度优先搜索.md\":\"ed5a74dc\",\"classify_algorithm_index.md\":\"70a4247d\",\"classify_algorithm_title_leetcode-1.md\":\"97167b82\",\"classify_algorithm_title_leetcode-101.md\":\"169c1d7e\",\"classify_algorithm_title_leetcode-104.md\":\"d9f3d88f\",\"classify_algorithm_title_leetcode-110.md\":\"42af6667\",\"classify_algorithm_title_leetcode-141.md\":\"c83b5c2c\",\"classify_algorithm_title_leetcode-142.md\":\"ea742479\",\"classify_algorithm_title_leetcode-144.md\":\"502e50ee\",\"classify_algorithm_title_leetcode-145.md\":\"ac6f8a57\",\"classify_algorithm_title_leetcode-160.md\":\"8ee67432\",\"classify_algorithm_title_leetcode-206.md\":\"916e9f95\",\"classify_algorithm_title_leetcode-21.md\":\"b73b74c4\",\"classify_algorithm_title_leetcode-226.md\":\"05b158a6\",\"classify_algorithm_title_leetcode-232.md\":\"acbcc120\",\"classify_algorithm_title_leetcode-234.md\":\"2bb7b40f\",\"classify_algorithm_title_leetcode-283.md\":\"407f8d68\",\"classify_algorithm_title_leetcode-394.md\":\"8282f246\",\"classify_algorithm_title_leetcode-448.md\":\"06412241\",\"classify_algorithm_title_leetcode-70.md\":\"e1a01d97\",\"classify_algorithm_title_leetcode-83.md\":\"450582de\",\"classify_algorithm_title_leetcode-876.md\":\"d7c88313\",\"classify_algorithm_title_leetcode-88.md\":\"71583806\",\"classify_algorithm_title_leetcode-912.md\":\"94e82c59\",\"classify_algorithm_title_leetcode-94.md\":\"d7eb9c5f\",\"classify_algorithm_title_leetcode-模板.md\":\"15952ccd\",\"classify_algorithm_title_剑指offer-22.md\":\"9e6ee8fe\",\"classify_algorithm_其他-设计.md\":\"d869eb56\",\"classify_algorithm_基础-排序.md\":\"5e207860\",\"classify_algorithm_基础数据结构-哈希表.md\":\"4400d155\",\"classify_algorithm_基础数据结构-字符串.md\":\"8b25d2a5\",\"classify_algorithm_基础数据结构-数组.md\":\"232a2a2a\",\"classify_algorithm_基础数据结构-栈.md\":\"ddc26427\",\"classify_algorithm_基础数据结构-树.md\":\"82751015\",\"classify_algorithm_基础数据结构-链表.md\":\"e237c21d\",\"classify_algorithm_基础数据结构-队列.md\":\"4ddc7b60\",\"classify_algorithm_技巧-双指针.md\":\"c7b5b6b8\",\"classify_algorithm_数学-斐波那契数列.md\":\"189a5e43\",\"classify_algorithm_数学-相遇问题.md\":\"c099b19a\",\"classify_algorithm_算法-动态规划.md\":\"ad669e71\",\"classify_algorithm_算法-广度优先搜索.md\":\"e914a373\",\"classify_algorithm_算法-排序.md\":\"a318401e\",\"classify_algorithm_算法-深度优先搜索.md\":\"edbdbee9\",\"classify_algorithm_算法-迭代.md\":\"0c806462\",\"classify_algorithm_算法-递归.md\":\"d090c071\",\"classify_mysql_mvcc多版本并发控制.md\":\"e8f042e6\",\"classify_mysql_mysql三大日志.md\":\"2a929292\",\"classify_mysql_mysql主从复制.md\":\"b37d399a\",\"classify_mysql_mysql事务.md\":\"401143bd\",\"classify_mysql_mysql介绍.md\":\"e8407ace\",\"classify_mysql_mysql分区.md\":\"fccce89d\",\"classify_mysql_mysql分库分表.md\":\"a7979efc\",\"classify_mysql_mysql索引.md\":\"8e2cc567\",\"classify_mysql_mysql语法.md\":\"5c4376af\",\"classify_mysql_mysql读写分离.md\":\"7a2cc18a\",\"classify_mysql_mysql负载均衡和高可用.md\":\"f2a3546c\",\"classify_mysql_mysql锁.md\":\"b7a67ccf\",\"classify_mysql_sql语句优化.md\":\"1c91c4a6\",\"classify_mysql_sql语句执行流程.md\":\"b68ca90d\",\"classify_mysql_存储引擎.md\":\"2287bb5c\",\"classify_mysql_性能分析.md\":\"a7f46a02\",\"classify_mysql_物理文件.md\":\"ea689ff2\",\"classify_mysql_管理常用工具.md\":\"0b550cce\",\"classify_sundry_concept_存储单位与速率单位.md\":\"dab70d5e\",\"classify_sundry_concept_性能指标.md\":\"90daef71\",\"classify_sundry_tools_git_github 连接失败.md\":\"e0f01a6b\",\"classify_sundry_tools_vscode_vscode 启动 debug.md\":\"bc7b39e5\",\"classify_框架学习_laravel_artisan控制台命令.md\":\"4cc86e21\",\"classify_框架学习_laravel_生命周期相关核心概念.md\":\"c3ee6d8c\",\"classify_解决方案_redis主从存在的问题和解决方案.md\":\"7b664f16\",\"classify_解决方案_数据库与缓存一致性解决方案.md\":\"3301e682\",\"classify_计算机基础_计算机网络_io模型.md\":\"d0633bc8\",\"classify_计算机基础_计算机网络_index.md\":\"a112e99b\",\"classify_设计模式.md\":\"e7af11bf\",\"classify_面试常问_web安全.md\":\"04eaeece\",\"classify_面试常问_一次网络请求的完整过程.md\":\"73fdf7de\",\"index.md\":\"c1d7d3b2\",\"preface_install.md\":\"e683ddc0\",\"preface_preface.md\":\"26138070\"}")</script>
    <script type="module" async src="/guo-notes/assets/app.8b821eb2.js"></script>
    
  </body>
</html>