<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>elasticsearch安装 | 技术博客，知识分享，学习笔记，问题解决方案</title>
    <meta name="description" content="啊郭的博客">
    <link rel="stylesheet" href="/guo-notes/assets/style.5e0eda6f.css">
    <link rel="modulepreload" href="/guo-notes/assets/app.b8d26054.js">
    <link rel="modulepreload" href="/guo-notes/assets/classify_Elasticsearch_elasticsearch.md.6dfcc0f5.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c6a644e1><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav no-sidebar" data-v-c6a644e1 data-v-a71a30f1><div class="VPNavBar" data-v-a71a30f1 data-v-6f1d18b5><div class="container" data-v-6f1d18b5><div class="VPNavBarTitle" data-v-6f1d18b5 data-v-d5925166><a class="title" href="/guo-notes/" data-v-d5925166><!--[--><!--]--><!----><!--[-->啊郭的博客<!--]--><!--[--><!--]--></a></div><div class="content" data-v-6f1d18b5><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6f1d18b5 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 后端技术 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Redis/redis%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Redis<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/mysql/mysql%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Mysql<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/RabbitMq/MQ%E7%9A%84%E6%A6%82%E5%BF%B5.html" data-v-e8e0fb1d data-v-3c355974><!--[-->RabbitMq<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Docker/Docker%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Docker<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Kubernetes/Kubernetes%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Kubernetes<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 计算机基础 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/计算机基础/计算机网络/" data-v-e8e0fb1d data-v-3c355974><!--[-->计算机网络<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guo-notes/classify/algorithm/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->算法<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 杂项 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6f1d18b5 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-1899cd41 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1899cd41><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1899cd41><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6f1d18b5 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/gyh-up?tab=repositories" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://blog.csdn.net/weixin_42258523?spm=1000.2115.3001.5343" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><embed src="https://g.csdnimg.cn/static/logo/favicon32.ico" style="border-radius: 100%;width: 20px;height: 20px;" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6f1d18b5 data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-1899cd41 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1899cd41><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1899cd41><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/gyh-up?tab=repositories" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://blog.csdn.net/weixin_42258523?spm=1000.2115.3001.5343" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><embed src="https://g.csdnimg.cn/static/logo/favicon32.ico" style="border-radius: 100%;width: 20px;height: 20px;" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6f1d18b5 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><!----><!----><div class="VPContent" id="VPContent" data-v-c6a644e1 data-v-c95df128><div class="VPDoc has-aside" data-v-c95df128 data-v-37ebe389><div class="container" data-v-37ebe389><div class="aside" data-v-37ebe389><div class="aside-curtain" data-v-37ebe389></div><div class="aside-container" data-v-37ebe389><div class="aside-content" data-v-37ebe389><div class="VPDocAside" data-v-37ebe389 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-37ebe389><div class="content-container" data-v-37ebe389><!--[--><!--]--><main class="main" data-v-37ebe389><div style="position:relative;" class="vp-doc _guo-notes_classify_Elasticsearch_elasticsearch" data-v-37ebe389><div><h1 id="elasticsearch安装" tabindex="-1">elasticsearch安装 <a class="header-anchor" href="#elasticsearch安装" aria-hidden="true">#</a></h1><p><strong>声明：JDK1.8 ，最低要求！</strong> ElasticSearch 客户端，界面工具！</p><p>Linux系统上必须安装JDK8.0以上版本（ES是Java语言写的，需要JDK支持）</p><h2 id="下载" tabindex="-1">下载 <a class="header-anchor" href="#下载" aria-hidden="true">#</a></h2><p>官网：<a href="https://www.elastic.co/" target="_blank" rel="noreferrer">https://www.elastic.co/</a></p><p>下载地址：<a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noreferrer">https://www.elastic.co/cn/downloads/elasticsearch</a></p><h2 id="windows下安装" tabindex="-1">Windows下安装 <a class="header-anchor" href="#windows下安装" aria-hidden="true">#</a></h2><p>1、解压就可以使用了！</p><p>2、熟悉目录！</p><ul><li>bin 启动文件</li><li>config 配置文件</li><li>log4j2 日志配置文件</li><li>jvm.options java 虚拟机相关的配置</li><li>elasticsearch.yml ElasticSearch 的配置文件！ 默认 9200 端口！ 跨域！</li><li>lib 相关jar包</li><li>logs 日志</li><li>modules 功能模块</li><li>plugins 插件</li></ul><p>3、启动，访问9200；</p><p>4、访问测试！</p><p><img src="/guo-notes/assets/es-11.d53481f8.png" alt="image-20210903150553533"></p><h3 id="安装可视化界面-es-head的插件" tabindex="-1">安装可视化界面 es head的插件 <a class="header-anchor" href="#安装可视化界面-es-head的插件" aria-hidden="true">#</a></h3><ol><li><p>下载地址：<a href="https://github.com/mobz/elasticsearch-head/" target="_blank" rel="noreferrer">https://github.com/mobz/elasticsearch-head/</a></p></li><li><p>启动</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">npm install</span></span>
<span class="line"><span style="color:#A6ACCD;">npm run start</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>连接测试发现，存在跨域问题：配置es</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">http.cors.enabled: true</span></span>
<span class="line"><span style="color:#A6ACCD;">http.cors.allow-origin: &quot;*&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>重启es服务器，然后再次连接</p></li></ol><p><img src="/guo-notes/assets/es-12.12699b33.png" alt="image-20210903150655681"></p><h2 id="linux下安装" tabindex="-1">linux下安装 <a class="header-anchor" href="#linux下安装" aria-hidden="true">#</a></h2><ol><li><p>解压elasticsearch-7.6.1-linux-x86_64.tar.gz到/usr/local/目录：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">tar -xvf elasticsearch-7.6.1-linux-x86_64.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li><li><p>进入解压后的elasticsearch目录：</p></li></ol><p>（1）新建data</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir data</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/guo-notes/assets/es-13.1c966394.png" alt="image-20210824092428901"></p><p>（2）修改config/elasticsearch.yml：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">vi config/elasticsearch.yml</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>取消或者修改下列项注释并修改：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">cluster.name: my-application </span><span style="color:#676E95;">#集群名称</span></span>
<span class="line"><span style="color:#A6ACCD;">node.name: node-1 </span><span style="color:#676E95;">#节点名称</span></span>
<span class="line"><span style="color:#A6ACCD;">path.data: /usr/local/elasticsearch-7.6.1/data </span><span style="color:#676E95;">#数据的存储目录</span></span>
<span class="line"><span style="color:#A6ACCD;">path.logs: /usr/local/elasticsearch-7.6.1/logs </span><span style="color:#676E95;">#日志的存储目录</span></span>
<span class="line"><span style="color:#A6ACCD;">network.host: 0.0.0.0 </span><span style="color:#676E95;">#设置绑定的ip，设置为0.0.0.0以后就可以让任何计算机节点访问到了</span></span>
<span class="line"><span style="color:#A6ACCD;">http.port: 9200 </span><span style="color:#676E95;">#端口</span></span>
<span class="line"><span style="color:#A6ACCD;">cluster.initial_master_nodes: </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">node-1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#设置在集群中的所有节点名称，这个节点名称就是之前所修改的，当然你也可以采用默认的也行，目前是单机，放入一个节点即可</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>修改完毕后，:wq 保存退出vi</p><p>（3） 准备启动es</p><p>进入/bin目录执行命令：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">./elasticsearch</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="可能出现的错误" tabindex="-1">可能出现的错误 <a class="header-anchor" href="#可能出现的错误" aria-hidden="true">#</a></h3><h4 id="_1、jvm-内存问题" tabindex="-1">1、JVM 内存问题 <a class="header-anchor" href="#_1、jvm-内存问题" aria-hidden="true">#</a></h4><p><code>os::commit_memory(0x00000000c5330000,986513408, 0) failed; error=&#39;Cannot allocate memory&#39; (errno=12)</code></p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">Java HotSpot(TM) 64-Bit Server VM warning: INFO: os::commit_memory(0x00000000c5330000,</span></span>
<span class="line"><span style="color:#A6ACCD;">986513408, 0) failed; error=&#39;Cannot allocate memory&#39; (errno=12)</span></span>
<span class="line"><span style="color:#A6ACCD;">#</span></span>
<span class="line"><span style="color:#A6ACCD;"># There is insufficient memory for the Java Runtime Environment to continue.</span></span>
<span class="line"><span style="color:#A6ACCD;"># Native memory allocation (mmap) failed to map 986513408 bytes for committing reserved</span></span>
<span class="line"><span style="color:#A6ACCD;">memory.</span></span>
<span class="line"><span style="color:#A6ACCD;"># An error report file with more information is saved as:</span></span>
<span class="line"><span style="color:#A6ACCD;"># logs/hs_err_pid22863.log</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ElasticSearch 使用 java 的 jvm 默认是使用1G的内存的，这里我们修改一下内存，直接把内存改到256m</p><p>cd 到 es 目录修改 ./config/jvm.options：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">vi ./config/jvm.options</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改该内容：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">-Xms256m</span></span>
<span class="line"><span style="color:#A6ACCD;">-Xmx256m</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>:wq 保存并退出vi，再次启动es</p><h4 id="_2、不能用root账户进行启动" tabindex="-1">2、不能用root账户进行启动 <a class="header-anchor" href="#_2、不能用root账户进行启动" aria-hidden="true">#</a></h4><p><code>can not run ElasticSearch as root</code></p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">[2019-06-21T16:20:03,039][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-1]</span></span>
<span class="line"><span style="color:#A6ACCD;">uncaught exception in thread [main]</span></span>
<span class="line"><span style="color:#A6ACCD;">org.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run</span></span>
<span class="line"><span style="color:#A6ACCD;">ElasticSearch as root</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>添加一个用户组和用户</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">groupadd elasticgroup</span></span>
<span class="line"><span style="color:#A6ACCD;">useradd ElasticSearch -g esmayikt -p 123456</span></span>
<span class="line"><span style="color:#A6ACCD;">chown -R elasticgroup:ElasticSearch  /usr/local/elasticsearch-7.6.1</span></span>
<span class="line"><span style="color:#A6ACCD;">su ElasticSearch 　　</span><span style="color:#676E95;">#切换用户</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意：修改文件的时候，进入root账户进行修改</p><h4 id="_3、配置错误" tabindex="-1">3、配置错误 <a class="header-anchor" href="#_3、配置错误" aria-hidden="true">#</a></h4><p><strong>需要在这个文件<code>/etc/security/limits.conf</code>中加上4行代码（在root账户进行修改）</strong></p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vi /etc/security/limits.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>末尾添加</strong></p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">ElasticSearch soft nofile 65536</span></span>
<span class="line"><span style="color:#A6ACCD;">ElasticSearch hard nofile 65536</span></span>
<span class="line"><span style="color:#A6ACCD;">ElasticSearch soft nproc 4096</span></span>
<span class="line"><span style="color:#A6ACCD;">ElasticSearch hard nproc 4096</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>vi 编辑 <code>vi /etc/security/limits.d/20-nproc.conf</code>，将* 改为用户名（elasticsearch）：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># Default limit for number of user&#39;s processes to prevent</span></span>
<span class="line"><span style="color:#A6ACCD;"># accidental fork bombs.</span></span>
<span class="line"><span style="color:#A6ACCD;"># See rhbz #432903 for reasoning.</span></span>
<span class="line"><span style="color:#A6ACCD;">ElasticSearch soft nproc 4096</span></span>
<span class="line"><span style="color:#A6ACCD;">root soft nproc unlimited</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>vi 编辑<code>/etc/sysctl.conf</code>，在末尾加上：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">vm.max_map_count = 655360</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在root用户下执行:</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">[root@localhost ~]# sysctl -p</span></span>
<span class="line"><span style="color:#A6ACCD;">vm.max_map_count = 655360</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>登录刚才新建的 ElasticSearch 用户，并启动 ElasticSearch ，OK！！！！</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">[root@localhost elasticsearch-7.6.1]# su elasticsearch</span></span>
<span class="line"><span style="color:#A6ACCD;">[elasticsearch@localhost elasticsearch-7.6.1]$ ./bin/elasticsearch</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>访问 IP::9200</p><h1 id="其他辅助工具安装" tabindex="-1">其他辅助工具安装 <a class="header-anchor" href="#其他辅助工具安装" aria-hidden="true">#</a></h1><h2 id="elasticsearch-head" tabindex="-1">elasticsearch-head <a class="header-anchor" href="#elasticsearch-head" aria-hidden="true">#</a></h2><h3 id="安装-node-js" tabindex="-1">安装 node.js <a class="header-anchor" href="#安装-node-js" aria-hidden="true">#</a></h3><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">wget https://nodejs.org/dist/v12.18.1/node-v12.18.1-linux-x64.tar.xz // 下载</span></span>
<span class="line"><span style="color:#A6ACCD;">tar xf node-v12.18.1-linux-x64.tar.xz // 解压</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> node-v12.18.1-linux-x64 // 进入解压目录，解压文件的 bin 目录底下包含了 node、npm 等命令，我们可以修改linux系统的环境变量（profile）来设置直接运行命令：</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> PATH=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">PATH:/root/node-v12.18.1-linux-x64/bin</span></span>
<span class="line"><span style="color:#82AAFF;">source</span><span style="color:#A6ACCD;"> /etc/profile</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="安装-elasticsearch-head" tabindex="-1">安装 elasticsearch-head <a class="header-anchor" href="#安装-elasticsearch-head" aria-hidden="true">#</a></h3><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;">#1. 在/usr/local目录解压elasticsearch-head-master.zip</span></span>
<span class="line"><span style="color:#A6ACCD;">unzip elasticsearch-head-master.zip</span></span>
<span class="line"><span style="color:#676E95;">#2. 修改elasticsearch-head-master目录</span></span>
<span class="line"><span style="color:#A6ACCD;">mv elasticsearch-head-master elasticsearch-head</span></span>
<span class="line"><span style="color:#676E95;">#3. 在elasticsearch-head目录下安装npm</span></span>
<span class="line"><span style="color:#A6ACCD;">npm install //安装后面可能会出现异常，但是不会影响操作</span></span>
<span class="line"><span style="color:#676E95;">#4. 启动elasticsearch-head</span></span>
<span class="line"><span style="color:#A6ACCD;">npm run start</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>成功后会出现跨域问题，在 elasticsearch.yml 配置文件中配置跨域：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">http.cors.enabled: </span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># elasticsearch中启用CORS</span></span>
<span class="line"><span style="color:#A6ACCD;">http.cors.allow-origin: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 允许访问的IP地址段，* 为所有IP都可以访问</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>再次访问，OK：</p><p><img src="/guo-notes/assets/es-14.a840350b.png" alt="image-20210824100103463"></p><h2 id="kibana" tabindex="-1">kibana <a class="header-anchor" href="#kibana" aria-hidden="true">#</a></h2><p>下载地址：<a href="https://www.elastic.co/cn/downloads/kibana" target="_blank" rel="noreferrer">https://www.elastic.co/cn/downloads/kibana</a></p><p>kibana是es的一个可视化工具，提供了友好的可视化查看和操作页面，可以简单的理解为类似于 mysql 的 phpadmin。</p><ol><li>在 /usr/local/ 解压 kibana-7.6.1-linux-x86_64.tar.gz</li></ol><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">tar -xvf kibana-7.6.1-linux-x86_64.tar.gz</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>进入./kibana/bin目录启动</li></ol><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">./kibana</span></span>
<span class="line"><span style="color:#A6ACCD;">Kibana should not be run as root. Use --allow-root to continue.</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>不能在root用户下启动</p><ol start="3"><li>创建kibana用户</li></ol><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">useradd kibana</span></span>
<span class="line"><span style="color:#A6ACCD;">passwd kibana</span></span>
<span class="line"><span style="color:#A6ACCD;">chown -R kibana /usr/local/kibana</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>进入kibana用户启动kibana访问，OK</p><p><img src="/guo-notes/assets/es-15.619b9a09.png" alt="image-20210824100258477"></p><h2 id="ik分词器" tabindex="-1">ik分词器 <a class="header-anchor" href="#ik分词器" aria-hidden="true">#</a></h2><p>下载地址：<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases" target="_blank" rel="noreferrer">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p><p>ik分词器安装声明：安装完成后需要重新启动elasticsearch，elasticsearch-head，kibana</p><h3 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-hidden="true">#</a></h3><p>在 ElasticSearch 目录的 plugins 解压 elasticsearch-analysis-ik-7.6.1.zip</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">unzip elasticsearch-analysis-ik-7.6.1.zip</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="ik分词器介绍" tabindex="-1">ik分词器介绍 <a class="header-anchor" href="#ik分词器介绍" aria-hidden="true">#</a></h3><p>分词：即把一段中文或者别的划分成一个个的关键字,我们在搜索时候会把自己的信息进行分词，会把数据库中或者索引库中的数据进行分词，然后进行一个匹配操作，默认的中文分词是将每个字看成一个词，比如：</p><p>&quot;中国的花&quot;会被分为&quot;中&quot;，&quot;国&quot;，&quot;的&quot;，&quot;花&quot;，这显然是不符合要求的，所以我们需要安装中文分词器ik来解决这个问题。如果要使用中文，建议使用ik分词器！</p><p>IK提供了两个分词算法：ik_smart 和 ik_max_word，其中 ik_smart 为最少切分，ik_max_word为最细粒度划分！</p><p>elasticsearch-plugin 可以通过这个命令来查看加载进来的插件</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">elasticsearch-plugin list</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>ik_smart为最少切分</strong></p><p>比如会将“中华人民共和国人民大会堂”拆分为中华人民共和国、人民大会堂。</p><p><strong>ik_max_word为最细粒度划分！穷尽词库的可能！字典！</strong></p><p>比如会将“中华人民共和国人民大会堂”拆分为“中华人民共和国、中华人民、中华、华人、人民共和国、人民、共和国、大会堂、大会、会堂等词语。</p><p><strong>两种分词器使用的最佳实践是：索引时用ik_max_word，在搜索时用ik_smart。</strong></p><p>即：索引时最大化的将文章内容分词，搜索时更精确的搜索到想要的结果。</p><h3 id="ik-分词器自定义扩展字典" tabindex="-1">ik 分词器自定义扩展字典 <a class="header-anchor" href="#ik-分词器自定义扩展字典" aria-hidden="true">#</a></h3><p>1、在 /usr/local/elasticsearch-6.4.3/plugins/ik/config 目录下</p><p>2、vi custom/new_word.dic（先在config目录中建custom文件夹，把要修改的文件放到该文件夹中，后再<code>IKAnalyzer.cfg.xml</code>中进行设置）</p><div class="language-php line-numbers-mode"><button class="copy"></button><span class="lang">php</span><pre><code><span class="line"><span style="color:#A6ACCD;">巴拉巴拉</span></span>
<span class="line"><span style="color:#A6ACCD;">胡卡拉卡</span></span>
<span class="line"><span style="color:#A6ACCD;">一带一路</span></span>
<span class="line"><span style="color:#A6ACCD;">banan</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>3、vi IKAnalyzer.cfg.xml</p><div class="language-xml line-numbers-mode"><button class="copy"></button><span class="lang">xml</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#F07178;">xml</span><span style="color:#C792EA;"> version</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;"> encoding</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">?&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F78C6C;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#A6ACCD;">properties</span><span style="color:#89DDFF;"> SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">properties</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">comment</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">IK Analyzer 扩展配置</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">comment</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">key</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ext_dict</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">custom/new_word.dic</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">key</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ext_stopwords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">&lt;!-- &lt;entry key=&quot;remote_ext_dict&quot;&gt;words_location&lt;/entry&gt; --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">properties</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h1 id="elasticsearch-基本操作" tabindex="-1">ElasticSearch 基本操作 <a class="header-anchor" href="#elasticsearch-基本操作" aria-hidden="true">#</a></h1><h2 id="基本命令说明" tabindex="-1">基本命令说明 <a class="header-anchor" href="#基本命令说明" aria-hidden="true">#</a></h2><table><thead><tr><th>HTTP方法</th><th>说明</th></tr></thead><tbody><tr><td>GET</td><td>获取请求对象的当前状态</td></tr><tr><td>POST</td><td>改变对象的当前状态</td></tr><tr><td>PUT</td><td>创建一个对象</td></tr><tr><td>DELETE</td><td>销毁对象</td></tr><tr><td>HEAD</td><td>请求获取对象的基础信息</td></tr></tbody></table><table><thead><tr><th>method</th><th>url地址</th><th>描述</th></tr></thead><tbody><tr><td>PUT</td><td>localhost:9200/索引名称/类型名称/文档id</td><td>创建文档（指定文档id）不存在则创建，存在则更新</td></tr><tr><td>POST</td><td>localhost:9200/索引名称/类型名称</td><td>创建文档（随机文档id）</td></tr><tr><td>POST</td><td>localhost:9200/索引名称/类型名称/文档id/_update</td><td>修改文档</td></tr><tr><td>DELETE</td><td>localhost:9200/索引名称/类型名称/文档id</td><td>删除文档</td></tr><tr><td>GET</td><td>localhost:9200/索引名称/类型名称/文档id</td><td>查询文档通过文档id</td></tr><tr><td>POST</td><td>localhost:9200/索引名称/类型名称/_search</td><td>查询所有数据</td></tr></tbody></table><h2 id="字段的数据类型" tabindex="-1">字段的数据类型 <a class="header-anchor" href="#字段的数据类型" aria-hidden="true">#</a></h2><ul><li>字符串类型 text 、 keyword</li><li>数值类型 long，integer，short，byte，double，float，half_float，scaled_float</li><li>日期类型 date</li><li>布尔值类型 boolean</li><li>二进制类型 binary</li></ul><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">PUT /INDEXNAME</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;settings&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;number_of_shards&quot;:2,</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;number_of_replicas&quot;:1</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;mappings&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;properties&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;id&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">            	&quot;type&quot;:&quot;integer&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            },</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;goods_name&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">            	&quot;type&quot;:&quot;text&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            },</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;goods_description&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">            	&quot;type&quot;:&quot;text&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            },</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;goods_info&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">            	&quot;type&quot;:&quot;text&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="简单操作" tabindex="-1">简单操作 <a class="header-anchor" href="#简单操作" aria-hidden="true">#</a></h2><h3 id="_1、插入数据" tabindex="-1">1、插入数据 <a class="header-anchor" href="#_1、插入数据" aria-hidden="true">#</a></h3><p>创建 index 为 index_name, 创建 type 为 type_name , 插入 id 为 1 的第一条数据，只需运行下面命令就行：</p><div class="language-json line-numbers-mode"><button class="copy"></button><span class="lang">json</span><pre><code><span class="line"><span style="color:#A6ACCD;">PUT /index_name/type_name /</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Dave</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">title</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Elasticsearch is fastest</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2、删除数据" tabindex="-1">2、删除数据 <a class="header-anchor" href="#_2、删除数据" aria-hidden="true">#</a></h3><p>删除 index_name 中 type_name 里面 id 为 2 的数据，只需运行下面命令即可：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">DELETE /conference/event/5</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除整个 type_name 类型，可输入命令：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">DELETE /conference/event</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除整个 index_name 类型，可输入命令：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">DELETE /conference</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3、修改数据" tabindex="-1">3、修改数据 <a class="header-anchor" href="#_3、修改数据" aria-hidden="true">#</a></h3><p>修改数据的命令为 POST，比如想要将 index_name 中 type_name 里面 id 为 3 的文档的 name 字段改为 Bob，那么需要运行命令如下：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">POST /conference/event/4/_update</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;doc&quot;: {&quot;name&quot;: &quot;Bob&quot;}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4、查询数据" tabindex="-1">4、查询数据 <a class="header-anchor" href="#_4、查询数据" aria-hidden="true">#</a></h3><p>查询数据的命令为 GET，查询命令也是 Elasticsearch 最为重要的功能之一。比如我们想查询 index_name 中 type_name 里面 id 为1 的数据，运行命令如下：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET /index_name/type_name/1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果想要搜索 index_name 中 type_name 里面所有的文档，运行命令如下：</p><div class="language-csharp line-numbers-mode"><button class="copy"></button><span class="lang">csharp</span><pre><code><span class="line"><span style="color:#A6ACCD;">GET </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">index_name</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">type_name</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">_search</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5、查询表达式" tabindex="-1">5、查询表达式 <a class="header-anchor" href="#_5、查询表达式" aria-hidden="true">#</a></h3><p>可以检索出 index_name 中 type_name 里面所有 title 含有 <code>is fastest</code> 的文档，命令如下：</p><div class="language-csharp line-numbers-mode"><button class="copy"></button><span class="lang">csharp</span><pre><code><span class="line"><span style="color:#A6ACCD;">GET </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">index_name</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">type_name</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">_search</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">query</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> : </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">match</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> : </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">title  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> : </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">is fastest</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>检索出 index_name 中 type_name 里面所有 title <strong>严格含有</strong> <code>is fastest</code> 的文档，命令如下：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET /index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;query&quot; : {</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;match_phrase&quot; : {</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;title  &quot; : &quot;is fastest&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>查询结果中有一个字段&quot;_score&quot; : 2.561446，这个是一个匹配度。假如我们条件查询出来有多条数据，那这个这个字段值越高，则说明匹配度越高，所以在实际业务中，<strong>我们可以根据这个做权重处理</strong>，或者排序！！！！！</p><h2 id="复杂操作搜索" tabindex="-1">复杂操作搜索 <a class="header-anchor" href="#复杂操作搜索" aria-hidden="true">#</a></h2><p>查询表达式 ， 它支持构建更加复杂和健壮的查询。</p><h3 id="_1、排序" tabindex="-1">1、排序 <a class="header-anchor" href="#_1、排序" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;query&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;name&quot;:guo	//模糊匹配name字段</span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	},</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;sort&quot;:[</span></span>
<span class="line"><span style="color:#A6ACCD;">		{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;age&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">				&quot;order&quot;:&quot;desc&quot;	//通过age字段进行排序</span></span>
<span class="line"><span style="color:#A6ACCD;">			}</span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	]</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_2、分页" tabindex="-1">2、分页 <a class="header-anchor" href="#_2、分页" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;query&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;name&quot;:guo //模糊匹配name字段</span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	},</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;from&quot;:0,	//从第几个开始</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;size&quot;:10	//返回记录数量</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_3、布尔值查询" tabindex="-1">3、布尔值查询 <a class="header-anchor" href="#_3、布尔值查询" aria-hidden="true">#</a></h3><h4 id="must-（and）" tabindex="-1">must （and） <a class="header-anchor" href="#must-（and）" aria-hidden="true">#</a></h4><p>所有的条件都要符合 where id = 1 and name = xxx</p><div class="language-json line-numbers-mode"><button class="copy"></button><span class="lang">json</span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">query</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">bool</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">must</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:[</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">					</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">match</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#916B53;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">guo</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">					</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">match</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#916B53;">age</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">20</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="should（or）" tabindex="-1">should（or） <a class="header-anchor" href="#should（or）" aria-hidden="true">#</a></h4><p>所有的条件都要符合 where id = 1 or name = xxx</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;query&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;bool&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;should&quot;:[</span></span>
<span class="line"><span style="color:#A6ACCD;">				{</span></span>
<span class="line"><span style="color:#A6ACCD;">					&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">                        &quot;name&quot;:guo</span></span>
<span class="line"><span style="color:#A6ACCD;">                    }</span></span>
<span class="line"><span style="color:#A6ACCD;">				},</span></span>
<span class="line"><span style="color:#A6ACCD;">				{</span></span>
<span class="line"><span style="color:#A6ACCD;">					&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">                        &quot;age&quot;:20</span></span>
<span class="line"><span style="color:#A6ACCD;">                    }</span></span>
<span class="line"><span style="color:#A6ACCD;">				}</span></span>
<span class="line"><span style="color:#A6ACCD;">			]</span></span>
<span class="line"><span style="color:#A6ACCD;">		}	</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="must-not-（not）" tabindex="-1">must_not （not） <a class="header-anchor" href="#must-not-（not）" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;query&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;bool&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;must_not&quot;:[</span></span>
<span class="line"><span style="color:#A6ACCD;">				{</span></span>
<span class="line"><span style="color:#A6ACCD;">					&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">                        &quot;age&quot;:18  //年龄不为18</span></span>
<span class="line"><span style="color:#A6ACCD;">                    }</span></span>
<span class="line"><span style="color:#A6ACCD;">				}</span></span>
<span class="line"><span style="color:#A6ACCD;">			]</span></span>
<span class="line"><span style="color:#A6ACCD;">		}	</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="过滤器-（filter）" tabindex="-1">过滤器 （filter） <a class="header-anchor" href="#过滤器-（filter）" aria-hidden="true">#</a></h4><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;query&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;bool&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;must&quot;:[</span></span>
<span class="line"><span style="color:#A6ACCD;">				{</span></span>
<span class="line"><span style="color:#A6ACCD;">					&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">                        &quot;name&quot;:guo</span></span>
<span class="line"><span style="color:#A6ACCD;">                    }</span></span>
<span class="line"><span style="color:#A6ACCD;">				}</span></span>
<span class="line"><span style="color:#A6ACCD;">			],</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;filter&quot;:[</span></span>
<span class="line"><span style="color:#A6ACCD;">				&quot;range&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">					&quot;age&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">						&quot;lt&quot;:10,</span></span>
<span class="line"><span style="color:#A6ACCD;">						&quot;gte&quot;:1</span></span>
<span class="line"><span style="color:#A6ACCD;">					}</span></span>
<span class="line"><span style="color:#A6ACCD;">				}</span></span>
<span class="line"><span style="color:#A6ACCD;">			]</span></span>
<span class="line"><span style="color:#A6ACCD;">		}	</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>gt 大于</p><p>gte 大于等于</p><p>lt 小于</p><p>lte 小于等于</p><h3 id="_4、匹配多个条件" tabindex="-1">4、匹配多个条件 <a class="header-anchor" href="#_4、匹配多个条件" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;query&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;name&quot;:&quot;guo php&quot; //多个条件使用空格隔开，只要满足其中一个结果即可以</span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_5、精准查询" tabindex="-1">5、精准查询 <a class="header-anchor" href="#_5、精准查询" aria-hidden="true">#</a></h3><p><strong>term 查询是直接通过倒排索引指定的词条进程精确查找的！</strong></p><p>关于分词：</p><p>term：通过倒排索引指定的词条进行精确的查找，配合keyword类型的字段，都不分词，<strong>直接匹配</strong></p><p>match：查询之前会通过分词器解析，解析后再进行查询</p><p>两个类型：text（会被分词器解析）和keyword（不会被分词器解析）</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET _analyze</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;"> &quot;query&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;bool&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">      &quot;should&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        {</span></span>
<span class="line"><span style="color:#A6ACCD;">          &quot;term&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;age&quot;: 14</span></span>
<span class="line"><span style="color:#A6ACCD;">          }</span></span>
<span class="line"><span style="color:#A6ACCD;">        },</span></span>
<span class="line"><span style="color:#A6ACCD;">        {</span></span>
<span class="line"><span style="color:#A6ACCD;">          &quot;term&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;age&quot;: 13</span></span>
<span class="line"><span style="color:#A6ACCD;">          }</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">      ]</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_6、高亮查询" tabindex="-1">6、高亮查询 <a class="header-anchor" href="#_6、高亮查询" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;query&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;name&quot;:&quot;guo php&quot; </span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	},</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;hightlight&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;filed&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			name:{}	//高亮显示的字段</span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;query&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;name&quot;:&quot;guo php&quot; </span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	},</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;hightlight&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;pre_tags&quot;: &quot;&lt;p class=&#39;key&#39; style=&#39;color:red&#39;&gt;&quot;,	//自定义高亮显示样式</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;post_tags&quot;:&quot;&lt;/p&gt;&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;filed&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			name:{}	//高亮显示的字段</span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="_7、结果过滤" tabindex="-1">7、结果过滤 <a class="header-anchor" href="#_7、结果过滤" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;query&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;match&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;name&quot;:guo	//模糊匹配name字段</span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	},</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;_source&quot;: [&quot;name&quot;,&quot;age&quot;]  //结果过滤，只获取name，age字段，类似mysql的 select name,age from table</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_8、分组查询" tabindex="-1">8、分组查询 <a class="header-anchor" href="#_8、分组查询" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;aggs&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;group_by_age&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;terms&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">				&quot;field&quot;:&quot;age&quot;	</span></span>
<span class="line"><span style="color:#A6ACCD;">			}</span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_9、聚合查询" tabindex="-1">9、聚合查询 <a class="header-anchor" href="#_9、聚合查询" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">GET index_name/type_name/_search</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	&quot;aggs&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">		&quot;many_function&quot;:{//也可单个max,min</span></span>
<span class="line"><span style="color:#A6ACCD;">			&quot;stats&quot;:{</span></span>
<span class="line"><span style="color:#A6ACCD;">				&quot;field&quot;:&quot;age&quot;	</span></span>
<span class="line"><span style="color:#A6ACCD;">			}</span></span>
<span class="line"><span style="color:#A6ACCD;">		}</span></span>
<span class="line"><span style="color:#A6ACCD;">	}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h1 id="elasticsearch-docker-集群部署与解析" tabindex="-1">ElasticSearch-Docker 集群部署与解析 <a class="header-anchor" href="#elasticsearch-docker-集群部署与解析" aria-hidden="true">#</a></h1><h2 id="_1、es-集群原理" tabindex="-1">1、es 集群原理 <a class="header-anchor" href="#_1、es-集群原理" aria-hidden="true">#</a></h2><h3 id="_1-1-采用-es-开源搜索引擎而不是-mysql" tabindex="-1">1.1 采用 es 开源搜索引擎而不是 mysql <a class="header-anchor" href="#_1-1-采用-es-开源搜索引擎而不是-mysql" aria-hidden="true">#</a></h3><h4 id="_1-1-1-首先：因为它快！" tabindex="-1">1.1.1 首先：因为它快！ <a class="header-anchor" href="#_1-1-1-首先：因为它快！" aria-hidden="true">#</a></h4><p>大家知道，在 mysql 中查询数据的时候， 如果是百万级以下的表，速度还能接受，一旦表大小超过1千万，你要按关键字去 like 查询的时候，其速度慢得让人等得不耐烦了。</p><h4 id="_1-1-2-其次：存储量大" tabindex="-1">1.1.2 其次：存储量大 <a class="header-anchor" href="#_1-1-2-其次：存储量大" aria-hidden="true">#</a></h4><p>采用的文档存储结构以及分片的方式，可以存储亿级为单位的数据量，很适合海量存储，这是 redis 做不到的。</p><h4 id="_1-1-3-再次：降低-mysql-负载" tabindex="-1">1.1.3 再次：降低 mysql 负载 <a class="header-anchor" href="#_1-1-3-再次：降低-mysql-负载" aria-hidden="true">#</a></h4><p>降低 mysql 负载，是高并发项目中一直要解决的问题。一个查询，本来是访问 mysql 的，现在到 es 中去查询，降低了 mysql 的负载。</p><h3 id="_1-2-其他开源的搜索引擎" tabindex="-1">1.2 其他开源的搜索引擎 <a class="header-anchor" href="#_1-2-其他开源的搜索引擎" aria-hidden="true">#</a></h3><h4 id="_1-2-1-sphinx" tabindex="-1">1.2.1 Sphinx <a class="header-anchor" href="#_1-2-1-sphinx" aria-hidden="true">#</a></h4><p>Sphinx 也是一款比较优秀的搜索引擎。但是，Sphinx 和 ElasticSearch 比起来，却逊色不少。</p><p>在<strong>复杂查询逻辑下，Sphinx使用非常麻烦</strong>，在特定情况下，还需要修改Sphinx的源码才能实现需求，而我们ES天生就拥有非常丰富的Query DSL，可以满足几乎任何的检索情况；</p><p>另一方面，<strong>在横向扩展和高可用方面，Sphinx实现分布式可谓是没事找抽型</strong>，它并不是做不到，而是实在是太难用了，而ES从一出生就是为分布式、集群化而生的，不仅方便横向扩展、动态增加节点。</p><h4 id="_1-2-2-solr" tabindex="-1">1.2.2 Solr <a class="header-anchor" href="#_1-2-2-solr" aria-hidden="true">#</a></h4><p><strong>先看下solr优缺点</strong></p><p><strong>优点：</strong></p><ol><li>solr4.0增加对mysql的支持，在配置文件里面配置mysql连接信息即可。</li><li>Solr有一个更大、更成熟的用户、开发和贡献者社区。</li><li>支持添加多种格式的索引，如：HTML、PDF、微软 Office 系列软件格式以及 JSON、XML、CSV 等纯文本格式。</li><li>Solr比较成熟、稳定。</li><li>不考虑建索引的同时进行搜索，速度更快。</li></ol><p><strong>缺点：</strong></p><ol><li><strong>建立索引时，搜索效率下降，实时索引搜索效率不高。</strong></li></ol><p><strong>可见，虽然solr具备诸多优点，但是它建立实时搜索效率不高。</strong></p><p><strong>solr与es比较：</strong></p><ol><li>当单纯的对已有数据进行搜索时，Solr更快。当实时建立索引时，Solr会产生io阻塞，查询性能较差, Elasticsearch具有明显的优势。随着数据量的增加，Solr的搜索效率会变得更低，而Elasticsearch却没有明显的变化；</li><li>solr要借助tomcat实现http请求，而es无需额外搭建tomcat；</li><li>Solr 利用 Zookeeper 进行分布式管理，构建量和往后的维护量增加；而 ElasticSearch 自身带有分布式协调管理功能;</li><li>Solr 支持更多格式的数据，而 ElasticSearch 仅支持json文件格式；</li><li>Solr 在传统的搜索应用中表现好于 Elasticsearch，但在处理实时搜索应用时效率明显低于 Elasticsearch</li></ol><h3 id="_1-3-es集群结构" tabindex="-1">1.3 es集群结构 <a class="header-anchor" href="#_1-3-es集群结构" aria-hidden="true">#</a></h3><p>因为es的集群结构可以灵活设置，所以先介绍下典型的结构：</p><p>我们假设我们集群中有3台es，1台主节点，2台从节点，我们创建索引的时候，定义了为这个索引创建3个shard，1个replica，（下图展示了用postman的创建过程）</p><div class="language-json line-numbers-mode"><button class="copy"></button><span class="lang">json</span><pre><code><span class="line"><span style="color:#A6ACCD;">http:</span><span style="color:#676E95;">//xxx:9200/address5</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">settings</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">number_of_shards</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;">//创建索引时（对于数据库的表概念），定义3个分片(shards)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">number_of_replicas</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">1</span><span style="color:#676E95;">//创建索引时（对于数据库的表概念），定义1个副本集(replicas)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">mappings</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">properties</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">keyword</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">country</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">keyword</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">province</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">keyword</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">city</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">keyword</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">address1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">remark</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>那么这个索引的集群结构如下：</p><p><img src="/guo-notes/assets/es-1.a8512c20.png" alt="image-20210823172745052"></p><p>如图所示，</p><p>1 、分片结构：这个索引一共有6个分片，3个shard分片集，每个shard有1个replica副本集，所以一共就有6个分片集，<strong>es是基于<code>Lucene</code>内核的，这6个分片集，就是6个<code>Lucene</code>内核</strong>。</p><p>2 、分片分布：3个shard会自动分布在3台服务器上，可以看到，每台服务器上分布的分片数量是一样多，这个均衡分布是es内部机制完成的， 另外， <code>shard</code>对应的<code>replica</code>是不会在同一台机器上面的。如上图，<code>shard1</code>是不可能和<code>replica1</code>放在一台机器上的，这样一台机器奔溃了，还有副本在其它机器上。</p><p>3 、主从节点： 如上图， 我们有<code>es-node1</code>为master节点，<code>es-node2</code>和<code>es-node3</code>为从节点。</p><p><strong>主节点，负责管理集群范围内的所有变更，例如增加、删除索引，或者增加、删除节点等。但是，主节点并不处理文档级别的增删改查。</strong></p><p><strong>注意：千万别把主从节点（master，slave）和分片副分片混淆了（shard，replica）。</strong></p><h3 id="_1-4-es-集群原理" tabindex="-1">1.4 es 集群原理 <a class="header-anchor" href="#_1-4-es-集群原理" aria-hidden="true">#</a></h3><p>因为es集群原理，里面的知识点比较多，这里用多张图从个方面进行全方位分析。</p><h4 id="_1-4-1-用户请求方式" tabindex="-1">1.4.1 用户请求方式 <a class="header-anchor" href="#_1-4-1-用户请求方式" aria-hidden="true">#</a></h4><p><img src="/guo-notes/assets/es-2.5b84abaa.png" alt="image-20210823173314365"></p><p>如图，不论我们有多少个es实例，当用户需要对es进行增删改查的时候，连接任何一台节点都行，es内部会进行转发。这也是es集群的个性之一。</p><h4 id="_1-4-2-分片路由方式" tabindex="-1">1.4.2 分片路由方式 <a class="header-anchor" href="#_1-4-2-分片路由方式" aria-hidden="true">#</a></h4><p><img src="/guo-notes/assets/es-3.2bbbfac4.png" alt="image-20210824143155345"></p><p>如上图，可见，分片的路由方式类似于redis的hash槽。当要插入文档或者查询文档时，这个文档将存到哪个分片，查询的时候到哪个分片中去查询这个文档， 是根据hash取模完成的。</p><h4 id="_1-4-3-es高可用原理" tabindex="-1">1.4.3 es高可用原理 <a class="header-anchor" href="#_1-4-3-es高可用原理" aria-hidden="true">#</a></h4><p><img src="/guo-notes/assets/es-1.a8512c20.png" alt="image-20210823172745052"></p><ol><li><strong>es的分片和副本集，不会位于同一个es节点（es-node）， 如上图所示，shard1是不可能和replica1在同一个es-node上的，这是es自身设计决定的自动就是这样。</strong></li><li><strong>shard会自动把内容复制到replica</strong></li><li><strong>shard 和 replica 的负载均衡路由是有 es 内部自动实现的，外部用户无感知。</strong></li></ol><p>如上图，假设我们es-node1挂了，集群中会发生什么呢？具体会发生这2个动作：</p><p>其一： 因为es-node1是master节点，所以es会自动重新选举一名master。</p><p>其二： 因为es-node1上面的shard1和replica3挂了，新的master会把node2上的replica-1提升为shard1.</p><p>这样，整个集群还是正常进行的</p><p><strong>演示一下高可用：</strong></p><p>es-node1 挂机前，es-head 的展示信息如下图：</p><p>下图细框正方形为副本，粗框正方形为分片，五角星代表master节点</p><p><img src="/guo-notes/assets/es-4.4af0db8d.png" alt="image-20210824143237800"></p><p>现在关掉 es-node1：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 www</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># docker ps | grep es </span></span>
<span class="line"><span style="color:#A6ACCD;">CONTAINER ID IMAGE COMMAND CREATED </span></span>
<span class="line"><span style="color:#A6ACCD;">STATUS PORTS NAMES </span></span>
<span class="line"><span style="color:#A6ACCD;">1f54c6e2a32d elasticsearch:7.6.1 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/bin/dock…</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 20 hours ago Up </span></span>
<span class="line"><span style="color:#A6ACCD;">20 hours 0.0.0.0:9201-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9200/tcp, 0.0.0.0:9301-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9300/tcp es2 </span></span>
<span class="line"><span style="color:#A6ACCD;">1da207e528c5 elasticsearch:7.6.1 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/bin/dock…</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 20 hours ago Up </span></span>
<span class="line"><span style="color:#A6ACCD;">20 hours 0.0.0.0:9200-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9200/tcp, 0.0.0.0:9300-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9300/tcp es1 </span></span>
<span class="line"><span style="color:#A6ACCD;">657150ff5e9a elasticsearch:7.6.1 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/bin/dock…</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 20 hours ago Up </span></span>
<span class="line"><span style="color:#A6ACCD;">20 hours 0.0.0.0:9202-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9200/tcp, 0.0.0.0:9302-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9300/tcp es3 </span></span>
<span class="line"><span style="color:#A6ACCD;">daf9abdae81a </span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 www</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># docker stop 1da </span></span>
<span class="line"><span style="color:#A6ACCD;">1da</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>再看es-head结果：</p><p><img src="/guo-notes/assets/es-5.5b98f934.png" alt="image-20210824143307557"></p><p>如上图，我们发现2点变化，验证了我们上面所说的，</p><p>一是，es-node3提升为主节点</p><p>二是，es-node2上的副本2和es-node3上的副本0， 已经从副本角色，提升为分片角色了！</p><h4 id="_1-4-4-es-扩容原理" tabindex="-1">1.4.4 es 扩容原理 <a class="header-anchor" href="#_1-4-4-es-扩容原理" aria-hidden="true">#</a></h4><p>扩容前和扩容后的架构变化举例：</p><p>扩容前（2台机器，每台机器上各3个lucene实例）</p><p><img src="/guo-notes/assets/es-6.083b7df7.png" alt="image-20210824143339247"></p><p>扩容后（3台机器，每台机器上各2个lucene实例）</p><p><img src="/guo-notes/assets/es-7.f6e13904.png" alt="image-20210824143356217"></p><p>**这个迁移的过程，用户不需要做什么，只需要增加节点到集群就行了。**下面演示一下：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 www</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># docker start es1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在刚刚只有2台es节点的基础上，我们重新加入一台es-node1，在es-head中发现集群结构自动变成下图这样的分布了：</p><p><img src="/guo-notes/assets/es-8.160241e4.png" alt="image-20210824143420173"></p><p>可见：es扩容过程中，用户无需去关注分片具体是怎么迁移到新es-node的， 整个过程自动完成的！非常的方便！</p><h2 id="_2、-设计分析" tabindex="-1"><strong>2</strong>、 设计分析 <a class="header-anchor" href="#_2、-设计分析" aria-hidden="true">#</a></h2><p>如前面所说，为了提升商品列表查询速度和降低mysql负载，我们将部分查询迁移到es中，具体步骤将可以简单的理解为分为以下4步：</p><ol><li><p>商品数据变化时，将变化同步到es中</p></li><li><p>查询商品列表数据或搜索商品时，从es中查询数据</p></li><li><p>为了提高es吞吐率和伸缩性以及高可用，我们需要搭建一个es集群架构</p></li><li><p>为了方便管理和监控，我们需要可视化工具es-head和kibana</p></li></ol><p>下面，我带着这个思路，去实操:</p><h2 id="_3、-搭建es-docker集群" tabindex="-1">3、 搭建es docker集群 <a class="header-anchor" href="#_3、-搭建es-docker集群" aria-hidden="true">#</a></h2><p>搭建ES版本为7.6.1，kibana也为7.6.1</p><p>参考网站：<a href="https://www.cnblogs.com/tianyiliang/p/10291305.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/tianyiliang/p/10291305.html</a></p><h3 id="_3-1-拉取镜像" tabindex="-1">3.1 拉取镜像 <a class="header-anchor" href="#_3-1-拉取镜像" aria-hidden="true">#</a></h3><p>拉取官方镜像：elasticsearch:7.6.1</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># docker pull elasticsearch:7.6.1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>拉取官方镜像：kibana:7.6.1</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># docker pull kibana:7.6.1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建配置文件目录：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /usr/local/docker/es/config </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> /usr/local/docker/es/config</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-2-docker创建3个es实例" tabindex="-1">3.2 docker创建3个es实例 <a class="header-anchor" href="#_3-2-docker创建3个es实例" aria-hidden="true">#</a></h3><p>3.2.1 先在宿主机准备好3个配置文件 es1.yml， es2.yml， es3.yml，这个是之后要用来挂载到3台es的docker中的。</p><p>编辑配置文件 es1.yml：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /usr/local/docker/es/config/es1.yml</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>内容如下：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">cluster.name: elasticsearch-cluster </span><span style="color:#676E95;">#集群名称</span></span>
<span class="line"><span style="color:#A6ACCD;">node.name: es-node1 </span><span style="color:#676E95;">#节点名称</span></span>
<span class="line"><span style="color:#A6ACCD;">network.host: 0.0.0.0 </span><span style="color:#676E95;">#设置绑定的ip，设置为0.0.0.0以后就可以让任何计算机节点访问到了</span></span>
<span class="line"><span style="color:#A6ACCD;">network.publish_host: 172.200.8.2 </span><span style="color:#676E95;">#其他节点连接此节点的地址，如果不设置的话，则自动获取，publish_host的地址必须为真实地址</span></span>
<span class="line"><span style="color:#A6ACCD;">http.port: 9200 </span><span style="color:#676E95;">#为Http传输监听定制端口</span></span>
<span class="line"><span style="color:#A6ACCD;">transport.tcp.port: 9300 </span><span style="color:#676E95;">#节点与其他节点交互的端口</span></span>
<span class="line"><span style="color:#A6ACCD;">http.cors.enabled: </span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#是否开启跨域访问	</span></span>
<span class="line"><span style="color:#A6ACCD;">http.cors.allow-origin: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#开启跨域访问后的地址限制，*表示无限制</span></span>
<span class="line"><span style="color:#A6ACCD;">node.master: </span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#是否为主节点</span></span>
<span class="line"><span style="color:#A6ACCD;">node.data: </span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#是否存储数据，即存储索引片段，默认值为true：</span></span>
<span class="line"><span style="color:#A6ACCD;">discovery.zen.ping.unicast.hosts:</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.2:9300</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.3:9300</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.4:9300</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#设置新节点被启动时能够发现的主节点列表</span></span>
<span class="line"><span style="color:#A6ACCD;">discovery.zen.minimum_master_nodes: 1 </span><span style="color:#676E95;">#设置一个集群中主节点的数量，当多于三个节点时，该值可在2-4之间</span></span>
<span class="line"><span style="color:#A6ACCD;">cluster.initial_master_nodes: es-node1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>编辑配置文件es2.yml：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /usr/local/docker/es/config/es2.yml</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>内容如下：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">cluster.name: elasticsearch-cluster </span></span>
<span class="line"><span style="color:#A6ACCD;">node.name: es-node2 </span></span>
<span class="line"><span style="color:#A6ACCD;">network.host: 0.0.0.0 </span></span>
<span class="line"><span style="color:#A6ACCD;">network.publish_host: 172.200.8.3 </span></span>
<span class="line"><span style="color:#A6ACCD;">http.port: 9200 </span></span>
<span class="line"><span style="color:#A6ACCD;">transport.tcp.port: 9300 </span></span>
<span class="line"><span style="color:#A6ACCD;">http.cors.enabled: </span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">http.cors.allow-origin: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">node.master: </span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">node.data: </span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">discovery.zen.ping.unicast.hosts: </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.2:9300</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.3:9300</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.4:9300</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> discovery.zen.minimum_master_nodes: 1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>编辑配置文件es3.yml：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /usr/local/docker/es/config/es3.yml</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>内容如下：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">cluster.name: elasticsearch-cluster </span></span>
<span class="line"><span style="color:#A6ACCD;">node.name: es-node3 </span></span>
<span class="line"><span style="color:#A6ACCD;">network.host: 0.0.0.0 </span></span>
<span class="line"><span style="color:#A6ACCD;">network.publish_host: 172.200.8.4 </span></span>
<span class="line"><span style="color:#A6ACCD;">http.port: 9200 </span></span>
<span class="line"><span style="color:#A6ACCD;">transport.tcp.port: 9300 </span></span>
<span class="line"><span style="color:#A6ACCD;">http.cors.enabled: </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">http.cors.allow-origin: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">node.master: </span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">node.data: </span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">discovery.zen.ping.unicast.hosts: </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.2:9300</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.3:9300</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.4:9300</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> discovery.zen.minimum_master_nodes: 1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>创建docker-compose.yml文件， 接下来我们将基于这个文件进行docker-compose编排，生成docker容器</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /usr/local/docker/es/config/docker-compose.yml</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>文件内容：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">version: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">3.6</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">services:</span></span>
<span class="line"><span style="color:#A6ACCD;">    es_1:</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 镜像名称</span></span>
<span class="line"><span style="color:#A6ACCD;">        image: elasticsearch:7.6.1</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 容器名称</span></span>
<span class="line"><span style="color:#A6ACCD;">        container_name: es1</span></span>
<span class="line"><span style="color:#A6ACCD;">        environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">        	- </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ES_JAVA_OPTS=-Xms512m -Xmx512m</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 文件映射到主机</span></span>
<span class="line"><span style="color:#A6ACCD;">        volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">        	-/usr/local/docker/es/config/es1.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 赋予权限</span></span>
<span class="line"><span style="color:#A6ACCD;">        privileged: </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">#端口映射</span></span>
<span class="line"><span style="color:#A6ACCD;">        ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - 9200:9200</span></span>
<span class="line"><span style="color:#A6ACCD;">            - 9300:9300</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 指定网段</span></span>
<span class="line"><span style="color:#A6ACCD;">        networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">            es:</span></span>
<span class="line"><span style="color:#A6ACCD;">            	ipv4_address: 172.200.8.1 </span><span style="color:#676E95;">#设置ip地址</span></span>
<span class="line"><span style="color:#A6ACCD;">    es_2:</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 镜像名称</span></span>
<span class="line"><span style="color:#A6ACCD;">        image: elasticsearch:7.6.1</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 容器名称</span></span>
<span class="line"><span style="color:#A6ACCD;">        container_name: es2</span></span>
<span class="line"><span style="color:#A6ACCD;">        environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">        	- </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ES_JAVA_OPTS=-Xms512m -Xmx512m</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 文件映射到主机</span></span>
<span class="line"><span style="color:#A6ACCD;">        volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">        	-/usr/local/docker/es/config/es2.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 赋予权限</span></span>
<span class="line"><span style="color:#A6ACCD;">        privileged: </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">#端口映射</span></span>
<span class="line"><span style="color:#A6ACCD;">        ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - 9201:9200</span></span>
<span class="line"><span style="color:#A6ACCD;">            - 9301:9300</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 指定网段</span></span>
<span class="line"><span style="color:#A6ACCD;">        networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">            es:</span></span>
<span class="line"><span style="color:#A6ACCD;">            	ipv4_address: 172.200.8.2 </span><span style="color:#676E95;">#设置ip地址</span></span>
<span class="line"><span style="color:#A6ACCD;">    es_3:</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 镜像名称</span></span>
<span class="line"><span style="color:#A6ACCD;">        image: elasticsearch:7.6.1</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 容器名称</span></span>
<span class="line"><span style="color:#A6ACCD;">        container_name: es3</span></span>
<span class="line"><span style="color:#A6ACCD;">        	environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">        - </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ES_JAVA_OPTS=-Xms512m -Xmx512m</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 文件映射到主机</span></span>
<span class="line"><span style="color:#A6ACCD;">        volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">        	-/usr/local/docker/es/config/es3.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 赋予权限</span></span>
<span class="line"><span style="color:#A6ACCD;">        privileged: </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">#端口映射</span></span>
<span class="line"><span style="color:#A6ACCD;">        ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - 9202:9200</span></span>
<span class="line"><span style="color:#A6ACCD;">            - 9302:9300</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 指定网段</span></span>
<span class="line"><span style="color:#A6ACCD;">        networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">            es:</span></span>
<span class="line"><span style="color:#A6ACCD;">          	  ipv4_address: 172.200.8.3 </span><span style="color:#676E95;">#设置ip地址</span></span>
<span class="line"><span style="color:#A6ACCD;">networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">    es:</span></span>
<span class="line"><span style="color:#A6ACCD;">        driver: bridge</span></span>
<span class="line"><span style="color:#A6ACCD;">        ipam:</span></span>
<span class="line"><span style="color:#A6ACCD;">            config:</span></span>
<span class="line"><span style="color:#A6ACCD;">            - subnet: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">172.200.8.0/24</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>执行下面这个命令，会生成3个es容器</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># docker-compose up -d</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看生成的容器：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 config</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># docker ps | grep es</span></span>
<span class="line"><span style="color:#A6ACCD;">1f54c6e2a32d elasticsearch:7.6.1 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/bin/dock…</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 21 hours ago Up 21</span></span>
<span class="line"><span style="color:#A6ACCD;">hours 0.0.0.0:9201-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9200/tcp, 0.0.0.0:9301-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9300/tcp es2</span></span>
<span class="line"><span style="color:#A6ACCD;">1da207e528c5 elasticsearch:7.6.1 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/bin/dock…</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 21 hours ago Up 43</span></span>
<span class="line"><span style="color:#A6ACCD;">minutes 0.0.0.0:9200-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9200/tcp, 0.0.0.0:9300-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9300/tcp es1</span></span>
<span class="line"><span style="color:#A6ACCD;">657150ff5e9a elasticsearch:7.6.1 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/bin/dock…</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 21 hours ago Up 21</span></span>
<span class="line"><span style="color:#A6ACCD;">hours 0.0.0.0:9202-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9200/tcp, 0.0.0.0:9302-</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">9300/tcp es3</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>可见，es容器创建成功！</p><p>到浏览器中输入如下内容, 查看一下节点情况：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">http://192.168.232.104:9200/_cat/nodes</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/guo-notes/assets/es-9.a5be4084.png" alt="image-20210824144742991"></p><p>*代表主节点， -代表从节点。</p><p>可见，一master双slave搭建完毕！</p><p>在看看集群的健康状态:</p><p>到浏览器中输入如下内容, 查看一下节点情况：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">http://192.168.232.104:9200/_cluster/health</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/guo-notes/assets/es-10.8811c08c.png" alt="image-20210824144804257"></p><p>如图，我们看到status:&quot;green&quot; 字样，可见集群健康，es集群搭建成功！</p><blockquote><p>构建集群注意事项</p></blockquote><ol><li>一个es的容器在构建的时候是需要系统提供200M的内存（建议实现）</li><li>系统需要配置sysctl -w vm.max_map_count=262144 参考地址 <a href="https://www.jianshu.com/p/79946b7a9c48" target="_blank" rel="noreferrer">https://www.jianshu.com/p/79946b7a9c48</a></li><li>配置es的共享目录的时候需要给文件操作的权限777</li></ol><h3 id="_3-3-ik分词安装" tabindex="-1">3.3 ik分词安装 <a class="header-anchor" href="#_3-3-ik分词安装" aria-hidden="true">#</a></h3><p>ik安装包elasticsearch-analysis-ik-7.6.1.zip</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 config</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># wget https://github.com/medcl/elasticsearch-analysisik/releases/download/v7.6.1/elasticsearch-analysis-ik-7.6.1.zip</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装ik分词步骤：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 config</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># docker cp elasticsearch-analysis-ik-7.6.1.zip</span></span>
<span class="line"><span style="color:#A6ACCD;">es1:/usr/share/elasticsearch/plugins</span></span>
<span class="line"><span style="color:#676E95;">#进入容器</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 config</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># docker exec -it es1 bash</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@657150ff5e9a elasticsearch</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># mkdir -p /usr/share/elasticsearch/plugins/ik</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@657150ff5e9a plugins</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># mv /usr/share/elasticsearch/plugins/elasticsearch-analysis-ik-</span></span>
<span class="line"><span style="color:#A6ACCD;">7.6.1.zip /usr/share/elasticsearch/plugins/ik</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@657150ff5e9a plugins</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cd /usr/share/elasticsearch/plugins/ik</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@657150ff5e9a ik</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># unzip elasticsearch-analysis-ik-7.6.1.zip</span></span>
<span class="line"><span style="color:#A6ACCD;">Archive: elasticsearch-analysis-ik-7.6.1.zip</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: elasticsearch-analysis-ik-7.6.1.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: httpclient-4.5.2.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: httpcore-4.4.4.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: commons-logging-1.2.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: commons-codec-1.9.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: plugin-descriptor.properties</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: plugin-security.policy</span></span>
<span class="line"><span style="color:#A6ACCD;">creating: config/</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/main.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/quantifier.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/extra_single_word_full.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/IKAnalyzer.cfg.xml</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/surname.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/suffix.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/stopword.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/extra_main.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/extra_stopword.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/preposition.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/extra_single_word_low_freq.dic</span></span>
<span class="line"><span style="color:#A6ACCD;">inflating: config/extra_single_word.dic</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@657150ff5e9a ik</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># rm -rf elasticsearch-analysis-ik-7.6.1.zip</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@657150ff5e9a ik</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ls</span></span>
<span class="line"><span style="color:#A6ACCD;">commons-codec-1.9.jar httpclient-4.5.2.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">commons-logging-1.2.jar httpcore-4.4.4.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">config plugin-descriptor.properties</span></span>
<span class="line"><span style="color:#A6ACCD;">elasticsearch-analysis-ik-7.6.1.jar plugin-security.policy</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@657150ff5e9a ik</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># exit;</span></span>
<span class="line"><span style="color:#82AAFF;">exit</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@104 config</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># docker restart es1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="_3-4-kibana" tabindex="-1">3.4 kibana <a class="header-anchor" href="#_3-4-kibana" aria-hidden="true">#</a></h3><p>kibana是es的一个可视化工具，提供了友好的可视化查看和操作页面，可以简单的理解为类似于mysql的 phpadmin。 创建一个kibana容器：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">[root@104 config]# docker run --name mykibana -e ELASTICSEARCH_HOSTS=http://192.168.232.104:9200 -e SERVER_PORT=5601 -e SERVER_HOST=0.0.0.0 -p 5601:5601 -d kibana:7.6.1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数详解：ELASTICSEARCH_HOSTS：es集群中任选一台es的http地址</p><p>接下来，就可以用浏览器进入kibana界面了。</p><p>下面这个是kibana的控制台界面，可以在左边输入内容，右边会显示执行结果。</p><p><img src="/guo-notes/assets/es-18.f292eb1b.png" alt="image-20210824145155258"></p><p>还可以在下面这里看到我们的索引：</p><p><img src="/guo-notes/assets/es-19.1b4080fd.png" alt="image-20210824145232328"></p><h3 id="_3-5-es-head" tabindex="-1">3.5 es-head <a class="header-anchor" href="#_3-5-es-head" aria-hidden="true">#</a></h3><p>安装es-head之前，要搭建nodeJs环境，这里略过。</p><p>下载es-head：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">[root@104 config]# git clone https://github.com/mobz/elasticsearch-head</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>进入elasticsearch-head根目录，执行：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">[root@104 config]# npm install -g grunt-cli</span></span>
<span class="line"><span style="color:#A6ACCD;">[root@104 config]# cnpm install</span></span>
<span class="line"><span style="color:#A6ACCD;">[root@104 config]# grunt server &amp;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>到这里就安装结束了。</p><p>到浏览器中输入：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">http://192.168.232.104:9100/</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会发现页面已经出来了，此时还需要到第一个输入框中输入es的http地址，如下所示：</p><p><img src="/guo-notes/assets/es-20.28c1dc8a.png" alt="image-20210824145401665"></p><h2 id="_4、elasticsearch-与-mysql-实现数据同步" tabindex="-1">4、ElasticSearch 与 mysql 实现数据同步 <a class="header-anchor" href="#_4、elasticsearch-与-mysql-实现数据同步" aria-hidden="true">#</a></h2><h3 id="_4-1-利用go实现mysql-binlog与-es数据同步" tabindex="-1">4.1 利用Go实现MySQL binlog与 es数据同步 <a class="header-anchor" href="#_4-1-利用go实现mysql-binlog与-es数据同步" aria-hidden="true">#</a></h3><p>go-mysql-elasticsearch是一款使用go语言开发的同步数据到ES的工具。</p><p>go-mysql-elasticsearch也是基于Mysql的binlog订阅，也可以使用使用mysqldump的方式。</p><p>目前还不支持ES6.x及以上的版本，也不支持mysql8.x版本，同时该项目目前还不够稳定，也在开发中。</p><p>项目github地址：<a href="https://github.com/siddontang/go-mysql-elasticsearch" target="_blank" rel="noreferrer">https://github.com/siddontang/go-mysql-elasticsearch</a></p><h4 id="_4-1-1-安装-go" tabindex="-1">4.1.1 安装 go <a class="header-anchor" href="#_4-1-1-安装-go" aria-hidden="true">#</a></h4><p>go官网：<a href="https://golang.google.cn/dl/" target="_blank" rel="noreferrer">https://golang.google.cn/dl/</a></p><p>注意！安装go的同时也需要安装git</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">wget https://golang.google.cn/dl/go1.15.2.linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -C /usr/local -zxvf go1.15.2.linux-amd64.tar.gz</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置环境变量 vi /etc/profile</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> GOROOT=/usr/local/go</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> GOPATH=/www/wwwroot/2007_SRM/app/go</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> PATH=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">PATH:/usr/local/go/bin</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>其中GOPATH为go的项目目录地址，对应目录内容</p><p><img src="/guo-notes/assets/es-21.6abfee3e.png" alt="image-20210824150526625"></p><p>测试：</p><p>编辑一份hello.go文件</p><div class="language-go line-numbers-mode"><button class="copy"></button><span class="lang">go</span><pre><code><span class="line"><span style="color:#89DDFF;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">main</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">fmt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">func</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">var</span><span style="color:#A6ACCD;"> name </span><span style="color:#C792EA;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">go</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    fmt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello world </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> name</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4-1-2-修改-mysql-binlog-日志模式" tabindex="-1">4.1.2 修改 MySQL binlog 日志模式 <a class="header-anchor" href="#_4-1-2-修改-mysql-binlog-日志模式" aria-hidden="true">#</a></h4><p>需要值得注意的是，go-mysql-ElasticSearch 支持binlog的日志模式为row模式</p><p>因此建议在配置MySQLbinlog的时候需指定该模式</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">log-bin=mysql-binb</span></span>
<span class="line"><span style="color:#A6ACCD;">binlog_format=row</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_4-1-3-go-mysql-elasticsearch-安装" tabindex="-1">4.1.3 go-mysql-elasticsearch 安装 <a class="header-anchor" href="#_4-1-3-go-mysql-elasticsearch-安装" aria-hidden="true">#</a></h4><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">go env -w GOPROXY=https://goproxy.cn</span></span>
<span class="line"><span style="color:#A6ACCD;">go get go get github.com/siddontang/go-mysql-elasticsearch</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">GOPATH/src/github.com/siddontang/go-mysql-elasticsearch</span></span>
<span class="line"><span style="color:#A6ACCD;">make</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如下为配置 river.toml</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># MySQL 配置：地址，用户名，密码</span></span>
<span class="line"><span style="color:#A6ACCD;">my_addr = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.169.110:3306</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">my_user = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">my_pass = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0000</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># Elasticsearch地址</span></span>
<span class="line"><span style="color:#A6ACCD;">es_addr = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.169.120:9212</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;"># 存储数据的位置</span></span>
<span class="line"><span style="color:#A6ACCD;">data_dir = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/var</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;"># Inner Http status address</span></span>
<span class="line"><span style="color:#A6ACCD;">stat_addr = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.169.120:12800</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">stat_path = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/es</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;"># pseudo server id like a slave</span></span>
<span class="line"><span style="color:#A6ACCD;">server_id = 1001</span></span>
<span class="line"><span style="color:#676E95;"># mysql or mariadb</span></span>
<span class="line"><span style="color:#A6ACCD;">flavor = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mysql</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;"># mysqldump execution path</span></span>
<span class="line"><span style="color:#676E95;"># mysqldump = &quot;mysqldump&quot;</span></span>
<span class="line"><span style="color:#676E95;"># minimal items to be inserted in one bulk</span></span>
<span class="line"><span style="color:#A6ACCD;">bulk_size = 128</span></span>
<span class="line"><span style="color:#676E95;"># force flush the pending requests if we don&#39;t have enough items &gt;= bulk_size</span></span>
<span class="line"><span style="color:#A6ACCD;">flush_bulk_time = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">200ms</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;"># Ignore table without primary key</span></span>
<span class="line"><span style="color:#A6ACCD;">skip_no_pk_table = </span><span style="color:#82AAFF;">false</span></span>
<span class="line"><span style="color:#676E95;"># ElasticSearch 与 mysql 同步时对应的数据库名称</span></span>
<span class="line"><span style="color:#676E95;"># mysql的数据源</span></span>
<span class="line"><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">]]</span></span>
<span class="line"><span style="color:#A6ACCD;">schema = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">srm</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">tables = </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">goods</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;"># es 映射的mapping</span></span>
<span class="line"><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;">rule</span><span style="color:#89DDFF;">]]</span></span>
<span class="line"><span style="color:#A6ACCD;">schema = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">srm</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">table = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">goods</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;"># es的索引名</span></span>
<span class="line"><span style="color:#A6ACCD;">index = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">srm_goods</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">type</span><span style="color:#A6ACCD;"> = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">link_info</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h4 id="_4-1-4-启动" tabindex="-1">4.1.4 启动 <a class="header-anchor" href="#_4-1-4-启动" aria-hidden="true">#</a></h4><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">GOPATH/src/github.com/siddontang/go-mysql-elasticsearch/bin/go-mysql-ElasticSearch -config=/xxx/river.toml</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4-2-alibaba-canal" tabindex="-1">4.2 alibaba/canal <a class="header-anchor" href="#_4-2-alibaba-canal" aria-hidden="true">#</a></h3><p>基于Mysql的binlog日志订阅：binlog日志是Mysql用来记录数据实时的变化。</p><p>github地址：<a href="https://github.com/alibaba/canal" target="_blank" rel="noreferrer">https://github.com/alibaba/canal</a></p><p><img src="/guo-notes/assets/es-23.4995523a.png" alt="img"></p><h3 id="_4-3-es官方数据收集和同步组件logstash" tabindex="-1">4.3 ES官方数据收集和同步组件logstash <a class="header-anchor" href="#_4-3-es官方数据收集和同步组件logstash" aria-hidden="true">#</a></h3><h2 id="_5、集群安装配置参数" tabindex="-1">5、集群安装配置参数 <a class="header-anchor" href="#_5、集群安装配置参数" aria-hidden="true">#</a></h2><p><a href="https://blog.csdn.net/weixin_43930865/article/details/108714032" target="_blank" rel="noreferrer">https://blog.csdn.net/weixin_43930865/article/details/108714032</a></p><h1 id="elk开源实时日志分析平台部署" tabindex="-1">ELK开源实时日志分析平台部署 <a class="header-anchor" href="#elk开源实时日志分析平台部署" aria-hidden="true">#</a></h1><p>日志主要包括系统日志、应用程序日志和安全日志。系统运维和开发人员可以通过日志了解服务器软硬件信息、检查配置过程中的错误及错误发生的原因。经常分析日志可以了解服务器的负荷，性能安全性，从而及时采取措施纠正错误。</p><p>通常，日志被分散的储存不同的设备上。如果你管理数十上百台服务器，你还在使用依次登录每台机器的传统方法查阅日志。这样是不是感觉很繁琐和效率低下。当务之急我们使用集中化的日志管理，例如：开源的 syslog，将所有服务器上的日志收集汇总。</p><p>集中化管理日志后，日志的统计和检索又成为一件比较麻烦的事情，一般我们使用 grep、awk 和 wc 等 Linux 命令能实现检索和统计，但是对于要求更高的查询、排序和统计等要求和庞大的机器数量依然使用这样的方法难免有点力不从心。</p><p>开源实时日志分析ELK平台能够完美的解决我们上述的问题，ELK 由 ElasticSearch、Logstash 和 Kiabana 三个开源工具组成。官方网站：<a href="https://www.elastic.co/products" target="_blank" rel="noreferrer"> https://www.elastic.co/products</a></p><blockquote><p>Elasticsearch 是个开源分布式搜索引擎，它的特点有：分布式，零配置，自动发现，索引自动分片，索引副本机制，restful 风格接口，多数据源，自动搜索负载等。</p></blockquote><blockquote><p>Logstash 是一个完全开源的工具，他可以对你的日志进行收集、分析，并将其存储供以后使用（如，搜索）。</p></blockquote><blockquote><p>kibana 也是一个开源和免费的工具，他 Kibana 可以为 Logstash 和 ElasticSearch 提供的日志分析友好的 Web 界面，可以帮助您汇总、分析和搜索重要数据日志。</p></blockquote><p>工作原理如下如所示：</p><p><img src="/guo-notes/assets/es-24.7c11fcf0.png" alt="开源实时日志分析ELK平台部署_kibana"></p><p>在需要收集日志的所有服务上部署 logstash，作为 logstash agent（logstash shipper）用于监控并过滤收集日志，将过滤后的内容发送到 logstash indexer，logstash indexer 将日志收集在一起交给全文搜索服务 ElasticSearch，可以用 ElasticSearch 进行自定义搜索通过 Kibana 来结合自定义搜索进行页面展示。</p><p>开源实时日志分析 ELK 平台部署流程：</p><h2 id="_1、安装-logstash-依赖包jdk" tabindex="-1">1、安装 Logstash 依赖包JDK <a class="header-anchor" href="#_1、安装-logstash-依赖包jdk" aria-hidden="true">#</a></h2><p>Logstash 的运行依赖于Java运行环境， Logstash 1.5 以上版本不低于 java 7 推荐使用最新版本的 Java。由于我们只是运行 Java 程序，而不是开发，下载 JRE 即可。首先，在 Oracle 官方下载新版 jre，下载地址：<a href="http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html" target="_blank" rel="noreferrer">http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html</a></p><p><img src="/guo-notes/assets/es-25.7458aee6.png" alt="开源实时日志分析ELK平台部署_ELK_02"></p><p>可以看到提供了多种版本，下载时，选择适合自己机器运行环境的版本，我使用的是 RHEL6.5 x86_64 的操作系统，所以，下载linux-64 的版本。如果使用 Linux 下载执行如下命令下载即可。</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;">#wget http://download.oracle.com/otn-pub/java/jdk/8u45-b14/jdk-8u45-linux-x64.tar.gz</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>JDK 的安装方式比较简单，只需将下载回来的程序包解压到相应的目录即可。</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># mkdir /usr/local/java</span></span>
<span class="line"><span style="color:#A6ACCD;"># tar -zxf jdk-8u45-linux-x64.tar.gz -C /usr/local/java/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>设置 JDK 的环境变量，如下：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># tail -3 ~/.bash_profile</span></span>
<span class="line"><span style="color:#A6ACCD;">export JAVA_HOME=/usr/local/java/jdk1.8.0_45</span></span>
<span class="line"><span style="color:#A6ACCD;">export PATH=$PATH:$JAVA_HOME/bin</span></span>
<span class="line"><span style="color:#A6ACCD;">exportCLASSPATH=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar:$CLASSPATH</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在 Shell 提示符中执行 java –version 命令，显示如下结果，说明安装成功：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># java -version</span></span>
<span class="line"><span style="color:#A6ACCD;">java version &quot;1.8.0_45&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Java(TM) SE Runtime Environment (build 1.8.0_45-b14)</span></span>
<span class="line"><span style="color:#A6ACCD;">Java HotSpot(TM) 64-Bit Server VM (build 25.45-b02,mixed mode)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_2、安装-logstash" tabindex="-1">2、安装 Logstash <a class="header-anchor" href="#_2、安装-logstash" aria-hidden="true">#</a></h2><p>下载并安装 Logstash，安装 logstash 只需将它解压的对应目录即可，例如：/usr/local下：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># https://download.elastic.co/logstash/logstash/logstash-1.5.2.tar.gz</span></span>
<span class="line"><span style="color:#A6ACCD;"># tar –zxf logstash-1.5.2.tar.gz -C /usr/local/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>安装完成后运行如下命令：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># /usr/local/logstash-1.5.2/bin/logstash -e &#39;input { stdin { } } output { stdout {} }&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">Logstash startup completed</span></span>
<span class="line"><span style="color:#A6ACCD;">Hello World!</span></span>
<span class="line"><span style="color:#A6ACCD;">2015-07-15T03:28:56.938Z noc.vfast.com Hello World!</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们可以看到，我们输入什么内容 logstash 按照某种格式输出，其中 -e 参数参数允许 Logstash 直接通过命令行接受设置。这点尤其快速的帮助我们反复的测试配置是否正确而不用写配置文件。使用 CTRL-C 命令可以退出之前运行的 Logstash。</p><p>使用 -e 参数在命令行中指定配置是很常用的方式，不过如果需要配置更多设置则需要很长的内容。这种情况，我们首先创建一个简单的配置文件，并且指定 logstash 使用这个配置文件。例如：在 logstash 安装目录下创建一个“基本配置”测试文件 logstash-test.conf，文件内容如下：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># cat logstash-simple.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">input { stdin { } }</span></span>
<span class="line"><span style="color:#A6ACCD;">output {</span></span>
<span class="line"><span style="color:#A6ACCD;">   stdout { codec=&gt; rubydebug }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Logstash 使用 input 和 output 定义收集日志时的输入和输出的相关配置，本例中 input 定义了一个叫 &quot;stdin&quot; 的 input，output 定义一个叫 &quot;stdout&quot; 的 output。<strong>无论我们输入什么字符，Logstash 都会按照某种格式来返回我们输入的字符</strong>，其中 output 被定义为 &quot;stdout&quot; 并使用了 codec 参数来指定 logstash 输出格式。</p><p>使用 logstash 的 -f 参数来读取配置文件，执行如下开始进行测试：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># echo &quot;`date`  hello World&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Thu Jul 16 04:06:48 CST 2015 hello World</span></span>
<span class="line"><span style="color:#A6ACCD;"># /usr/local/logstash-1.5.2/bin/logstash agent -f logstash-simple.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">Logstash startup completed</span></span>
<span class="line"><span style="color:#A6ACCD;">Tue Jul 14 18:07:07 EDT 2015 hello World   #该行是执行echo “`date`hello World” 后输出的结果，直接粘贴到该位置</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      &quot;message&quot; =&gt; &quot;Tue Jul 14 18:07:07 EDT 2015 helloWorld&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">     &quot;@version&quot; =&gt; &quot;1&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">   &quot;@timestamp&quot; =&gt; &quot;2015-07-14T22:07:28.284Z&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">         &quot;host&quot; =&gt; &quot;noc.vfast.com&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_3、安装-elasticsearch" tabindex="-1">3、安装 Elasticsearch <a class="header-anchor" href="#_3、安装-elasticsearch" aria-hidden="true">#</a></h2><p>下载 Elasticsearch 后，解压到对应的目录就完成 Elasticsearch 的安装。</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># tar -zxf elasticsearch-1.6.0.tar.gz -C /usr/local/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动 Elasticsearch</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># /usr/local/elasticsearch-1.6.0/bin/elasticsearch.</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果使用远程连接的 Linux 的方式并想后台运行 elasticsearch 执行如下命令：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># nohup /usr/local/elasticsearch-1.6.0/bin/elasticsearch &gt;nohup &amp;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>确认 elasticsearch 的9200端口已监听，说明 elasticsearch 已成功运行</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># netstat -anp |grep :9200</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp        0      0 :::9200                     :::*                        LISTEN      3362/java</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接下来我们在 logstash 安装目录下创建一个用于测试 logstash 使用 elasticsearch 作为 logstash 的后端的测试文件 logstash-es-simple.conf，该文件中定义了 stdout 和 elasticsearch 作为 output，这样的“多重输出”即保证输出结果显示到屏幕上，同时也输出到 elastisearch 中。</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># cat logstash-es-simple.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">input { stdin { } }</span></span>
<span class="line"><span style="color:#A6ACCD;">output {</span></span>
<span class="line"><span style="color:#A6ACCD;">   elasticsearch {host =&gt; &quot;localhost&quot; }</span></span>
<span class="line"><span style="color:#A6ACCD;">   stdout { codec=&gt; rubydebug }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>执行如下命令</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># /usr/local/logstash-1.5.2/bin/logstash agent -f logstash-es-simple.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">… …</span></span>
<span class="line"><span style="color:#A6ACCD;">Logstash startup completed</span></span>
<span class="line"><span style="color:#A6ACCD;">hello logstash</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      &quot;message&quot; =&gt; &quot;hello logstash&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">     &quot;@version&quot; =&gt; &quot;1&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">   &quot;@timestamp&quot; =&gt; &quot;2015-07-15T18:12:00.450Z&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">         &quot;host&quot; =&gt; &quot;noc.vfast.com&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>我们可以使用 curl 命令发送请求来查看 ES 是否接收到了数据：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># curl &#39;http://localhost:9200/_search?pretty&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">返回结果</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;took&quot;: 58,</span></span>
<span class="line"><span style="color:#A6ACCD;"> &quot;timed_out&quot; : false,</span></span>
<span class="line"><span style="color:#A6ACCD;"> &quot;_shards&quot; : {</span></span>
<span class="line"><span style="color:#A6ACCD;">   &quot;total&quot; : 5,</span></span>
<span class="line"><span style="color:#A6ACCD;">   &quot;successful&quot; : 5,</span></span>
<span class="line"><span style="color:#A6ACCD;">   &quot;failed&quot; : 0</span></span>
<span class="line"><span style="color:#A6ACCD;">  },</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;hits&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">   &quot;total&quot; : 1,</span></span>
<span class="line"><span style="color:#A6ACCD;">   &quot;max_score&quot; : 1.0,</span></span>
<span class="line"><span style="color:#A6ACCD;">   &quot;hits&quot; : [ {</span></span>
<span class="line"><span style="color:#A6ACCD;">     &quot;_index&quot; : &quot;logstash-2015.07.15&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">     &quot;_type&quot; : &quot;logs&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">     &quot;_id&quot; : &quot;AU6TWiixxDXYhySMyTkP&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">     &quot;_score&quot; : 1.0,</span></span>
<span class="line"><span style="color:#A6ACCD;">     &quot;_source&quot;:{&quot;message&quot;:&quot;hellologstash&quot;,&quot;@version&quot;:&quot;1&quot;,&quot;@timestamp&quot;:&quot;2015-07-15T20:13:55.199Z&quot;,&quot;host&quot;:&quot;noc.vfast.com&quot;}</span></span>
<span class="line"><span style="color:#A6ACCD;">    } ]</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>至此，你已经成功利用 Elasticsearch 和 Logstash 来收集日志数据了。</p><h2 id="_4、安装-elasticsearch-插件" tabindex="-1">4、安装 elasticsearch 插件 <a class="header-anchor" href="#_4、安装-elasticsearch-插件" aria-hidden="true">#</a></h2><p>Elasticsearch-kopf 插件可以查询 Elasticsearch 中的数据，安装 elasticsearch-kopf，只要在你安装 Elasticsearch 的目录中执行以下命令即可：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># cd /usr/local/elasticsearch-1.6.0/</span></span>
<span class="line"><span style="color:#A6ACCD;"># ./plugin -install lmenezes/elasticsearch-kopf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>安装完成后在 plugins 目录下可以看到kopf</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># ls plugins/</span></span>
<span class="line"><span style="color:#A6ACCD;">kopf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在浏览器访问 <a href="http://10.1.1.188:9200/_plugin/kopf" target="_blank" rel="noreferrer"> http://10.1.1.188:9200/_plugin/kopf </a>浏览保存在 Elasticsearch 中的数据，如下所示：</p><p><img src="/guo-notes/assets/es-26.57b60684.png" alt="开源实时日志分析ELK平台部署_logstash_03"></p><h2 id="_5、安装-kibana" tabindex="-1">5、安装 Kibana <a class="header-anchor" href="#_5、安装-kibana" aria-hidden="true">#</a></h2><p>下载 kibana 后，解压到对应的目录就完成 kibana 的安装</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># tar -zxf kibana-4.1.1-linux-x64.tar.gz -C /usr/local/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动 kibana</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># /usr/local/kibana-4.1.1-linux-x64/bin/kibana</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用 <a href="http://kibanaServerIP:5601" target="_blank" rel="noreferrer">http://kibanaServerIP:5601</a> 访问 Kibana，登录后，首先，配置一个索引，默认，Kibana 的数据被指向 Elasticsearch，使用默认的 logstash-* 的索引名称，并且是基于时间的，点击“Create”即可。</p><p><img src="/guo-notes/assets/es-27.752a74bd.png" alt="开源实时日志分析ELK平台部署_ELK_04"></p><p>看到如下界面说明索引创建完成。</p><p><img src="/guo-notes/assets/es-28.0c3a6be1.png" alt="开源实时日志分析ELK平台部署_logstash_05"></p><p>点击“Discover”，可以搜索和浏览 Elasticsearch 中的数据，默认搜索的是最近15分钟的数据。可以自定义选择时间。</p><p><img src="/guo-notes/assets/es-29.e4ac07c1.png" alt="开源实时日志分析ELK平台部署_logstash_06"></p><p>到此，说明你的ELK平台安装部署完成。</p><h2 id="_6、配置-logstash-作为-indexer" tabindex="-1">6、配置 logstash 作为 Indexer <a class="header-anchor" href="#_6、配置-logstash-作为-indexer" aria-hidden="true">#</a></h2><p>将 logstash 配置为索引器，并将 logstash 的日志数据存储到 Elasticsearch，本范例主要是索引本地系统日志。</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># cat /usr/local/logstash-1.5.2/logstash-indexer.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">input {</span></span>
<span class="line"><span style="color:#A6ACCD;">  file {</span></span>
<span class="line"><span style="color:#A6ACCD;">    type =&gt;&quot;syslog&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">     path =&gt; [&quot;/var/log/messages&quot;, &quot;/var/log/syslog&quot; ]</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  syslog {</span></span>
<span class="line"><span style="color:#A6ACCD;">    type =&gt;&quot;syslog&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    port =&gt;&quot;5544&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">output {</span></span>
<span class="line"><span style="color:#A6ACCD;">  stdout { codec=&gt; rubydebug }</span></span>
<span class="line"><span style="color:#A6ACCD;">  elasticsearch {host =&gt; &quot;localhost&quot; }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"># /usr/local/logstash-1.5.2/bin/logstash -flogstash-indexer.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>使用 echo 命令模拟写入日志，命令执行后看到如下图的信息</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;"># echo &quot;`date` 优衣库视频&quot; &gt;&gt;/var/log/messages</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/guo-notes/assets/es-30.c9ee928c.png" alt="开源实时日志分析ELK平台部署_kibana_07"></p><p>刷新 kibana，发现最新的测试数据显示到浏览器中，如下图所示：</p><p><img src="/guo-notes/assets/es-31.c0ec9461.png" alt="开源实时日志分析ELK平台部署_logstash_08"></p><p>到此，ELK平台部署和基本的测试已完成。</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-37ebe389 data-v-a54a85bd><div class="edit-info" data-v-a54a85bd><!----><div class="last-updated" data-v-a54a85bd><p class="VPLastUpdated" data-v-a54a85bd data-v-f7d51a9c>Last updated: <time datatime="2023-04-13T04:41:05.000Z" data-v-f7d51a9c></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"classify_docker_docker compose服务编排.md\":\"e445a5cb\",\"classify_docker_dockerhub和私人仓库.md\":\"4e1c698b\",\"classify_docker_dockerfile.md\":\"77b91fc2\",\"classify_docker_docker介绍.md\":\"68fa130a\",\"classify_docker_docker命令.md\":\"9821f05f\",\"classify_docker_docker安装和启动.md\":\"4e231a99\",\"classify_docker_docker架构.md\":\"487b7aee\",\"classify_elasticsearch_elasticsearch介绍.md\":\"6f188e9a\",\"classify_elasticsearch_elasticsearch.md\":\"6dfcc0f5\",\"classify_kafka_kafka.md\":\"e45d2643\",\"classify_kubernetes_dashboard.md\":\"21f37a32\",\"classify_kubernetes_kubernetes介绍.md\":\"4937df2e\",\"classify_kubernetes_kubernetes实战入门.md\":\"5d54467f\",\"classify_kubernetes_kubernetes资源管理.md\":\"20b87e6d\",\"classify_kubernetes_kubernetes集群环境搭建.md\":\"11741ee9\",\"classify_kubernetes_pod控制器详解.md\":\"046d3063\",\"classify_kubernetes_pod详解.md\":\"a35a70c3\",\"classify_kubernetes_service详解.md\":\"2ffe9e36\",\"classify_kubernetes_安全认证.md\":\"bd3b0ef2\",\"classify_kubernetes_数据存储.md\":\"4fac1ffc\",\"classify_nginx_nginx.md\":\"95bae19d\",\"classify_rabbitmq_exchange核心概念.md\":\"4c25f3d1\",\"classify_rabbitmq_mq的概念.md\":\"aeadd502\",\"classify_rabbitmq_mq的种类和对比.md\":\"0b480ff9\",\"classify_rabbitmq_rabbitmq命令行.md\":\"387fdad6\",\"classify_rabbitmq_rabbitmq工作模式.md\":\"66f6d278\",\"classify_rabbitmq_rabbitmq应用方案.md\":\"0e7e9403\",\"classify_rabbitmq_rabbitmq的安装和启动.md\":\"4d75289f\",\"classify_rabbitmq_rabbitmq简介.md\":\"6f0b1a47\",\"classify_rabbitmq_rabbitmq管控台介绍.md\":\"58a5e31f\",\"classify_rabbitmq_rabbitmq集群搭建.md\":\"6a2895ef\",\"classify_rabbitmq_rabbitmq高级特性.md\":\"e6a2f97d\",\"classify_rabbitmq_rabbitmq高级特性1.md\":\"92fddb1b\",\"classify_redis_redis主从.md\":\"f137d510\",\"classify_redis_redis事务.md\":\"ec6ed2bb\",\"classify_redis_redis五大数据类型实现原理.md\":\"d0f84cf4\",\"classify_redis_redis介绍.md\":\"6984ad4d\",\"classify_redis_redis内存回收.md\":\"3853aa69\",\"classify_redis_redis内存淘汰策略.md\":\"45dbbdda\",\"classify_redis_redis内存碎片率.md\":\"0ade7f9a\",\"classify_redis_redis分布式锁.md\":\"94cb62f5\",\"classify_redis_redis哨兵.md\":\"f06c79ab\",\"classify_redis_redis底层数据结构.md\":\"be5dbb03\",\"classify_redis_redis慢查询和管道.md\":\"f475e99c\",\"classify_redis_redis持久化.md\":\"97f9cab7\",\"classify_redis_redis数据类型简介.md\":\"66aa81f3\",\"classify_redis_redis缓存击穿、穿透、雪崩.md\":\"58f74a8c\",\"classify_redis_redis配置文件解析.md\":\"711d175c\",\"classify_redis_redis集群.md\":\"fe44173c\",\"classify_algorithm_concept_复杂度-时间复杂度和空间复杂度.md\":\"43c21803\",\"classify_algorithm_concept_数据结构-堆.md\":\"1c7e86bc\",\"classify_algorithm_concept_数据结构-栈与队列.md\":\"9c2a5bfe\",\"classify_algorithm_concept_数据结构-树.md\":\"b7e27013\",\"classify_algorithm_concept_算法-排序算法.md\":\"f169d178\",\"classify_algorithm_concept_算法-查找算法.md\":\"ef252f2a\",\"classify_algorithm_concept_算法-深度优先搜索和广度优先搜索.md\":\"50c84be1\",\"classify_algorithm_index.md\":\"4d1a32c2\",\"classify_algorithm_title_leetcode-1.md\":\"153930d6\",\"classify_algorithm_title_leetcode-101.md\":\"1600583d\",\"classify_algorithm_title_leetcode-104.md\":\"71de9eee\",\"classify_algorithm_title_leetcode-110.md\":\"dd07c78f\",\"classify_algorithm_title_leetcode-141.md\":\"252e7829\",\"classify_algorithm_title_leetcode-142.md\":\"d3109add\",\"classify_algorithm_title_leetcode-144.md\":\"625b6d88\",\"classify_algorithm_title_leetcode-145.md\":\"bfc4487e\",\"classify_algorithm_title_leetcode-160.md\":\"94c8b1f5\",\"classify_algorithm_title_leetcode-206.md\":\"adfbb92d\",\"classify_algorithm_title_leetcode-21.md\":\"c7bf95a0\",\"classify_algorithm_title_leetcode-226.md\":\"292c659f\",\"classify_algorithm_title_leetcode-232.md\":\"fa8b3795\",\"classify_algorithm_title_leetcode-234.md\":\"9f5c9a8f\",\"classify_algorithm_title_leetcode-283.md\":\"196d90f5\",\"classify_algorithm_title_leetcode-394.md\":\"4700c24f\",\"classify_algorithm_title_leetcode-448.md\":\"41b4a2b7\",\"classify_algorithm_title_leetcode-70.md\":\"99263d85\",\"classify_algorithm_title_leetcode-83.md\":\"fb1d0c51\",\"classify_algorithm_title_leetcode-876.md\":\"b883f7ae\",\"classify_algorithm_title_leetcode-88.md\":\"5c1a20bb\",\"classify_algorithm_title_leetcode-912.md\":\"4e747625\",\"classify_algorithm_title_leetcode-94.md\":\"6638717d\",\"classify_algorithm_title_leetcode-模板.md\":\"62999d58\",\"classify_algorithm_title_剑指offer-22.md\":\"72157685\",\"classify_algorithm_其他-设计.md\":\"6b4dc8ad\",\"classify_algorithm_基础-排序.md\":\"30ccb915\",\"classify_algorithm_基础数据结构-哈希表.md\":\"83f0355e\",\"classify_algorithm_基础数据结构-字符串.md\":\"f596e5b2\",\"classify_algorithm_基础数据结构-数组.md\":\"efd2dd99\",\"classify_algorithm_基础数据结构-栈.md\":\"4470caee\",\"classify_algorithm_基础数据结构-树.md\":\"1924d507\",\"classify_algorithm_基础数据结构-链表.md\":\"6cc4e66f\",\"classify_algorithm_基础数据结构-队列.md\":\"d74da469\",\"classify_algorithm_技巧-双指针.md\":\"dc5dce83\",\"classify_algorithm_数学-斐波那契数列.md\":\"e9a865f0\",\"classify_algorithm_数学-相遇问题.md\":\"8ad92af4\",\"classify_algorithm_算法-动态规划.md\":\"385c3e37\",\"classify_algorithm_算法-广度优先搜索.md\":\"a317fb96\",\"classify_algorithm_算法-排序.md\":\"2d367fde\",\"classify_algorithm_算法-深度优先搜索.md\":\"2173630c\",\"classify_algorithm_算法-迭代.md\":\"b82fbeed\",\"classify_algorithm_算法-递归.md\":\"14258e25\",\"classify_mysql_mvcc多版本并发控制.md\":\"a6839cd7\",\"classify_mysql_mysql三大日志.md\":\"6fc271c6\",\"classify_mysql_mysql主从复制.md\":\"e23989cb\",\"classify_mysql_mysql事务.md\":\"74144553\",\"classify_mysql_mysql介绍.md\":\"16c0829c\",\"classify_mysql_mysql分区.md\":\"519fe261\",\"classify_mysql_mysql分库分表.md\":\"67a908ab\",\"classify_mysql_mysql索引.md\":\"aa5a5b98\",\"classify_mysql_mysql语法.md\":\"2cefde38\",\"classify_mysql_mysql读写分离.md\":\"6aaef7b1\",\"classify_mysql_mysql负载均衡和高可用.md\":\"a0d2d5e6\",\"classify_mysql_mysql锁.md\":\"faa5477c\",\"classify_mysql_sql语句优化.md\":\"9ed841f6\",\"classify_mysql_sql语句执行流程.md\":\"a2eb6fb7\",\"classify_mysql_存储引擎.md\":\"7126bd1f\",\"classify_mysql_性能分析.md\":\"7d45fd8e\",\"classify_mysql_物理文件.md\":\"7b86530c\",\"classify_mysql_管理常用工具.md\":\"3b8e8232\",\"classify_sundry_concept_存储单位与速率单位.md\":\"fcdd3a31\",\"classify_sundry_concept_性能指标.md\":\"736df057\",\"classify_sundry_tools_git_github 连接失败.md\":\"b364ad14\",\"classify_sundry_tools_vscode_vscode 启动 debug.md\":\"4415f68d\",\"classify_框架学习_laravel_artisan控制台命令.md\":\"3f027568\",\"classify_框架学习_laravel_生命周期相关核心概念.md\":\"e3a473a1\",\"classify_解决方案_redis主从存在的问题和解决方案.md\":\"10de02be\",\"classify_解决方案_数据库与缓存一致性解决方案.md\":\"86aaa18b\",\"classify_计算机基础_计算机网络_io模型.md\":\"f949c0d4\",\"classify_计算机基础_计算机网络_index.md\":\"70d7ba4a\",\"classify_设计模式.md\":\"85ec7b0a\",\"classify_面试常问_web安全.md\":\"0b3c474c\",\"classify_面试常问_一次网络请求的完整过程.md\":\"6e452cf1\",\"index.md\":\"24330e17\",\"preface_install.md\":\"907ef5ac\",\"preface_preface.md\":\"c3eeeef9\"}")</script>
    <script type="module" async src="/guo-notes/assets/app.b8d26054.js"></script>
    
  </body>
</html>