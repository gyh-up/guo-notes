<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redis哨兵 | 技术博客，知识分享，学习笔记，问题解决方案</title>
    <meta name="description" content="啊郭的博客">
    <link rel="stylesheet" href="/guo-notes/assets/style.5e0eda6f.css">
    <link rel="modulepreload" href="/guo-notes/assets/app.867b012f.js">
    <link rel="modulepreload" href="/guo-notes/assets/classify_Redis_redis哨兵.md.cab32070.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c6a644e1><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c6a644e1 data-v-a71a30f1><div class="VPNavBar has-sidebar" data-v-a71a30f1 data-v-6f1d18b5><div class="container" data-v-6f1d18b5><div class="VPNavBarTitle has-sidebar" data-v-6f1d18b5 data-v-d5925166><a class="title" href="/guo-notes/" data-v-d5925166><!--[--><!--]--><!----><!--[-->啊郭的博客<!--]--><!--[--><!--]--></a></div><div class="content" data-v-6f1d18b5><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6f1d18b5 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 后端技术 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Redis/redis%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Redis<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/mysql/mysql%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Mysql<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/RabbitMQ/MQ%E7%9A%84%E6%A6%82%E5%BF%B5.html" data-v-e8e0fb1d data-v-3c355974><!--[-->RabbitMq<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Docker/Docker%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Docker<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Kubernetes/Kubernetes%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Kubernetes<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Kafka/kafka%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Kafka<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 计算机基础 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/计算机基础/计算机网络/" data-v-e8e0fb1d data-v-3c355974><!--[-->计算机网络<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guo-notes/classify/algorithm/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->算法<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 杂项 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6f1d18b5 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-1899cd41 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1899cd41><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1899cd41><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6f1d18b5 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/gyh-up?tab=repositories" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://blog.csdn.net/weixin_42258523?spm=1000.2115.3001.5343" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><embed src="https://g.csdnimg.cn/static/logo/favicon32.ico" style="border-radius: 100%;width: 20px;height: 20px;" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6f1d18b5 data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-1899cd41 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1899cd41><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1899cd41><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/gyh-up?tab=repositories" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://blog.csdn.net/weixin_42258523?spm=1000.2115.3001.5343" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><embed src="https://g.csdnimg.cn/static/logo/favicon32.ico" style="border-radius: 100%;width: 20px;height: 20px;" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6f1d18b5 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-c6a644e1 data-v-aac27d5e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-aac27d5e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-aac27d5e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-aac27d5e>Menu</span></button><a class="top-link" href="#" data-v-aac27d5e> Return to top </a></div><aside class="VPSidebar" data-v-c6a644e1 data-v-f332cb62><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f332cb62><span class="visually-hidden" id="sidebar-aria-label" data-v-f332cb62> Sidebar Navigation </span><!--[--><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible" data-v-f332cb62 data-v-35f99ef5><div class="title" role="button" data-v-35f99ef5><h2 class="title-text" data-v-35f99ef5>Redis 学习笔记</h2><div class="action" data-v-35f99ef5><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-35f99ef5><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-35f99ef5><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-35f99ef5><!--[--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E4%BB%8B%E7%BB%8D.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>一、介绍</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%AE%80%E4%BB%8B.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>二、数据类型简介</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>三、底层数据结构</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>四、五大数据类型实现原理</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>五、redis内存淘汰策略</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>六、redis内存回收</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87%E7%8E%87.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>七、redis内存碎片率</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E3%80%81%E5%87%BB%E7%A9%BF%E3%80%81%E9%9B%AA%E5%B4%A9.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>八、redis缓存穿透、击穿、雪崩</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E6%85%A2%E6%9F%A5%E8%AF%A2%E5%92%8C%E7%AE%A1%E9%81%93.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>九、redis慢查询和管道</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E6%8C%81%E4%B9%85%E5%8C%96.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十、redis持久化</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E4%BA%8B%E5%8A%A1.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十一、redis事务</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十二、redis分布式锁</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E4%B8%BB%E4%BB%8E.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十三、redis主从</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/guo-notes/classify/Redis/redis%E5%93%A8%E5%85%B5.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十四、redis哨兵</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E9%9B%86%E7%BE%A4.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十五、redis集群</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/Redis/redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十六、redis配置文件解析</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c6a644e1 data-v-c95df128><div class="VPDoc has-sidebar has-aside" data-v-c95df128 data-v-37ebe389><div class="container" data-v-37ebe389><div class="aside" data-v-37ebe389><div class="aside-curtain" data-v-37ebe389></div><div class="aside-container" data-v-37ebe389><div class="aside-content" data-v-37ebe389><div class="VPDocAside" data-v-37ebe389 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-37ebe389><div class="content-container" data-v-37ebe389><!--[--><!--]--><main class="main" data-v-37ebe389><div style="position:relative;" class="vp-doc _guo-notes_classify_Redis_redis%E5%93%A8%E5%85%B5" data-v-37ebe389><div><h1 id="redis哨兵" tabindex="-1">redis哨兵 <a class="header-anchor" href="#redis哨兵" aria-hidden="true">#</a></h1><h2 id="_1、主从复制的问题" tabindex="-1">1、主从复制的问题 <a class="header-anchor" href="#_1、主从复制的问题" aria-hidden="true">#</a></h2><p>Redis 主从复制有一个缺点，当主机Master 宕机以后，我们需要人工解决切换，比如使用<code>slaveof no one</code> 。实际上主从复制 并没有实现高可用。</p><p>高可用侧重备份机器， 利用集群中系统的冗余，当系统中某台机器发生损坏的时候，其他后备的机器可以迅速的接替它来启动服务。</p><p>一旦主节点宕机，写服务无法使用，就需要手动去切换，重新选取主节点，手动设置主从关系，这样明显是不合理的。如果我们有一个监控程序能够监控各个机器的状态及时作出调整，将手动的操作变成自动的。Sentinel 的出现就是为了解决这个问题。</p><h2 id="_2、哨兵机制的原理及实现" tabindex="-1">2、哨兵机制的原理及实现 <a class="header-anchor" href="#_2、哨兵机制的原理及实现" aria-hidden="true">#</a></h2><h3 id="_2-1、redis-sentinel-功能" tabindex="-1">2.1、Redis Sentinel 功能 <a class="header-anchor" href="#_2-1、redis-sentinel-功能" aria-hidden="true">#</a></h3><p><code>Redis Sentinel</code> 一个分布式架构，其中包含若干个 Sentinel 节点和 Redis 数据节点。</p><p>Redis Sentinel 具有以下几个功能：</p><ul><li>监控：Sentinel 节点会定期检测 Redis 数据节点和其余 Sentinel 节点是否可达</li><li>通知：Sentinel 节点会将故障转移的结果通知给应用方</li><li>主节点故障转移： 实现从节点晋升为主节点并维护后续正确的主从关系</li><li>配置提供者： 在 Redis Sentinel 结构中，客户端在初始化的时候连接的是 Sentinel 节点集合 ，从中获取主节点信息。</li></ul><p>同时Redis Sentinel 包含了若个 Sentinel 节点，这样做也带来了两个好处：</p><ul><li>对于节点的故障判断是由多个 Sentinel 节点共同“协商”完成，这样可以有效地防止误判。</li><li>Sentinel 节点集合是由若干个 Sentinel 节点组成的，这样即使个别 Sentinel 节点不可用，整个 Sentinel 节点集合依然是健壮的。</li></ul><p>但是 Sentinel 节点本身就是独立的 Redis 节点，只不过它们有一些特殊，<strong>它们不存储数据， 只支持部分命令</strong>。</p><p>整个过程完全是自动的，不需要人工来介入，<strong>所以这套方案很有效地解决了 Redis 的高可用问题。</strong></p><p>如下图所示：</p><img src="/guo-notes/redis/redis-17.png" alt="image-20210826144440634" style="zoom:120%;"><h3 id="_2-1、基本的故障转移流程" tabindex="-1"><strong>2.1、基本的故障转移流程</strong> <a class="header-anchor" href="#_2-1、基本的故障转移流程" aria-hidden="true">#</a></h3><p><strong>1) 出现故障</strong></p><p>主节点出现故障，此时两个从节点与主节点失去连接，主从复制失败。</p><p><img src="/guo-notes/redis/redis-18.png" alt="image-20210826144553155"></p><p><strong>2) 主观下线</strong></p><p>每个 Sentinel 节点通过定期监控发现主节点出现了故障</p><p><img src="/guo-notes/redis/redis-19.png" alt="image-20210826144654833"></p><p><strong>3) 客观下线</strong></p><p>多个 Sentinel 节点对主节点的故障达成一致会选举出其中一个节点作为领导者负责故障转移。</p><p><strong>4) 故障转移</strong></p><p>Sentinel 领导者节点执行了故障转移，整个过程基本是跟手动调整一致的，只不过是自动化完成的。</p><p><strong>5) 重新选举</strong></p><p>故障转移后整个 Redis Sentinel 的结构，重新选举了新的主节点</p><p><img src="/guo-notes/redis/redis-20.png" alt="image-20210826144716239"></p><h3 id="_2-3、sentinel-的核心配置" tabindex="-1">2.3、Sentinel 的核心配置 <a class="header-anchor" href="#_2-3、sentinel-的核心配置" aria-hidden="true">#</a></h3><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#A6ACCD;">sentinel monitor mymaster 127.0.0.1 7000 2</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>监控的主节点的名字（mymaster）、IP 和端口，最后一个2的意思是有几台 Sentinel 发现有问题，就会发生故障转移，例如 配置为2，代表至少有2个 Sentinel 节点认为主节点不可达，那么这个不可达的判定才是客观的。对于设置的越小，那么达到下线的条件越宽松，反之越严格。<strong>一般建议将其设置为 Sentinel 节点的一半加 1，但是不得大于总的 sentinel 个数。</strong></p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">sentinel down-after-millseconds mymaster 30000</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个是超时的时间（单位为毫秒），即 sentinel 对其他设备的监听返回超时时间，超过设置的时间则主观认为该设备下线了。打个比方，当你去 ping 一个机器的时候，多长时间后仍 ping 不通，那么就认为它是有问题</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">sentinel parallel-syncs mymaster 1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当 Sentinel 节点集合对主节点故障判定达成一致时， Sentinel 领导者节点会做故障转移操作，选出新的主节点，原来的从节点会向新的主节点发起复制操作， <code>parallel-syncs</code> 就是用来限制在一次故障转移之后，每次向新的主节点发起复制操作的从节点个数，指出 Sentinel 属于并发还是串行。<strong>1代表每次只能复制一个，可以减轻 Master 的压力，避免产生复制风暴。</strong></p><img src="/guo-notes/redis/redis-21.png" alt="image-20210826150125204" style="zoom:130%;"><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果 Sentinel 监控的主节点配置了密码，sentinel auth-pass 配置通过添加主节点的密码，防止 Sentinel 节点对主节点无法监控。与从节点配置 <code>masterauth</code> 是一样道理的。</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">sentinel failover-timeout mymaster 180000</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>表示故障转移的时间。</p><h3 id="_2-4、sentinel命令" tabindex="-1">2.4、Sentinel命令 <a class="header-anchor" href="#_2-4、sentinel命令" aria-hidden="true">#</a></h3><p>sentinel支持的合法命令如下：</p><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#A6ACCD;">SENTINEL masters </span><span style="color:#676E95;">#显示被监控的所有master以及它们的状态.</span></span>
<span class="line"><span style="color:#A6ACCD;">SENTINEL master </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">master name</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#显示指定master的信息和状态；</span></span>
<span class="line"><span style="color:#A6ACCD;">SENTINEL slaves </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">master name</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#显示指定master的所有slave以及它们的状态；</span></span>
<span class="line"><span style="color:#A6ACCD;">sentinel sentinels master name  </span><span style="color:#676E95;">#展示指定 的sentinel节点集合（不包含当前sentinel节点）</span></span>
<span class="line"><span style="color:#A6ACCD;">SENTINEL get-master-addr-by-name </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">master name</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#返回指定master的ip和端口，如果正在进行failover或者failover已经完成，将会显示被提升为master的slave的ip和端口。</span></span>
<span class="line"><span style="color:#A6ACCD;">SENTINEL failover </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">master name</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">#强制sentinel执行failover，并且不需要得到其他sentinel的同意。但是failover后会将最新的配置发送给其他sentinel。</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-5、修改配置" tabindex="-1">2.5、修改配置 <a class="header-anchor" href="#_2-5、修改配置" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">sentinel monitor test 127.0.0.1 6379 2 添加新的监听</span></span>
<span class="line"><span style="color:#A6ACCD;">SENTINEL REMOVE test 放弃对某个master监听</span></span>
<span class="line"><span style="color:#A6ACCD;">SENTINEL set failover-timeout mymaster 180000 设置配置选项</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-6、应用端调用" tabindex="-1">2.6、应用端调用 <a class="header-anchor" href="#_2-6、应用端调用" aria-hidden="true">#</a></h3><p>Master可能会因为某些情况宕机了，如果在客户端是固定一个地址去访问，肯定是不合理的，所以客户端请求是请求哨兵，从哨兵获取主机地址的信息，或者是从机的信息。可以实现一个例子</p><p>1、随机选择一个哨兵连接，获取主机、从机信息</p><p>2、模拟客户端定时访问，实现简单轮训效果，轮训从节点</p><p>3、连接失败重试访问</p><h3 id="_2-7、sentinel-实现原理" tabindex="-1">2.7、Sentinel 实现原理 <a class="header-anchor" href="#_2-7、sentinel-实现原理" aria-hidden="true">#</a></h3><p>Sentinel 的实现原理，主要分为以下步骤：</p><p>1、检测问题，主要讲的是<strong>三个定时任务</strong>，这三个内部的执行任务可以保证出现问题马上让 Sentinel 知道。</p><p>2、发现问题，主要讲的是<strong>主观下线和客观下线</strong>。当有一台 Sentinel 机器发现问题时，它就会主观对它主观下线。但是当多个 Sentinel 都发现有问题的时候，才会出现客观下线。</p><p>3、找到解决问题的人，主要讲的是<strong>领导者选举</strong>，如何在 Sentinel 内部多台节点做领导者选举，选出一个领导者。</p><p>4、解决问题，主要讲的是<strong>故障转移</strong>，即如何进行故障转移。</p><h4 id="_2-7-1、三个定时任务" tabindex="-1">2.7.1、三个定时任务 <a class="header-anchor" href="#_2-7-1、三个定时任务" aria-hidden="true">#</a></h4><p>首先要讲的是内部 <code>Sentinel</code> 会执行以下三个定时任务。</p><ul><li>每10秒每个 Sentinel 对 Master 和 Slave 执行一次 <code>Info Replication</code> 。</li><li>每2秒每个 Sentinel 通过 Master 节点的 channel 交换信息（pub/sub）。</li><li>每1秒每个 Sentinel 对其他 Sentinel 和 Redis 执行 ping 。</li></ul><p>第一个定时任务，指的是 Redis Sentinel 可以对 Redis 节点做失败判断和故障转移， Info Replication 发现 Slave 节点，确定主从关系。</p><p>第二个定时任务，类似于发布订阅， Sentinel 会对主从关系进行判定，通过 <em>sentinel</em>:hello 频道交互。了解主从关系可以帮助更好的自动化操作 Redis。然后 Sentinel 会告知系统消息给其它 Sentinel 节点，最终达到共识，同时 Sentinel 节点能够互相感知到对方。</p><p>第三个定时任务，指的是对每个节点和其它 Sentinel 进行心跳检测，它是失败判定的依据。</p><h4 id="_2-7-2、主观下线和客观下线" tabindex="-1">2.7.2、主观下线和客观下线 <a class="header-anchor" href="#_2-7-2、主观下线和客观下线" aria-hidden="true">#</a></h4><p>Sentinel 的配置。</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">sentinel monitor mymaster 127.0.0.1 6379 2</span></span>
<span class="line"><span style="color:#A6ACCD;">sentinel down-after-milliseconds mymaster 30000</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>主观下线：每个 Sentinel 节点对 Redis 节点失败的“偏见”。之所以是偏见，只是因为某一台机器30秒内没有得到回复。</p><p>客观下线：这个时候需要所有 Sentinel 节点都发现它30秒内无回复，才会达到共识。</p><h4 id="_2-7-3、领导者选举方式" tabindex="-1">2.7.3、领导者选举方式 <a class="header-anchor" href="#_2-7-3、领导者选举方式" aria-hidden="true">#</a></h4><p>每个做主观下线的 sentinel 节点，会向其他的 sentinel 节点发送命令，要求将它设置成为领导者</p><p>收到命令 sentinel 节点，如果没有同意通过其它节点发送的命令，那么就会同意请求，否则就会拒绝</p><p><strong>如果sentinel节点发现自己票数超过半数，同时也超过了sentinel monitor mymaster 127.0.0.1 6379 2 超过2个的时候</strong>，就会成为领导者进行故障转移操作。</p><h4 id="_2-7-4、故障转移" tabindex="-1">2.7.4、故障转移 <a class="header-anchor" href="#_2-7-4、故障转移" aria-hidden="true">#</a></h4><p>Redis 内部有一个优先级配置，<strong>在配置文件中 slave-priority，</strong> 这个参数是 Salve 节点的优先级配置，如果存在则返回，如果不存在则继续。</p><p>当上面这个优先级不满足的时候， Redis 还会选择<strong>复制偏移量最大的 Slave节点</strong>（偏移量越大，和 Master 的数据越接近），如果存在则返回，如果不存在则继续。</p><p>如果发现偏移量都一样，这个时候 Redis 会<strong>默认选择 runid 最小的节点</strong>。</p><h2 id="_3、生产环境中部署技巧" tabindex="-1">3、生产环境中部署技巧 <a class="header-anchor" href="#_3、生产环境中部署技巧" aria-hidden="true">#</a></h2><ol><li><p>Sentinel 节点不应该部署在一台物理“机器”上。</p><p>这里特意强调物理机是因为一台物理机做成了若干虚拟机或者现今比较流行的容器，它们虽然有不同的 IP 地址，但实际上它们都是同一台物理机，同一台物理机意味着如果这台机器有什么硬件故障，所有的虚拟机都会受到影响，<strong>为了实现 Sentinel 节点集合真正的高可用，请勿将 Sentinel 节点部署在同一台物理机器上</strong>。</p></li><li><p>部署至少三个且奇数个的 Sentinel 节点。</p><p>三个以上是通过增加 Sentinel 节点的个数提高对于故障判定的准确性，因为领导者选举需要至少一半加1个节点。奇数个节点可以在满足该条件的基础上节省一个节点。</p></li></ol><h2 id="_4、哨兵常见问题" tabindex="-1">4、哨兵常见问题 <a class="header-anchor" href="#_4、哨兵常见问题" aria-hidden="true">#</a></h2><h3 id="_4-1、问题" tabindex="-1">4.1、问题 <a class="header-anchor" href="#_4-1、问题" aria-hidden="true">#</a></h3><p>哨兵集群在发现主节点挂掉后会进行故障转移，启动其中一个从节点升级为主节点。在这过程中，可能会导致数据丢失的情况。</p><blockquote><p>1、异步复制导致数据丢失</p></blockquote><p>因为master-&gt;slave的复制是异步，所以可能有部分还没来得及复制到slave就宕机了，此时这些部分数据就丢失了。</p><blockquote><p>2、集群脑裂导致数据丢失</p></blockquote><p>脑裂，也就是说，某个master所在机器突然脱离了正常的网络，跟其它slave机器不能连接，但是实际上master还运行着。</p><p>此时哨兵可能就会认为master宕机了，然后开始选举，将其它 slave 切换成 master 。这时候集群里就会有2个 master ，也就是所谓的脑裂。</p><p>此时虽然某个 slave 被切换成了 master ，但是可能 client 还没来得及切换成新的 master ，还继续写向旧的 master 的数据可能就丢失了。</p><p>因此旧master再次恢复的时候，会被作为一个 slave 挂到新的master 上去，自己的数据会被清空，重新从新的master 复制数据。</p><h3 id="_4-2、解决方法" tabindex="-1">4.2、解决方法 <a class="header-anchor" href="#_4-2、解决方法" aria-hidden="true">#</a></h3><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">min-slaves-to-write 1</span></span>
<span class="line"><span style="color:#A6ACCD;">min-slaves-max-lag 10</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>要求至少有1个slave，数据复制和同步的延迟不能超过10秒</p><p>如果说一旦所有的slave，数据复制和同步的延迟都超过了10秒钟，那么这个时候，master就不会再接收任何请求了。</p><p><strong>上面两个配置可以减少异步复制和脑裂导致的数据丢失：</strong></p><blockquote><p>1、异步复制导致的数据丢失</p></blockquote><p>在异步复制的过程当中，通过 min-slaves-max-lag 这个配置，就可以确保的说，一旦 slave 复制数据和 ack 延迟时间太长，就认为可能 master 宕机后损失的数据太多了，那么就拒绝写请求，这样就可以把master宕机时由于部分数据未同步到 slave 导致的数据丢失降低到可控范围内。</p><blockquote><p>2、集群脑裂导致的数据丢失</p></blockquote><p>集群脑裂因为 client 还没来得及切换成新的 master ，还继续写向旧的 master 的数据可能就丢失了。通过 min-slaves-to-write 确保必须是有多少个从节点连接，并且延迟时间小于 min-slaves-max-lag 多少秒。</p><p>当然对于客户端需要怎么做呢？</p><p>对于 client 来讲，就需要做些处理，比如先将数据缓存到内存当中，然后过一段时间处理，或者连接失败，接收到错误切换新的master 处理。</p><h2 id="redis日志参数说明" tabindex="-1">redis日志参数说明 <a class="header-anchor" href="#redis日志参数说明" aria-hidden="true">#</a></h2><p>以下列出的是客户端可以通过订阅来获得的频道和信息的格式： 第一个英文单词是频道/事件的名字， 其余的是数据的格式。 注意， 当格式中包含 instancedetails 字样时， 表示频道所返回的信息中包含了以下用于识别目标实例的内容：</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">&lt;instance-type&gt; &lt;name&gt; &lt;ip&gt; &lt;port&gt; @ &lt;master-name&gt; &lt;master-ip&gt; &lt;master-port&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">@ 字符之后的内容用于指定主服务器， 这些内容是可选的， 它们仅在 @ 字符之前的内容指定的实例不是主服务器时使用。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +reset-master &lt;instance details&gt;：主服务器已被重置。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +slave &lt;instance details&gt;：一个新的从服务器已经被 Sentinel 识别并关联。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +failover-state-reconf-slaves &lt;instance details&gt;：故障转移状态切换到了 reconf-slaves 状态。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +failover-detected &lt;instance details&gt;：另一个 Sentinel 开始了一次故障转移操作，或者一个从服务器转换成了主服务器。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +slave-reconf-sent &lt;instance details&gt;：领头（leader）的 Sentinel 向实例发送了 SLAVEOF 命令，为实例设置新的主服务器。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +slave-reconf-inprog &lt;instance details&gt;：实例正在将自己设置为指定主服务器的从服务器，但相应的同步过程仍未完成。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +slave-reconf-done &lt;instance details&gt;：从服务器已经成功完成对新主服务器的同步。</span></span>
<span class="line"><span style="color:#A6ACCD;">· -dup-sentinel &lt;instance details&gt;：对给定主服务器进行监视的一个或多个 Sentinel 已经因为重复出现而被移除 —— 当 Sentinel 实例重启的时候，就会出现这种情况。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +sentinel &lt;instance details&gt;：一个监视给定主服务器的新 Sentinel 已经被识别并添加。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +sdown &lt;instance details&gt;：给定的实例现在处于主观下线状态。</span></span>
<span class="line"><span style="color:#A6ACCD;">· -sdown &lt;instance details&gt;：给定的实例已经不再处于主观下线状态。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +odown &lt;instance details&gt;：给定的实例现在处于客观下线状态。</span></span>
<span class="line"><span style="color:#A6ACCD;">· -odown &lt;instance details&gt;：给定的实例已经不再处于客观下线状态。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +new-epoch &lt;instance details&gt;：当前的纪元（epoch）已经被更新。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +try-failover &lt;instance details&gt;：一个新的故障迁移操作正在执行中，等待被大多数 Sentinel 选中（waiting to be elected by the</span></span>
<span class="line"><span style="color:#A6ACCD;">majority）。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +elected-leader &lt;instance details&gt;：赢得指定纪元的选举，可以进行故障迁移操作了。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +failover-state-select-slave &lt;instance details&gt;：故障转移操作现在处于 select-slave 状态 —— Sentinel 正在寻找可以升级为主服务器的从</span></span>
<span class="line"><span style="color:#A6ACCD;">服务器。</span></span>
<span class="line"><span style="color:#A6ACCD;">· no-good-slave &lt;instance details&gt;：Sentinel 操作未能找到适合进行升级的从服务器。Sentinel 会在一段时间之后再次尝试寻找合适的从服务器</span></span>
<span class="line"><span style="color:#A6ACCD;">来进行升级，又或者直接放弃执行故障转移操作。</span></span>
<span class="line"><span style="color:#A6ACCD;">· selected-slave &lt;instance details&gt;：Sentinel 顺利找到适合进行升级的从服务器。</span></span>
<span class="line"><span style="color:#A6ACCD;">· failover-state-send-slaveof-noone &lt;instance details&gt;：Sentinel 正在将指定的从服务器升级为主服务器，等待升级功能完成。</span></span>
<span class="line"><span style="color:#A6ACCD;">· failover-end-for-timeout &lt;instance details&gt;：故障转移因为超时而中止，不过最终所有从服务器都会开始复制新的主服务器（slaves will</span></span>
<span class="line"><span style="color:#A6ACCD;">eventually be configured to replicate with the new master anyway）。</span></span>
<span class="line"><span style="color:#A6ACCD;">· failover-end &lt;instance details&gt;：故障转移操作顺利完成。所有从服务器都开始复制新的主服务器了。</span></span>
<span class="line"><span style="color:#A6ACCD;">· +switch-master &lt;master name&gt; &lt;oldip&gt; &lt;oldport&gt; &lt;newip&gt; &lt;newport&gt;：配置变更，主服务器的 IP 和地址已经改变。 这是绝大多数外部用户都关</span></span>
<span class="line"><span style="color:#A6ACCD;">心的信息。</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-37ebe389 data-v-a54a85bd><!----><div class="prev-next" data-v-a54a85bd><div class="pager" data-v-a54a85bd><a class="pager-link prev" href="/guo-notes/classify/Redis/redis%E4%B8%BB%E4%BB%8E.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Previous page</span><span class="title" data-v-a54a85bd>十三、redis主从</span></a></div><div class="has-prev pager" data-v-a54a85bd><a class="pager-link next" href="/guo-notes/classify/Redis/redis%E9%9B%86%E7%BE%A4.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Next page</span><span class="title" data-v-a54a85bd>十五、redis集群</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"classify_docker_docker compose服务编排.md\":\"2f888a0c\",\"classify_docker_dockerhub和私人仓库.md\":\"df90faa6\",\"classify_docker_dockerfile.md\":\"f7500fe0\",\"classify_docker_docker介绍.md\":\"50911a6e\",\"classify_docker_docker命令.md\":\"054af1b5\",\"classify_docker_docker安装和启动.md\":\"9e186bd5\",\"classify_docker_docker架构.md\":\"a66647ea\",\"classify_elasticsearch_elasticsearch介绍.md\":\"a072086a\",\"classify_elasticsearch_elasticsearch.md\":\"c1500f96\",\"classify_kafka_kafka-php整合.md\":\"9736fae5\",\"classify_kafka_kafka-微服务整合.md\":\"e8c00b0d\",\"classify_kafka_kafka.md\":\"cbb9532e\",\"classify_kafka_kafka介绍.md\":\"9f7288ad\",\"classify_kafka_kafka和rabbitmq对比.md\":\"b207e44c\",\"classify_kafka_kafka集群.md\":\"28191467\",\"classify_kafka_kafka零拷贝技术.md\":\"93b4a18c\",\"classify_kubernetes_dashboard.md\":\"769d74db\",\"classify_kubernetes_kubernetes介绍.md\":\"427c89cd\",\"classify_kubernetes_kubernetes实战入门.md\":\"27b87104\",\"classify_kubernetes_kubernetes资源管理.md\":\"3f4ba6df\",\"classify_kubernetes_kubernetes集群环境搭建.md\":\"d6f8fa8a\",\"classify_kubernetes_pod控制器详解.md\":\"c6b597cd\",\"classify_kubernetes_pod详解.md\":\"e930022f\",\"classify_kubernetes_service详解.md\":\"d284393a\",\"classify_kubernetes_安全认证.md\":\"d6aef10f\",\"classify_kubernetes_数据存储.md\":\"527d578e\",\"classify_nginx_nginx.md\":\"81831533\",\"classify_rabbitmq_exchange核心概念.md\":\"cf3fd2be\",\"classify_rabbitmq_mq的概念.md\":\"a8de277a\",\"classify_rabbitmq_mq的种类和对比.md\":\"95a861a8\",\"classify_rabbitmq_rabbitmq命令行.md\":\"74ca2004\",\"classify_rabbitmq_rabbitmq工作模式.md\":\"2a54a32e\",\"classify_rabbitmq_rabbitmq应用方案.md\":\"f7df6d10\",\"classify_rabbitmq_rabbitmq的安装和启动.md\":\"b78de0ed\",\"classify_rabbitmq_rabbitmq简介.md\":\"236bcb00\",\"classify_rabbitmq_rabbitmq管控台介绍.md\":\"e54735bc\",\"classify_rabbitmq_rabbitmq集群搭建.md\":\"43e4e123\",\"classify_rabbitmq_rabbitmq高级特性.md\":\"64eae523\",\"classify_rabbitmq_rabbitmq高级特性1.md\":\"20693dff\",\"classify_redis_redis主从.md\":\"ace049eb\",\"classify_redis_redis事务.md\":\"2b15d396\",\"classify_redis_redis五大数据类型实现原理.md\":\"43005010\",\"classify_redis_redis介绍.md\":\"2db09627\",\"classify_redis_redis内存回收.md\":\"2b3bd9e6\",\"classify_redis_redis内存淘汰策略.md\":\"4e4d0fa1\",\"classify_redis_redis内存碎片率.md\":\"10ebcb77\",\"classify_redis_redis分布式锁.md\":\"c4be9f0e\",\"classify_redis_redis哨兵.md\":\"cab32070\",\"classify_redis_redis底层数据结构.md\":\"a7db478d\",\"classify_redis_redis慢查询和管道.md\":\"7bf99bba\",\"classify_redis_redis持久化.md\":\"105d7bb8\",\"classify_redis_redis数据类型简介.md\":\"9a6e00bf\",\"classify_redis_redis缓存穿透、击穿、雪崩.md\":\"1ec24d0d\",\"classify_redis_redis配置文件解析.md\":\"922288cd\",\"classify_redis_redis集群.md\":\"a54df596\",\"classify_algorithm_concept_复杂度-时间复杂度和空间复杂度.md\":\"d210b6d7\",\"classify_algorithm_concept_数据结构-堆.md\":\"ef81e619\",\"classify_algorithm_concept_数据结构-栈与队列.md\":\"d11285b5\",\"classify_algorithm_concept_数据结构-树.md\":\"7ff222bc\",\"classify_algorithm_concept_算法-排序算法.md\":\"2381e358\",\"classify_algorithm_concept_算法-查找算法.md\":\"3433b4b9\",\"classify_algorithm_concept_算法-深度优先搜索和广度优先搜索.md\":\"50538dce\",\"classify_algorithm_index.md\":\"317ad611\",\"classify_algorithm_title_leetcode-1.md\":\"79049724\",\"classify_algorithm_title_leetcode-101.md\":\"b106cce7\",\"classify_algorithm_title_leetcode-104.md\":\"77635922\",\"classify_algorithm_title_leetcode-110.md\":\"055468f2\",\"classify_algorithm_title_leetcode-141.md\":\"1175638c\",\"classify_algorithm_title_leetcode-142.md\":\"17e08a01\",\"classify_algorithm_title_leetcode-144.md\":\"2dc15374\",\"classify_algorithm_title_leetcode-145.md\":\"b6d44dab\",\"classify_algorithm_title_leetcode-160.md\":\"4d381ddc\",\"classify_algorithm_title_leetcode-206.md\":\"27760ed9\",\"classify_algorithm_title_leetcode-21.md\":\"54301e62\",\"classify_algorithm_title_leetcode-226.md\":\"2845b881\",\"classify_algorithm_title_leetcode-232.md\":\"b9cffb07\",\"classify_algorithm_title_leetcode-234.md\":\"9025dcbd\",\"classify_algorithm_title_leetcode-283.md\":\"62fb964c\",\"classify_algorithm_title_leetcode-394.md\":\"4ce2ebbe\",\"classify_algorithm_title_leetcode-448.md\":\"e3bf2787\",\"classify_algorithm_title_leetcode-70.md\":\"1197b33f\",\"classify_algorithm_title_leetcode-83.md\":\"d64ea8bc\",\"classify_algorithm_title_leetcode-876.md\":\"9e6e3789\",\"classify_algorithm_title_leetcode-88.md\":\"14b2dcd2\",\"classify_algorithm_title_leetcode-912.md\":\"d9d891d7\",\"classify_algorithm_title_leetcode-94.md\":\"e4bf18f5\",\"classify_algorithm_title_leetcode-模板.md\":\"eb9c4456\",\"classify_algorithm_title_剑指offer-22.md\":\"3974f214\",\"classify_algorithm_其他-设计.md\":\"adcd3c0a\",\"classify_algorithm_基础-排序.md\":\"ed3b31f2\",\"classify_algorithm_基础数据结构-哈希表.md\":\"98113b6e\",\"classify_algorithm_基础数据结构-字符串.md\":\"8b6b7616\",\"classify_algorithm_基础数据结构-数组.md\":\"a5fa1385\",\"classify_algorithm_基础数据结构-栈.md\":\"a1214007\",\"classify_algorithm_基础数据结构-树.md\":\"86e75e35\",\"classify_algorithm_基础数据结构-链表.md\":\"0971f495\",\"classify_algorithm_基础数据结构-队列.md\":\"70c86e1a\",\"classify_algorithm_技巧-双指针.md\":\"e62131c1\",\"classify_algorithm_数学-斐波那契数列.md\":\"08ab01a0\",\"classify_algorithm_数学-相遇问题.md\":\"efa01855\",\"classify_algorithm_算法-动态规划.md\":\"d987e0af\",\"classify_algorithm_算法-广度优先搜索.md\":\"3703a1f9\",\"classify_algorithm_算法-排序.md\":\"08d26a2e\",\"classify_algorithm_算法-深度优先搜索.md\":\"2d1498b6\",\"classify_algorithm_算法-迭代.md\":\"b9418805\",\"classify_algorithm_算法-递归.md\":\"c255eff2\",\"classify_mysql_mvcc多版本并发控制.md\":\"40bb163a\",\"classify_mysql_mysql三大日志.md\":\"455d9ef4\",\"classify_mysql_mysql主从复制.md\":\"fbbe4613\",\"classify_mysql_mysql事务.md\":\"b22c888d\",\"classify_mysql_mysql介绍.md\":\"630fefb7\",\"classify_mysql_mysql分区.md\":\"1bc6cbc0\",\"classify_mysql_mysql分库分表.md\":\"292b93c7\",\"classify_mysql_mysql索引.md\":\"e6b315be\",\"classify_mysql_mysql语法.md\":\"4c76dbbe\",\"classify_mysql_mysql读写分离.md\":\"dd82248b\",\"classify_mysql_mysql负载均衡和高可用.md\":\"d410beac\",\"classify_mysql_mysql锁.md\":\"449b9749\",\"classify_mysql_sql语句优化.md\":\"a4dfbeb2\",\"classify_mysql_sql语句执行流程.md\":\"640f8235\",\"classify_mysql_存储引擎.md\":\"82d6b6ea\",\"classify_mysql_性能分析.md\":\"4f83f55f\",\"classify_mysql_物理文件.md\":\"e453f8b8\",\"classify_mysql_管理常用工具.md\":\"e232a677\",\"classify_sundry_concept_存储单位与速率单位.md\":\"46fa7cff\",\"classify_sundry_concept_性能指标.md\":\"702e7221\",\"classify_sundry_tools_git_github 连接失败.md\":\"7814b125\",\"classify_sundry_tools_vscode_vscode 启动 debug.md\":\"d6ba7a40\",\"classify_框架学习_laravel_artisan控制台命令.md\":\"5a86df9f\",\"classify_框架学习_laravel_生命周期相关核心概念.md\":\"372fbb5b\",\"classify_解决方案_redis主从存在的问题和解决方案.md\":\"fdb39f55\",\"classify_解决方案_数据库与缓存一致性解决方案.md\":\"22705b13\",\"classify_计算机基础_计算机网络_io模型.md\":\"bf841b88\",\"classify_计算机基础_计算机网络_index.md\":\"d9a72202\",\"classify_设计模式.md\":\"ff91cf28\",\"classify_面试常问_web安全.md\":\"99ef00e0\",\"classify_面试常问_一次网络请求的完整过程.md\":\"9d44d41a\",\"index.md\":\"d2096a85\",\"preface_install.md\":\"05888072\",\"preface_preface.md\":\"b51e2d5f\"}")</script>
    <script type="module" async src="/guo-notes/assets/app.867b012f.js"></script>
    
  </body>
</html>