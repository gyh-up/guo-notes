<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql分库分表 | 技术博客，知识分享，学习笔记，问题解决方案</title>
    <meta name="description" content="啊郭的博客">
    <link rel="stylesheet" href="/guo-notes/assets/style.5e0eda6f.css">
    <link rel="modulepreload" href="/guo-notes/assets/app.e5e644ed.js">
    <link rel="modulepreload" href="/guo-notes/assets/classify_mysql_mysql分库分表.md.74d43a51.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c6a644e1><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c6a644e1 data-v-a71a30f1><div class="VPNavBar has-sidebar" data-v-a71a30f1 data-v-6f1d18b5><div class="container" data-v-6f1d18b5><div class="VPNavBarTitle has-sidebar" data-v-6f1d18b5 data-v-d5925166><a class="title" href="/guo-notes/" data-v-d5925166><!--[--><!--]--><!----><!--[-->啊郭的博客<!--]--><!--[--><!--]--></a></div><div class="content" data-v-6f1d18b5><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6f1d18b5 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 后端技术 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/redis/redis%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Redis<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/mysql/mysql%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Mysql<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/RabbitMq/MQ%E7%9A%84%E6%A6%82%E5%BF%B5.html" data-v-e8e0fb1d data-v-3c355974><!--[-->RabbitMq<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Docker/Docker%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Docker<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/Kubernetes/Kubernetes%E4%BB%8B%E7%BB%8D.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Kubernetes<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 计算机基础 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/guo-notes/classify/计算机基础/计算机网络/" data-v-e8e0fb1d data-v-3c355974><!--[-->计算机网络<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guo-notes/classify/algorithm/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->算法<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 杂项 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6f1d18b5 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-a3e7452b data-v-1899cd41 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1899cd41><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1899cd41><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6f1d18b5 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/gyh-up?tab=repositories" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://blog.csdn.net/weixin_42258523?spm=1000.2115.3001.5343" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><embed src="https://g.csdnimg.cn/static/logo/favicon32.ico" style="border-radius: 100%;width: 20px;height: 20px;" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6f1d18b5 data-v-e4361c82 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e4361c82><div class="item appearance" data-v-e4361c82><p class="label" data-v-e4361c82>Appearance</p><div class="appearance-action" data-v-e4361c82><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-e4361c82 data-v-1899cd41 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-1899cd41><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-1899cd41><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e4361c82><div class="item social-links" data-v-e4361c82><div class="VPSocialLinks social-links-list" data-v-e4361c82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/gyh-up?tab=repositories" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://blog.csdn.net/weixin_42258523?spm=1000.2115.3001.5343" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><embed src="https://g.csdnimg.cn/static/logo/favicon32.ico" style="border-radius: 100%;width: 20px;height: 20px;" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6f1d18b5 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-c6a644e1 data-v-aac27d5e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-aac27d5e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-aac27d5e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-aac27d5e>Menu</span></button><a class="top-link" href="#" data-v-aac27d5e> Return to top </a></div><aside class="VPSidebar" data-v-c6a644e1 data-v-f332cb62><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f332cb62><span class="visually-hidden" id="sidebar-aria-label" data-v-f332cb62> Sidebar Navigation </span><!--[--><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible" data-v-f332cb62 data-v-35f99ef5><div class="title" role="button" data-v-35f99ef5><h2 class="title-text" data-v-35f99ef5>Mysql 学习笔记</h2><div class="action" data-v-35f99ef5><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-35f99ef5><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-35f99ef5><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-35f99ef5><!--[--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E4%BB%8B%E7%BB%8D.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>一、mysql介绍</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E8%AF%AD%E6%B3%95.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>二、mysql语法</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/%E7%AE%A1%E7%90%86%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>三、管理常用工具</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/%E7%89%A9%E7%90%86%E6%96%87%E4%BB%B6.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>四、物理文件</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>五、存储引擎</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/sql%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>六、sql语句执行流程</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/sql%E8%AF%AD%E5%8F%A5%E4%BC%98%E5%8C%96.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>七、sql语句优化</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>八、性能分析</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E7%B4%A2%E5%BC%95.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>九、索引</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E9%94%81.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十、锁</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E4%BA%8B%E5%8A%A1.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十一、事务</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/MVCC%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十二、MVCC多版本并发控制</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E4%B8%89%E5%A4%A7%E6%97%A5%E5%BF%97.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十三、三大日志</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E5%88%86%E5%8C%BA.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十四、mysql分区</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/guo-notes/classify/mysql/mysql%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十五、mysql分库分表</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十六、mysql主从复制</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十七、mysql读写分离</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/guo-notes/classify/mysql/mysql%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8.html" style="padding-left:0px;" data-v-2cfe069a data-v-3c355974><!--[--><span class="link-text" data-v-2cfe069a>十八、mysql负载均衡和高可用</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c6a644e1 data-v-c95df128><div class="VPDoc has-sidebar has-aside" data-v-c95df128 data-v-37ebe389><div class="container" data-v-37ebe389><div class="aside" data-v-37ebe389><div class="aside-curtain" data-v-37ebe389></div><div class="aside-container" data-v-37ebe389><div class="aside-content" data-v-37ebe389><div class="VPDocAside" data-v-37ebe389 data-v-afc4c1a1><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-afc4c1a1 data-v-2865c0b0><div class="content" data-v-2865c0b0><div class="outline-marker" data-v-2865c0b0></div><div class="outline-title" data-v-2865c0b0>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-2865c0b0><span class="visually-hidden" id="doc-outline-aria-label" data-v-2865c0b0> Table of Contents for current page </span><ul class="root" data-v-2865c0b0 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-afc4c1a1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-37ebe389><div class="content-container" data-v-37ebe389><!--[--><!--]--><main class="main" data-v-37ebe389><div style="position:relative;" class="vp-doc _guo-notes_classify_mysql_mysql%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8" data-v-37ebe389><div><h1 id="mysql分库分表" tabindex="-1">mysql分库分表 <a class="header-anchor" href="#mysql分库分表" aria-hidden="true">#</a></h1><h2 id="一、分库分表" tabindex="-1">一、分库分表 <a class="header-anchor" href="#一、分库分表" aria-hidden="true">#</a></h2><p>随着互联网的发展，应用系统的数据量也是成指数式增长，若采用单数据库进行数据存储，存在以下性能瓶颈：</p><p>1、IO 瓶颈：热点数据太多，数据库缓存不足，产生大量磁盘IO，效率较低。请求数据太多，带宽不够，网络IO瓶颈。</p><p>2、CPU 瓶颈：排序、分组、连接查询、聚合统计等 SQL 会耗费大量的 CPU 资源，请求数太多，CPU出现瓶颈。</p><p>通过数据切分来提高网站性能，横向扩展数据层已经成为架构研发人员首选的方式。</p><ul><li><strong>水平切分数据库：可以降低单台机器的负载，同时最大限度的降低了宕机造成的损失；</strong></li><li><strong>负载均衡策略：可以降低单台机器的访问负载，降低宕机的可能性；</strong></li><li><strong>集群方案：解决了数据库宕机带来的单点数据库不能访问的问题；</strong></li><li><strong>读写分离策略：最大限度了提高了应用中读取数据的速度和并发量；</strong></li></ul><blockquote><p>问题描述</p></blockquote><p>1、单个表数据量越大（超1000W），读写锁，插入操作重新建立索引效率越低。</p><p>2、单个库数据量太大（一个数据库数据量到 1T-2T 就是极限）</p><p>3、单个数据库服务器压力过大</p><p>4、读写速度遇到瓶颈（并发量几百）</p><p><strong>分库分表的中心思想都是将数据分散存储，使得单一数据库/表的数据量变小来缓解单一数据库的性能问题，从而达到提升数据库性能的目的。</strong></p><h2 id="_1、垂直拆分" tabindex="-1">1、垂直拆分 <a class="header-anchor" href="#_1、垂直拆分" aria-hidden="true">#</a></h2><p>比如系统被切分成了，用户，订单交易，支付几个模块。 一个架构设计较好的应用系统，其总体功能肯定是由很多个功能模块所组成的，而每一个功能模块所需要的数据对应到数据库中就是一个或者多个表。而在架构设计中，各个功能模块相互之间的交互点越统一越少，系统的耦合度就越低，系统各个模块的维护性以及扩展性也就好。</p><p>但是往往系统有些表难以做到完全的独立，存在着跨库 join 的情况，对于这类的表，就需要去做平衡，是数据库让步业务，共用一个数据源，还是分成多个库，业务之间通过接口来做调用。在系统初期，数据量比较少，或者资源有限的情况下，会选择共用数据源，但是当数据发展到了一定的规模，负载很大的情况，就需要必须去做分割。一般来讲业务存在着复杂 join 的场景是难以切分的，往往业务独立的易于切分。如何切分，切分到何种程度是考验技术架构的一个难题。</p><p>优点：</p><ul><li>拆分后业务清晰，拆分规则明确；</li><li>系统之间整合或扩展容易；</li><li>数据维护简单。</li></ul><p>缺点：</p><ul><li>部分业务表无法 join，只能通过接口方式解决，提高了系统复杂度；</li><li>受每种业务不同的限制存在单库性能瓶颈，不易数据扩展跟性能提高；</li><li>事务处理复杂。</li></ul><p>由于垂直切分是按照业务的分类将表分散到不同的库，所以有些业务表会过于庞大，存在单库读写与存储瓶颈，所以就需要水平拆分来做解决。</p><h2 id="_1-1、垂直分库" tabindex="-1">1.1、垂直分库 <a class="header-anchor" href="#_1-1、垂直分库" aria-hidden="true">#</a></h2><p><img src="/guo-notes/mysql/image-20230314101027805.png" alt="image-20230314101027805"></p><p><strong>以表为依据，根据业务将不同表拆分到不同库中。</strong></p><p>特点：</p><p>1、每个库的表结构都不一样。</p><p>2、每个库的数据也不一样。</p><p>3、所有库的并集是全量数据。</p><h2 id="_1-2、垂直分表" tabindex="-1">1.2、垂直分表 <a class="header-anchor" href="#_1-2、垂直分表" aria-hidden="true">#</a></h2><p><img src="/guo-notes/mysql/image-20230314101335937.png" alt="image-20230314101335937"></p><p><strong>以字段为依据，根据字段属性将不同字段拆分到不同表中。</strong></p><p>特点：</p><p>1、每个表的结构都不一样。</p><p>2、每个表的数据也不一样，一般通过一列（主键/外键）关联。</p><p>3、所有表的并集是全量数据。</p><h2 id="_2、水平拆分" tabindex="-1">2、水平拆分 <a class="header-anchor" href="#_2、水平拆分" aria-hidden="true">#</a></h2><p>拆分的第一原则是找到拆分维度。比如：从会员的角度来分析，商户订单交易类系统中查询会员某天某月某个订单，那么就需要按照会员结合日期来拆分，不同的数据按照会员 ID 做分组，这样所有的数据查询 join 都会在单库内解决；如果从商户的角度来讲，要查询某个商家某天所有的订单数，就需要按照商户 ID 做拆分；但是如果系统既想按会员拆分，又想按商家数据，则会有一定的困难。如何找到合适的分片规则需要综合考虑衡量。</p><p>几种典型的分片规则包括：</p><ul><li>按照用户 ID 求模，将数据分散到不同的数据库，具有相同数据用户的数据都被分散到一个库中；</li><li>按照日期，将不同月甚至日的数据分散到不同的库中；</li><li>按照某个特定的字段求摸，或者根据特定范围段分散到不同的库中。</li></ul><p>优点：</p><ul><li>拆分规则抽象好，join 操作基本可以数据库做；</li><li>不存在单库大数据，高并发的性能瓶颈；</li><li>应用端改造较少； 提高了系统的稳定性跟负载能力。</li></ul><p>缺点：</p><ul><li>拆分规则难以抽象；</li><li>分片事务一致性难以解决；</li><li>数据多次扩展难度跟维护量极大；</li><li>跨库 join 性能较差。</li></ul><h2 id="_2-1、水平分库" tabindex="-1">2.1、水平分库 <a class="header-anchor" href="#_2-1、水平分库" aria-hidden="true">#</a></h2><p><img src="/guo-notes/mysql/image-20230314101608568.png" alt="image-20230314101608568"></p><p>以字段为依据，按照一定策略，将一个库的数据拆分到多个库中。</p><p>特点：</p><p>1、每个库的表结构都一样。</p><p>2、每个库的数据都不一样。</p><p>3、所有库的并集是全量数据。</p><h2 id="_2-2、水平分表" tabindex="-1">2.2、水平分表 <a class="header-anchor" href="#_2-2、水平分表" aria-hidden="true">#</a></h2><p><img src="/guo-notes/mysql/image-20230314101733882.png" alt="image-20230314101733882"></p><p>以字段为依据，按照一定策略，将一个表的数据拆分到多个表中。</p><p>特点：</p><p>1、每个表的表结构都一样。</p><p>2、每个表的数据都不一样。</p><p>3、所有表的并集是全量数据。</p><h2 id="_3、mycat-中间件" tabindex="-1">3、Mycat 中间件 <a class="header-anchor" href="#_3、mycat-中间件" aria-hidden="true">#</a></h2><p>Mycat 是开源的、活跃的、基于 java 语言编写的 Mysql 数据中间件，可以像使用 Mysql 一样来使用 Mycat，对于开发人员来说根本感觉不到 Mycat 的存在。Mycat 性能可靠稳定，有强大的技术团队，体系完善，社区活跃。</p><blockquote><p>下载</p></blockquote><p>官网 <a href="http://mycat.org.cn" target="_blank" rel="noreferrer">mycat.org.cn</a></p><blockquote><p>安装</p></blockquote><p>Mycat 是采用java语言开发的开源数据库中间件，支持 Windows和linux运行环境，下面介绍mycat的Linux中的环境搭建。我们需要在准备好的服务器中安装如下软件：Mysql、JDK、Mycat。</p><p><img src="/guo-notes/mysql/image-20230314105736670.png" alt="image-20230314105736670"></p><table><thead><tr><th>Mycat 目录结构</th><th></th></tr></thead><tbody><tr><td>bin</td><td>存放可执行文件，用于启动停止 mycat</td></tr><tr><td>conf</td><td>存放 mycat 的配置文件</td></tr><tr><td>lib</td><td>存放 mycat 的项目依赖包（jar）</td></tr><tr><td>logs</td><td>存放 mycat 的日志文件</td></tr></tbody></table><h2 id="_3-1、mycat-结构" tabindex="-1">3.1、Mycat 结构 <a class="header-anchor" href="#_3-1、mycat-结构" aria-hidden="true">#</a></h2><p><img src="/guo-notes/mysql/image-20230314111057133.png" alt="image-20230314111057133"></p><h2 id="_3-2、配置" tabindex="-1">3.2、配置 <a class="header-anchor" href="#_3-2、配置" aria-hidden="true">#</a></h2><blockquote><p>参考 <a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=167&amp;spm_id_from=pageDriver&amp;vd_source=2365b1baf9eff4a0af3aabdb705341bd" target="_blank" rel="noreferrer">运维-分库分表-MyCat入门_哔哩哔哩_bilibili</a></p></blockquote><h2 id="_3-2-1、schema-xml" tabindex="-1">3.2.1、schema.xml <a class="header-anchor" href="#_3-2-1、schema-xml" aria-hidden="true">#</a></h2><p>schema.xml 作为 Mycat 中最重要的配置文件之一，涵盖了 Mycat 的逻辑库、逻辑表、分片规则、分片节点及数据源的配置。</p><p>主要包含以下三组标签：</p><p><strong>schema标签：</strong></p><div class="language-xml line-numbers-mode"><button class="copy"></button><span class="lang">xml</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">schema</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DB01</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">checkSQLschema</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">sqlMaxLimit</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">table</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">TB_ORDER</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">dataNode</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dn1,dn2,dn3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rule</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">auto-sharding-long</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">schema</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>schema 标签用于定义 Mycat 实例中的逻辑库，一个 Mycat 实例中，可以有多个逻辑库，可以通过 schema 标签来划分不同的逻辑库。Mycat 中的逻辑库的概念，等同于 Mysql 中的 database 的概念，需要操作某个逻辑库下的表是，也需要切换逻辑库；</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">核心属性：</span></span>
<span class="line"><span style="color:#A6ACCD;">name：指定自定义的逻辑库库名</span></span>
<span class="line"><span style="color:#A6ACCD;">checkSQLschema：在SQL语句操作时指定了数据库名称，执行时是否自动去除；true：自动去除；false：不自动去除。</span></span>
<span class="line"><span style="color:#A6ACCD;">sqlMaxLimit：如果未指定 limit 进行查询，列表查询模式查询多少条记录</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>schema标签（table）：</strong></p><p>table 标签定义了 Mycat 中逻辑库schema下的逻辑表，所有需要拆分的表都需要在table标签中定义。</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">核心属性：</span></span>
<span class="line"><span style="color:#A6ACCD;">name：定义逻辑表表名，在该逻辑库下唯一</span></span>
<span class="line"><span style="color:#A6ACCD;">dataNode：定义逻辑表所属的 dataNode，该属性需要与dataNode标签中name对应；多个dataNode逗号分隔</span></span>
<span class="line"><span style="color:#A6ACCD;">rule:分片规则的名字，分片规则名字是在 rule.xml 中定义的</span></span>
<span class="line"><span style="color:#A6ACCD;">primaryKey：逻辑表对应真实表的主键</span></span>
<span class="line"><span style="color:#A6ACCD;">type：逻辑表的类型，目前逻辑表只有全局表和普通表，如果未配置，就是普通表；全局表，配置为 global</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>datanode标签：</strong></p><div class="language-xml line-numbers-mode"><button class="copy"></button><span class="lang">xml</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dataNode</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dn1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">dataHost</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dhost1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">database</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">db01</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dataNode</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dn2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">dataHost</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dhost2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">database</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">db01</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dataNode</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dn3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">dataHost</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dhost3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">database</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">db01</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>dataNode 标签中定义了Mycat中的数据节点，也就是我们通常说的数据分片。一个dataNode标签就是一个独立的数据分片。</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">核心属性：</span></span>
<span class="line"><span style="color:#A6ACCD;">name：定义数据节点的名称</span></span>
<span class="line"><span style="color:#A6ACCD;">dataHost：数据库实例主机名称，引用自 dataHost 标签中的name属性</span></span>
<span class="line"><span style="color:#A6ACCD;">database：定义分片所属数据库</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>datahost标签：</strong></p><div class="language-xml line-numbers-mode"><button class="copy"></button><span class="lang">xml</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dataHost</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dhost1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">maxCon</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1000</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">minCon</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">balance</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">writeType</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">dbType</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mysql</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">dbDriver</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jdbc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">heartboat</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">select user()</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">heartboat</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">writeHost</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">host</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">master</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">url</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jdbc:mysql://192.168.200.210:3306?useSSL=false</span><span style="color:#89DDFF;">&amp;</span><span style="color:#C3E88D;">amp</span><span style="color:#89DDFF;">;</span><span style="color:#C3E88D;">serverTimezone=Asia/Shanghai</span><span style="color:#89DDFF;">&amp;</span><span style="color:#C3E88D;">amp</span><span style="color:#89DDFF;">;</span><span style="color:#C3E88D;">characterEncoding=utf8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">user</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">password</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1234</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">writeHost</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">dataHost</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>该标签在Mycat逻辑库中作为底层标签存在，直接定义了具体的数据库实例、读写分离、心跳语句。</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">核心属性：</span></span>
<span class="line"><span style="color:#A6ACCD;">name：唯一标识，供上层标签使用</span></span>
<span class="line"><span style="color:#A6ACCD;">maxCon/minCon：最大连接数/最小连接数</span></span>
<span class="line"><span style="color:#A6ACCD;">balance：负载均衡策略，取值0,1,2,3</span></span>
<span class="line"><span style="color:#A6ACCD;">writeType：写操作分发方式（0：写操作转发到第一个writeHost，第一个挂了，切换到第二个；1：写操作随机分发到配置的writeHost）</span></span>
<span class="line"><span style="color:#A6ACCD;">dbDriver：数据库驱动，支持 native、jdbc</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_3-2-2、rule-xml" tabindex="-1">3.2.2、rule.xml <a class="header-anchor" href="#_3-2-2、rule-xml" aria-hidden="true">#</a></h2><p>rule.xml 中定义所有拆分表的规则，在使用过程中可以灵活地使用分片算法，或者对同一个分片算法使用不同的参数，它让分片过程可配置化。主要包含两类标签：tableRule、Function。</p><div class="language-xml line-numbers-mode"><button class="copy"></button><span class="lang">xml</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">tableRule</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">auto-sharding-long</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">rule</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">columns</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">columns</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">algorithm</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">rang-long</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">algorithm</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">rule</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">tableRule</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">function</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rang-long</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">io.mycat.route.function.AutoPartitionByLong</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">property</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mapFile</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">autopartition-long.txt</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">property</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">function</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/guo-notes/mysql/image-20230314151356726.png" alt="image-20230314151356726"></p><h2 id="_3-2-3、server-xml" tabindex="-1">3.2.3、server.xml <a class="header-anchor" href="#_3-2-3、server-xml" aria-hidden="true">#</a></h2><p>server.xml 配置文件包含了 Mycat 的系统配置信息，主要有两个重要标签：system、user。用于配置Mycat的用户名、密码、逻辑数据库名、服务端口、读写权限等。</p><blockquote><p>更多测试可参考 <a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=171&amp;spm_id_from=pageDriver&amp;vd_source=2365b1baf9eff4a0af3aabdb705341bd" target="_blank" rel="noreferrer">运维-分库分表-Mycat分片-垂直分库_哔哩哔哩_bilibili</a></p></blockquote><h2 id="_3-2-4、全局表配置" tabindex="-1">3.2.4、全局表配置 <a class="header-anchor" href="#_3-2-4、全局表配置" aria-hidden="true">#</a></h2><p>对于数据字典表，比如省市区表，tb_areas_provinces，tb_areas_city，tb_areas_region，在多个业务模块中都可能会遇到，可以将其设置为全局表，利于业务操作。</p><div class="language-xml line-numbers-mode"><button class="copy"></button><span class="lang">xml</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">schema</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DB01</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">checkSQLschema</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">sqlMaxLimit</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">table</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tb_areas_provinces</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">dataNode</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dn1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">primaryKey</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">schema</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">改为</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">schema</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DB01</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">checkSQLschema</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">sqlMaxLimit</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">table</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tb_areas_provinces</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">dataNode</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dn1,dn2,dn3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">primaryKey</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">global</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">schema</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_3-3、分片规则" tabindex="-1">3.3、分片规则 <a class="header-anchor" href="#_3-3、分片规则" aria-hidden="true">#</a></h2><h2 id="_3-3-1、范围分片" tabindex="-1">3.3.1、范围分片 <a class="header-anchor" href="#_3-3-1、范围分片" aria-hidden="true">#</a></h2><p>根据指定的字段及其配置的范围与数据节点的对应情况，来决定该数据属于哪一个分片</p><p><img src="/guo-notes/mysql/image-20230314161929964.png" alt="image-20230314161929964"></p><h2 id="_3-3-2、取模分片" tabindex="-1">3.3.2、取模分片 <a class="header-anchor" href="#_3-3-2、取模分片" aria-hidden="true">#</a></h2><p>根据指定的字段值与节点数量进行求模运算，根据运算结果，来决定该数据属于哪一个分片。</p><p><img src="/guo-notes/mysql/image-20230314162135275.png" alt="image-20230314162135275"></p><h2 id="_3-3-3、一致性hash算法" tabindex="-1">3.3.3、一致性hash算法 <a class="header-anchor" href="#_3-3-3、一致性hash算法" aria-hidden="true">#</a></h2><p>所谓一致性哈希，相同的哈希因子计算值总是被划分到相同的分区表中，不会因为分区节点的增加而改变原来数据的分区位置。</p><p><img src="/guo-notes/mysql/image-20230314162434229.png" alt="image-20230314162434229"></p><h2 id="_3-3-4、枚举" tabindex="-1">3.3.4、枚举 <a class="header-anchor" href="#_3-3-4、枚举" aria-hidden="true">#</a></h2><p>通过在配置文件中配置可能的枚举值，指定数据分布到不同数据节点上，本规则适用于按照省份、性别、状态拆分数据等业务。</p><p><img src="/guo-notes/mysql/image-20230314162948482.png" alt="image-20230314162948482"></p><h2 id="_3-3-5、应用指定算法" tabindex="-1">3.3.5、应用指定算法 <a class="header-anchor" href="#_3-3-5、应用指定算法" aria-hidden="true">#</a></h2><p>运行阶段由应用自主决定路由到哪个分片，直接根据字符子串（必须是数字）计算分片号。</p><p><img src="/guo-notes/mysql/image-20230314163730350.png" alt="image-20230314163730350"></p><h2 id="_3-3-6、固定分片哈希算法" tabindex="-1">3.3.6、固定分片哈希算法 <a class="header-anchor" href="#_3-3-6、固定分片哈希算法" aria-hidden="true">#</a></h2><p>该算法类似于十进制的求模运算，但是为二进制的操作，例如，取id二进制第10位与1111111111进行位&amp;运算。</p><p><img src="/guo-notes/mysql/image-20230314164426301.png" alt="image-20230314164426301"></p><p><img src="/guo-notes/mysql/image-20230314164505436.png" alt="image-20230314164630866"></p><h2 id="_3-3-7、字符串hash解析" tabindex="-1">3.3.7、字符串hash解析 <a class="header-anchor" href="#_3-3-7、字符串hash解析" aria-hidden="true">#</a></h2><p>截取字符串中的指定位置的子字符串，进行hash算法，算出分片。</p><p><img src="/guo-notes/mysql/image-20230314165531879.png" alt="image-20230314165531879"></p><h2 id="_3-3-8、按天分片" tabindex="-1">3.3.8、按天分片 <a class="header-anchor" href="#_3-3-8、按天分片" aria-hidden="true">#</a></h2><p><img src="/guo-notes/mysql/image-20230314170133509.png" alt="image-20230314170133509"></p><h2 id="_3-3-9、按自然月分片" tabindex="-1">3.3.9、按自然月分片 <a class="header-anchor" href="#_3-3-9、按自然月分片" aria-hidden="true">#</a></h2><p>使用场景为按照月份来分片，每个自然月为一个分片。</p><p><img src="/guo-notes/mysql/image-20230314170510738.png" alt="image-20230314170510738"></p><h2 id="_3-4、mycat管理和监控" tabindex="-1">3.4、Mycat管理和监控 <a class="header-anchor" href="#_3-4、mycat管理和监控" aria-hidden="true">#</a></h2><h2 id="_3-4-1、mycat原理" tabindex="-1">3.4.1、mycat原理 <a class="header-anchor" href="#_3-4-1、mycat原理" aria-hidden="true">#</a></h2><blockquote><p>参考 <a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=183&amp;spm_id_from=pageDriver&amp;vd_source=2365b1baf9eff4a0af3aabdb705341bd" target="_blank" rel="noreferrer">运维-分库分表-Mycat管理与监控-原理</a></p></blockquote><h2 id="_3-4-2、mycat管理" tabindex="-1">3.4.2、mycat管理 <a class="header-anchor" href="#_3-4-2、mycat管理" aria-hidden="true">#</a></h2><p>mycat 默认开通2个端口，可以在 server.xml 中进行修改。</p><ul><li>8066 数据访问端口，即进行 DML 和 DDL 操作。</li><li>9066 数据库管理端口，即 mycat 服务管理控制功能，用于管理 mycat 的整个集群状态</li></ul><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#A6ACCD;">mysql -h 192.168.200.210 -p 9066 -uroot -p123456</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/guo-notes/mysql/image-20230314172118372.png" alt="image-20230314172118372"></p><p>其中 <code>reload @@config;</code> 可动态重新加载配置文件。</p><h2 id="_3-4-3、mycat-eye" tabindex="-1">3.4.3、mycat-eye <a class="header-anchor" href="#_3-4-3、mycat-eye" aria-hidden="true">#</a></h2><p>mycat-web（mycat-web）是对mycat-server 提供监控服务，功能不局限于对 mycat-server 使用。他通过 JDBC 连接对 mycat、mysql 监控，监控远程服务器（目前仅限于linux系统）的cpu、内存、网络、磁盘。</p><p>mycat-eye 运行过程中需要依赖 zookeeper，因为需要先安装 zookeeper。</p><blockquote><p>安装 zookeeper</p></blockquote><div class="language-shell line-numbers-mode"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#676E95;">#下载或上传安装包</span></span>
<span class="line"><span style="color:#A6ACCD;">zookeeper-3.4.6.tar.gz</span></span>
<span class="line"><span style="color:#676E95;">#解压</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -zxvf zookeeper-3.4.6.tar.gz -C /usr/local/</span></span>
<span class="line"><span style="color:#676E95;">#创建数据存放目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> /usr/local/zookeeper-3.4.6</span></span>
<span class="line"><span style="color:#A6ACCD;">mkdir data</span></span>
<span class="line"><span style="color:#676E95;">#修改配置文件名称并配置</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> conf</span></span>
<span class="line"><span style="color:#A6ACCD;">mv zoo_sample.cfg zoo.cfg</span></span>
<span class="line"><span style="color:#676E95;">#配置数据存放目录</span></span>
<span class="line"><span style="color:#A6ACCD;">dataDir=/usr/local/zookeeper-3.4.6/data</span></span>
<span class="line"><span style="color:#676E95;">#启动 Zookeeper</span></span>
<span class="line"><span style="color:#A6ACCD;">bin/zkServer.sh start</span></span>
<span class="line"><span style="color:#A6ACCD;">bin/zkServer.sh status</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>安装 mycat-web</p></blockquote><div class="language-sh line-numbers-mode"><button class="copy"></button><span class="lang">sh</span><pre><code><span class="line"><span style="color:#676E95;">#下载或上传安装包</span></span>
<span class="line"><span style="color:#A6ACCD;">Mycat-web.tar.gz</span></span>
<span class="line"><span style="color:#676E95;">#解压</span></span>
<span class="line"><span style="color:#A6ACCD;">tar -zxvf Mycat-web.tar.gz -C /usr/local/</span></span>
<span class="line"><span style="color:#676E95;">#目录介绍</span></span>
<span class="line"><span style="color:#A6ACCD;">etc			- jetty配置文件</span></span>
<span class="line"><span style="color:#A6ACCD;">lib			- 依赖jar包</span></span>
<span class="line"><span style="color:#A6ACCD;">mycat-web	- mycat-web项目</span></span>
<span class="line"><span style="color:#A6ACCD;">readme.txt</span></span>
<span class="line"><span style="color:#A6ACCD;">start.jar	- 启动 jar</span></span>
<span class="line"><span style="color:#A6ACCD;">start.sh 	- linux 启动脚本</span></span>
<span class="line"><span style="color:#676E95;">#启动</span></span>
<span class="line"><span style="color:#A6ACCD;">sh start.sh</span></span>
<span class="line"><span style="color:#676E95;">#访问</span></span>
<span class="line"><span style="color:#A6ACCD;">http://localhost:8082/mycat</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>配置mycat信息</p></blockquote><p><img src="/guo-notes/mysql/image-20230314174535913.png" alt="image-20230314174535913"></p><h2 id="二、分库分表后的平滑扩容" tabindex="-1">二、分库分表后的平滑扩容 <a class="header-anchor" href="#二、分库分表后的平滑扩容" aria-hidden="true">#</a></h2><h2 id="_1、水平分库扩展问题" tabindex="-1">1、水平分库扩展问题 <a class="header-anchor" href="#_1、水平分库扩展问题" aria-hidden="true">#</a></h2><p>为了增加db的并发能力，常见的方案就是对数据进行sharding，也就是常说的分库分表，这个需要在初期对数据规划有一个预期，从而预先分配出足够的库来处理。</p><p>比如目前规划了3个数据库，基于uid进行取余分片，那么每个库上的划分规则如下:</p><p><img src="/guo-notes/mysql/mysql-51.png" alt="image-20210901234730867"></p><p>如上，数据可以均衡的分配到3个数据库里面。</p><p>但是，如果后续业务发展的速度很快，用户量数据大量上升，当前容量不足以支撑，应该怎么办？</p><p>需要对数据库进行水平扩容，再增加新库来分解。新库加入之后，原先 sharding 到3个库的数据，就可以sharding 到四个库里面了</p><p><img src="/guo-notes/mysql/mysql-52.png" alt="image-20210901234835596"></p><p>不过此时由于分片规则进行了变化(uid%3 变为uid%4)，大部分的数据，无法命中在原有的数据库上了，需要重新分配，大量数据需要迁移。</p><p>比如之前uid1通过uid1%3 分配在A库上，新加入库D之后，算法改为uid1%4 了，此时有可能就分配在B库上面了。如果你有看到之前《一致性哈希的原理与实践》，就会发现新增一个节点，大概会有90%的数据需要迁移。</p><h2 id="_2、解决方案" tabindex="-1">2、解决方案 <a class="header-anchor" href="#_2、解决方案" aria-hidden="true">#</a></h2><h2 id="_2-1-停服迁移" tabindex="-1">2.1 停服迁移 <a class="header-anchor" href="#_2-1-停服迁移" aria-hidden="true">#</a></h2><p>停服迁移是最常见的一种方案了，一般如下流程:</p><ol><li><p>预估停服时间，发布停服公告</p></li><li><p>停服，通过事先做好的数据迁移工具，按照新的分片规则，进行迁移</p></li><li><p>修改分片规则</p></li><li><p>启动服务</p></li></ol><p>这种方式比较安全，停服之后没有数据写入，能够保证迁移工作的正常进行，没有一致性的问题。唯一的问题，就是停服了和时间压力了。</p><ol><li><p>停服，伤害用户体验，同时也降低了服务器的可用性</p></li><li><p>必须在制定时间内完成迁移，如果失败，需要择日再次进行。同时增加了开发人员的压力，容易发生大的事故</p></li><li><p>数据量的巨大的时候，迁移需要大量时间</p></li></ol><h2 id="_2-2-升级从库" tabindex="-1">2.2 升级从库 <a class="header-anchor" href="#_2-2-升级从库" aria-hidden="true">#</a></h2><p>线上数据库，我们为了保持其高可用，一般都会每台主库配一台从库，读写在主库，然后主从同步到从库。如下，A，B是主库，A0和B0是从库。</p><p><img src="/guo-notes/mysql/mysql-53.png" alt="image-20210901235129303"></p><p>此时，当需要扩容的时候，我们把A0和B0升级为新的主库节点，如此由2个分库变为4个分库。同时在上层的分片配置，做好映射，规则如下:</p><p>uid%4=0和uid%4=2的分别指向A和A0，也就是之前指向uid%2=0的数据，分裂为uid%4=0和uid%4=2</p><p>uid%4=1和uid%4=3的指向B和B0，也就是之前指向uid%2=1的数据，分裂为uid%4=1和uid%4=3</p><p>因为A和A0库的数据相同，B和B0数据相同，所以此时无需做数据迁移即可。只需要变更一下分片配置即可，通过配置中心更新，无需重启。</p><img src="/guo-notes/mysql/mysql-54.png" alt="image-20210901235213455" style="zoom:80%;"><p>由于之前uid%2的数据分配在2个库里面，此时分散到4个库中，由于老数据还存在（uid%4=0,还有一半uid%4=2的数据），所以需要对冗余数据做一次清理。</p><p>而这个清理，不会影响线上数据的一致性，可是随时随地进行。</p><p>处理完成以后，为保证高可用，以及下一步扩容需求。可以为现有的主库再次分配一个从库。</p><img src="/guo-notes/mysql/mysql-55.png" alt="image-20210901235301225" style="zoom:80%;"><p>总结一下此方案步骤如下：</p><ol><li><p>修改分片配置，做好新库和老库的映射。</p></li><li><p>同步配置，从库升级为主库</p></li><li><p>解除主从关系</p></li><li><p>冗余数据清理</p></li><li><p>为新的数据节点搭建新的从库</p></li></ol><h2 id="_2-3-双写迁移" tabindex="-1">2.3 双写迁移 <a class="header-anchor" href="#_2-3-双写迁移" aria-hidden="true">#</a></h2><p>双写的方案，更多的是针对线上数据库迁移来用的，当然了，对于分库的扩展来说也是要迁移数据的，因此，也可以来协助分库扩容的问题。</p><p><strong>原理和上述相同，做分裂扩容，只是数据的同步方式不同了。</strong></p><p><strong>1.增加新库写链接</strong></p><p>双写的核心原理，就是对需要扩容的数据库上，增加新库，并对现有的分片上增加写链接，同时写两份数据。</p><p>因为新库的数据为空，所以数据的CRUD对其没有影响，在上层的逻辑层，还是以老库的数据为主。</p><img src="/guo-notes/mysql/mysql-56.png" alt="image-20210901235440809" style="zoom:80%;"><p><strong>2.新老库数据迁移</strong></p><p>通过工具，把老库的数据迁移到新库里面，此时可以选择同步分裂后的数据（1/2）来同步，也可以全同步，一般建议全同步，最终做数据校检的时候好处理。</p><img src="/guo-notes/mysql/mysql-57.png" alt="image-20210901235517150" style="zoom:80%;"><p><strong>3.数据校检</strong></p><p>按照理想环境情况下，数据迁移之后，因为是双写操作，所以两边的数据是一致的，特别是insert和update，一致性情况很高。但真实环境中会有网络延迟等情况，对于delete情况并不是很理想，比如：</p><p>A库删除数据a的时候，数据a正在迁移，还没有写入到C库中，此时C库的删除操作已经执行了，C库会多出一条数据。</p><p>此时就需要做好数据校检了，数据校检可以多做几遍，直到数据几乎一致，尽量以旧库的数据为准。</p><p><strong>4.分片配置修改</strong></p><p>数据同步完毕，就可以把新库的分片映射重新处理了，还是按照老库分裂的方式来进行，</p><p>之前uid%2=0，变为 uid%4=0 和 uid%4=2；</p><p>uid%2=1，变为 uid%4=1 和 uid%4=3 。</p><p><img src="/guo-notes/mysql/mysql-58.png" alt="image-20210901235719742"></p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-37ebe389 data-v-a54a85bd><div class="edit-info" data-v-a54a85bd><!----><div class="last-updated" data-v-a54a85bd><p class="VPLastUpdated" data-v-a54a85bd data-v-f7d51a9c>Last updated: <time datatime="2023-03-15T11:07:13.000Z" data-v-f7d51a9c></time></p></div></div><div class="prev-next" data-v-a54a85bd><div class="pager" data-v-a54a85bd><a class="pager-link prev" href="/guo-notes/classify/mysql/mysql%E5%88%86%E5%8C%BA.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Previous page</span><span class="title" data-v-a54a85bd>十四、mysql分区</span></a></div><div class="has-prev pager" data-v-a54a85bd><a class="pager-link next" href="/guo-notes/classify/mysql/mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Next page</span><span class="title" data-v-a54a85bd>十六、mysql主从复制</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"classify_docker_docker compose服务编排.md\":\"37d4f2c6\",\"classify_docker_dockerhub和私人仓库.md\":\"789a533f\",\"classify_docker_dockerfile.md\":\"1ddc6bef\",\"classify_docker_docker介绍.md\":\"54293525\",\"classify_docker_docker命令.md\":\"6571e445\",\"classify_docker_docker安装和启动.md\":\"42530901\",\"classify_docker_docker架构.md\":\"e6343a38\",\"classify_kubernetes_dashboard.md\":\"49777847\",\"classify_kubernetes_kubernetes介绍.md\":\"de98972c\",\"classify_kubernetes_kubernetes实战入门.md\":\"b19d63b6\",\"classify_kubernetes_kubernetes资源管理.md\":\"2901d0de\",\"classify_kubernetes_kubernetes集群环境搭建.md\":\"0b993a67\",\"classify_kubernetes_pod控制器详解.md\":\"7dd8860e\",\"classify_kubernetes_pod详解.md\":\"30295fea\",\"classify_kubernetes_service详解.md\":\"85f0a7f1\",\"classify_kubernetes_安全认证.md\":\"a27a4df3\",\"classify_kubernetes_数据存储.md\":\"effc4fd8\",\"classify_rabbitmq_exchange核心概念.md\":\"55a180e0\",\"classify_rabbitmq_mq的概念.md\":\"9bb7154d\",\"classify_rabbitmq_mq的种类和对比.md\":\"9adf87de\",\"classify_rabbitmq_rabbitmq命令行.md\":\"fb40be55\",\"classify_rabbitmq_rabbitmq工作模式.md\":\"e40ffd8a\",\"classify_rabbitmq_rabbitmq应用方案.md\":\"eb523ac1\",\"classify_rabbitmq_rabbitmq的安装和启动.md\":\"78281728\",\"classify_rabbitmq_rabbitmq简介.md\":\"b5beb999\",\"classify_rabbitmq_rabbitmq管控台介绍.md\":\"839e7e13\",\"classify_rabbitmq_rabbitmq集群搭建.md\":\"34e9fffa\",\"classify_rabbitmq_rabbitmq高级特性.md\":\"fe962dab\",\"classify_rabbitmq_rabbitmq高级特性1.md\":\"fc987efa\",\"classify_redis_redis主从.md\":\"cb7c2d8b\",\"classify_redis_redis事务.md\":\"370d16eb\",\"classify_redis_redis五大数据类型实现原理.md\":\"70a1cd7d\",\"classify_redis_redis介绍.md\":\"376ace16\",\"classify_redis_redis内存回收.md\":\"a139c806\",\"classify_redis_redis内存淘汰策略.md\":\"1cd31137\",\"classify_redis_redis内存碎片率.md\":\"ae8022df\",\"classify_redis_redis分布式锁.md\":\"d23cea5b\",\"classify_redis_redis哨兵.md\":\"256751b5\",\"classify_redis_redis底层数据结构.md\":\"d612d6d4\",\"classify_redis_redis慢查询和管道.md\":\"a37d6a5c\",\"classify_redis_redis持久化.md\":\"62fb4d60\",\"classify_redis_redis数据类型简介.md\":\"c06b1505\",\"classify_redis_redis缓存击穿、穿透、雪崩.md\":\"4809867f\",\"classify_redis_redis配置文件解析.md\":\"376dbc5f\",\"classify_redis_redis集群.md\":\"51db9cc7\",\"classify_algorithm_concept_复杂度-时间复杂度和空间复杂度.md\":\"96df82c2\",\"classify_algorithm_concept_数据结构-堆.md\":\"829caa3c\",\"classify_algorithm_concept_数据结构-栈与队列.md\":\"6a5235d1\",\"classify_algorithm_concept_数据结构-树.md\":\"8cdf27c9\",\"classify_algorithm_concept_算法-排序算法.md\":\"773828be\",\"classify_algorithm_concept_算法-查找算法.md\":\"1c694d53\",\"classify_algorithm_concept_算法-深度优先搜索和广度优先搜索.md\":\"e320bf4d\",\"classify_algorithm_index.md\":\"1eb12882\",\"classify_algorithm_title_leetcode-1.md\":\"ac073b42\",\"classify_algorithm_title_leetcode-101.md\":\"bc6526be\",\"classify_algorithm_title_leetcode-104.md\":\"4398c0b6\",\"classify_algorithm_title_leetcode-110.md\":\"d40c5d77\",\"classify_algorithm_title_leetcode-141.md\":\"9185edeb\",\"classify_algorithm_title_leetcode-142.md\":\"5d8cfdcd\",\"classify_algorithm_title_leetcode-144.md\":\"27e4c0ac\",\"classify_algorithm_title_leetcode-145.md\":\"18741f40\",\"classify_algorithm_title_leetcode-160.md\":\"cf2662aa\",\"classify_algorithm_title_leetcode-206.md\":\"1a5ffcca\",\"classify_algorithm_title_leetcode-21.md\":\"123ba26d\",\"classify_algorithm_title_leetcode-226.md\":\"a260b9c8\",\"classify_algorithm_title_leetcode-232.md\":\"568d1ae7\",\"classify_algorithm_title_leetcode-234.md\":\"25a933fc\",\"classify_algorithm_title_leetcode-283.md\":\"8bfbb12a\",\"classify_algorithm_title_leetcode-394.md\":\"b925ee48\",\"classify_algorithm_title_leetcode-448.md\":\"4a80a523\",\"classify_algorithm_title_leetcode-70.md\":\"d840424e\",\"classify_algorithm_title_leetcode-83.md\":\"b3c16d47\",\"classify_algorithm_title_leetcode-876.md\":\"55ee5793\",\"classify_algorithm_title_leetcode-88.md\":\"cf3e156e\",\"classify_algorithm_title_leetcode-912.md\":\"ac56eead\",\"classify_algorithm_title_leetcode-94.md\":\"e2975a84\",\"classify_algorithm_title_leetcode-模板.md\":\"c75f35b3\",\"classify_algorithm_title_剑指offer-22.md\":\"36228e68\",\"classify_algorithm_其他-设计.md\":\"6a568284\",\"classify_algorithm_基础-排序.md\":\"035a4833\",\"classify_algorithm_基础数据结构-哈希表.md\":\"57301bf9\",\"classify_algorithm_基础数据结构-字符串.md\":\"d1716c95\",\"classify_algorithm_基础数据结构-数组.md\":\"fa4fbd97\",\"classify_algorithm_基础数据结构-栈.md\":\"c8a2f647\",\"classify_algorithm_基础数据结构-树.md\":\"b8b207d5\",\"classify_algorithm_基础数据结构-链表.md\":\"e11cbf79\",\"classify_algorithm_基础数据结构-队列.md\":\"a954fb4a\",\"classify_algorithm_技巧-双指针.md\":\"61f429dc\",\"classify_algorithm_数学-斐波那契数列.md\":\"e7e8fc46\",\"classify_algorithm_数学-相遇问题.md\":\"ee93627c\",\"classify_algorithm_算法-动态规划.md\":\"51ede365\",\"classify_algorithm_算法-广度优先搜索.md\":\"b317428e\",\"classify_algorithm_算法-排序.md\":\"d30b8189\",\"classify_algorithm_算法-深度优先搜索.md\":\"a1993552\",\"classify_algorithm_算法-迭代.md\":\"3362a0b7\",\"classify_algorithm_算法-递归.md\":\"60a19731\",\"classify_mysql_mvcc多版本并发控制.md\":\"a2fa6be2\",\"classify_mysql_mysql三大日志.md\":\"cc19fc63\",\"classify_mysql_mysql主从复制.md\":\"ca0ae54e\",\"classify_mysql_mysql事务.md\":\"46ed861b\",\"classify_mysql_mysql介绍.md\":\"319d5551\",\"classify_mysql_mysql分区.md\":\"54f08669\",\"classify_mysql_mysql分库分表.md\":\"74d43a51\",\"classify_mysql_mysql索引.md\":\"b1119212\",\"classify_mysql_mysql语法.md\":\"10c8c37f\",\"classify_mysql_mysql读写分离.md\":\"6db7f2e3\",\"classify_mysql_mysql负载均衡和高可用.md\":\"4714d679\",\"classify_mysql_mysql锁.md\":\"2063d4fa\",\"classify_mysql_sql语句优化.md\":\"88692b16\",\"classify_mysql_sql语句执行流程.md\":\"20e29c8d\",\"classify_mysql_存储引擎.md\":\"962aacb7\",\"classify_mysql_性能分析.md\":\"2f559baa\",\"classify_mysql_物理文件.md\":\"f71473d7\",\"classify_mysql_管理常用工具.md\":\"19a34734\",\"classify_sundry_concept_性能指标.md\":\"d0278987\",\"classify_sundry_tools_git_github 连接失败.md\":\"032e74ec\",\"classify_sundry_tools_vscode_vscode 启动 debug.md\":\"3fc1f180\",\"classify_框架学习_laravel_artisan控制台命令.md\":\"2ec24666\",\"classify_框架学习_laravel_生命周期相关核心概念.md\":\"050f9532\",\"classify_解决方案_redis主从存在的问题和解决方案.md\":\"4d169f86\",\"classify_解决方案_数据库与缓存一致性解决方案.md\":\"09676c54\",\"classify_计算机基础_计算机网络_io模型.md\":\"196fecaa\",\"classify_计算机基础_计算机网络_index.md\":\"d3fd2d4c\",\"classify_面试常问_web安全.md\":\"b18a8af9\",\"classify_面试常问_一次网络请求的完整过程.md\":\"709cfd36\",\"index.md\":\"081283d3\",\"preface_install.md\":\"5d999b0b\",\"preface_preface.md\":\"218b17e1\"}")</script>
    <script type="module" async src="/guo-notes/assets/app.e5e644ed.js"></script>
    
  </body>
</html>